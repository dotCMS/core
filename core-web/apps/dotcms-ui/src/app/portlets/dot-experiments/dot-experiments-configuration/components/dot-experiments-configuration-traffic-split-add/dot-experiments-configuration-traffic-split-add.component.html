<ng-container *ngIf="vm$ | async as vm">
    <p-sidebar [(visible)]="vm.status.isOpen" (onHide)="closeSidebar()" dotSidebar>
        <dot-sidebar-header
            [actionButtonTpl]="actionHeaderBtnTpl"
            dotTitle="{{ 'experiments.configure.traffic.split.title' | dm }}"
        ></dot-sidebar-header>

        <div class="experiment-traffic-split__form-wrapper flex flex-column">
            <form
                class="p-fluid"
                [formGroup]="form"
                data-testId="add-traffic-split-form"
                novalidate
            >
                <div class="field">
                    <label>
                        {{ 'experiments.configure.traffic.split.name' | dm }}
                    </label>
                    <p-radioButton
                        [label]="'experiments.configure.traffic.split.evenly' | dm"
                        (click)="splitEvenly()"
                        value="SPLIT_EVENLY"
                        formControlName="type"
                    >
                    </p-radioButton>
                    <p-radioButton
                        [label]="'experiments.configure.traffic.split.custom' | dm"
                        value="CUSTOM_PERCENTAGES"
                        formControlName="type"
                    >
                    </p-radioButton>
                </div>

                <div class="experiment-traffic-split__variants">
                    <div class="experiment-traffic-split__variants-header">
                        <div>{{ 'variant' | dm }}</div>
                        <div class="experiment-traffic-split__variants-weight">%</div>
                    </div>
                    <ng-container formArrayName="variants">
                        <div
                            class="experiment-traffic-split__variants-item"
                            *ngFor="let variant of variants.controls; let i = index"
                            [formGroupName]="i"
                        >
                            <span
                                class="experiment-traffic-split__variants-name"
                                data-testId="variant-name"
                            >
                                {{ variant.value.name }}
                            </span>
                            <p-inputNumber
                                class="experiment-traffic-split__variants-weight"
                                *ngIf="form.value.type === 'CUSTOM_PERCENTAGES'; else splitEven"
                                [maxFractionDigits]="2"
                                [min]="0"
                                [max]="100"
                                formControlName="weight"
                                mode="decimal"
                            >
                            </p-inputNumber>

                            <ng-template #splitEven>
                                <span
                                    class="experiment-traffic-split__variants-weight"
                                    data-testId="variant-weight"
                                    >{{ variant.value.weight | json }}</span
                                >
                            </ng-template>
                        </div>
                    </ng-container>
                </div>
            </form>
        </div>
    </p-sidebar>
    <ng-template #actionHeaderBtnTpl>
        <button
            [disabled]="!form.valid"
            [loading]="vm.status.status === stepStatus.SAVING"
            (click)="save(vm.experimentId)"
            data-testId="add-traffic-split-button"
            label="{{ 'Done' | dm }}"
            pButton
            pRipple
            type="submit"
        ></button>
    </ng-template>
</ng-container>
