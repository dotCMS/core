<ng-container *ngIf="vm$ | async as vm">
    <p-card>
        <ng-template pTemplate="title">
            <div class="flex justify-content-between">
                <h2 class="flex align-items-center gap-1 uppercase">
                    {{ 'experiments.configure.variants.name' | dm }}
                    <dot-icon
                        [ngClass]="{ isDone: vm.isVariantDone }"
                        name="check_circle"
                        size="16"
                    ></dot-icon>
                </h2>
                <dot-experiments-configuration-items-count
                    [count]="vm.trafficProportion.variants.length"
                    [maxLength]="maxVariantsAllowed"
                >
                </dot-experiments-configuration-items-count>
            </div>
        </ng-template>

        <ng-container
            *ngFor="
                let variant of vm.trafficProportion.variants;
                let first = first;
                let last = last
            "
        >
            <p-card [ngClass]="{ first: first, last: last }">
                <div class="flex flex-row align-items-center align-content-between gap-2">
                    <div class="title flex flex-grow-1 flex-column">
                        <span data-testId="variant-name">{{ variant.name }}</span>
                        <span class="muted" *ngIf="variant.url" data-testId="variant-url">{{
                            variant.url
                        }}</span>
                    </div>

                    <span class="separator">|</span>

                    <p-button
                        (onClick)="changeTrafficProportionType()"
                        data-testId="variant-weight"
                        label="{{ variant.weight | number: '2.2-2' }}% {{
                            'experiments.configure.variants.weight' | dm
                        }}"
                        styleClass="p-button-sm p-button-link"
                    ></p-button>

                    <ng-container *ngIf="variant.id === defaultVariantId; else editableButtonTpl">
                        <p-button
                            (onClick)="viewVariant(variant)"
                            data-testId="variant-view-button"
                            label="{{ 'experiments.configure.variants.view' | dm }}"
                            pRipple
                            styleClass="p-button-sm p-button-outlined no-padding"
                            type="button"
                        ></p-button>
                    </ng-container>

                    <ng-template #editableButtonTpl>
                        <p-button
                            (onClick)="viewVariant(variant)"
                            data-testId="variant-view-button"
                            label="{{ 'experiments.configure.variants.edit' | dm }}"
                            pRipple
                            styleClass="p-button-sm p-button-outlined no-padding p-button-warning"
                            type="button"
                        ></p-button>
                    </ng-template>

                    <button
                        class="p-button-sm p-button-danger p-button-text"
                        [disabled]="variant.id === defaultVariantId"
                        (click)="deleteVariant(variant)"
                        label="{{ 'experiments.configure.variants.delete' | dm }}"
                        pButton
                        pRipple
                        type="button"
                    ></button>
                </div>
            </p-card>
        </ng-container>

        <ng-template pTemplate="footer">
            <p-button
                [disabled]="vm.trafficProportion.variants.length >= maxVariantsAllowed"
                (onClick)="addNewVariant()"
                label="{{ 'experiments.configure.variants.add' | dm }}"
                styleClass="p-button-sm p-button-link"
            ></p-button>
        </ng-template>
    </p-card>
</ng-container>

<ng-template dotDynamic></ng-template>
