<!-- ptabs is display flex by default -->
<p-tabs [value]="0" class="h-full">
    <p-tablist class="shrink-0">
        <p-tab [value]="0" data-testId="builder">
            {{ item.type === 'advanced' ? ('code' | dm) : ('design' | dm) }}
        </p-tab>
        <p-tab [value]="1">
            {{ 'Permissions' | dm }}
        </p-tab>
        <p-tab [value]="2">
            {{ 'History' | dm }}
        </p-tab>
    </p-tablist>
    <p-tabpanels class="!p-0 overflow-hidden grow basis-0">
        <p-tabpanel [value]="0" data-testId="builder" class="h-full block">
            @switch (item.type) {
                @case ('advanced') {
                    <dot-template-advanced
                        (updateTemplate)="updateTemplate.emit($event)"
                        (save)="save.emit($event)"
                        (cancel)="cancel.emit()"
                        [didTemplateChanged]="didTemplateChanged"
                        [body]="item.body"></dot-template-advanced>
                }
                @case ('design') {
                    <dotcms-template-builder-lib
                        class="h-full overflow-hidden flex flex-col"
                        (templateChange)="onTemplateItemChange($event)"
                        [layout]="item.layout"
                        [template]="{
                            themeId: lastTemplate.theme ?? lastTemplate.themeId,
                            identifier: lastTemplate.identifier
                        }"
                        [containerMap]="item.containers"
                        data-testId="new-template-builder">
                        <dot-global-message toolbar-left></dot-global-message>
                    </dotcms-template-builder-lib>
                }
            }
        </p-tabpanel>
        <p-tabpanel [value]="1">
            <dot-portlet-box>
                <dot-iframe [src]="permissionsUrl" data-testId="permissionsIframe"></dot-iframe>
            </dot-portlet-box>
        </p-tabpanel>
        <p-tabpanel [value]="2">
            <dot-portlet-box>
                <dot-iframe
                    (custom)="custom.emit($event)"
                    [src]="historyUrl"
                    #historyIframe
                    data-testId="historyIframe"></dot-iframe>
            </dot-portlet-box>
        </p-tabpanel>
    </p-tabpanels>
</p-tabs>
