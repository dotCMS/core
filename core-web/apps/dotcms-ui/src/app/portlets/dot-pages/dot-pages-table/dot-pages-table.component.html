@let languageIsoCodeById = $languageIsoCodeById();

<p-contextmenu
    #contextMenu
    [appendTo]="'body'"
    [model]="contextMenuItems()"
    (onHide)="contextMenuItems.set([])" />
<p-table
    (onLazyLoad)="loadPagesLazy($event)"
    (onRowSelect)="onRowSelect($event)"
    (onPage)="pageChange.emit()"
    [value]="$pages()"
    [totalRecords]="$totalRecords()"
    [lazy]="true"
    [paginator]="true"
    [rows]="40"
    [sortOrder]="-1"
    [showPageLinks]="false"
    [showCurrentPageReport]="true"
    [showFirstLastIcon]="false"
    selectionMode="single"
    sortField="modDate">
    <ng-template #caption>
        <div class="flex flex-wrap items-center justify-between gap-4">
            <div class="flex flex-wrap items-center gap-4 min-w-0">
                <div class="p-input-icon-right w-64 min-w-0">
                    <input
                        class="w-full"
                        [placeholder]="'Type-To-Search' | dm"
                        type="text"
                        [formControl]="searchControl"
                        pInputText
                        dotAutofocus />
                </div>
                <p-select
                    [formControl]="languageControl"
                    [options]="$languageOptions()"
                    class="w-56" />
                <div class="flex items-center gap-2 whitespace-nowrap">
                    <p-checkbox
                        [formControl]="archivedControl"
                        [inputId]="'show-archived'"
                        [binary]="true" />
                    <label [for]="'show-archived'">
                        {{ 'Show-Archived' | dm }}
                    </label>
                </div>
            </div>
            <p-button
                [label]="'create.page' | dm"
                styleClass="p-button-sm shrink-0"
                (onClick)="createPage.emit()" />
        </div>
    </ng-template>
    <ng-template #header>
        <tr>
            <th pSortableColumn="title" style="width: 25%">
                {{ 'title' | dm }}
                <p-sortIcon field="title" />
            </th>
            <th pSortableColumn="urlMap" style="width: 20%">
                {{ 'url' | dm }}
                <p-sortIcon field="urlMap" />
            </th>
            <th pSortableColumn="contentType" style="width: 12%">
                {{ 'type' | dm }}
                <p-sortIcon field="contentType" />
            </th>
            <th pSortableColumn="languageId" style="width: 12%">
                {{ 'status' | dm }}
                <p-sortIcon field="languageId" />
            </th>
            <th style="width: 12%">
                {{ 'Last-Editor' | dm }}
            </th>
            <th pSortableColumn="modDate" style="width: 14%">
                {{ 'Last-Edited' | dm }}
                <p-sortIcon field="modDate" />
            </th>
            <th style="width: 5%"></th>
        </tr>
    </ng-template>
    <ng-template #body let-page let-rowIndex="rowIndex">
        <tr
            [id]="'tableRow-' + rowIndex"
            [pSelectableRow]="page"
            (contextmenu)="handleContextMenu($event, page)">
            <td>{{ page['title'] }}</td>
            <td [pTooltip]="page['urlMap'] || page['url']" tooltipPosition="bottom">
                {{ page['urlMap'] || page['url'] }}
            </td>
            <td>
                {{ page['contentType'] }}
            </td>
            <td>
                <div class="flex items-center gap-2 whitespace-nowrap">
                    <dot-contentlet-status-chip [state]="page" />
                    <dot-badge [bordered]="true">
                        {{ languageIsoCodeById[page['languageId']] }}
                    </dot-badge>
                    <dot-contentlet-lock-icon [locked]="page['locked']" />
                </div>
            </td>
            <td>
                {{ page['modUserName'] }}
            </td>
            <td>{{ page['modDate'] | dotRelativeDate }}</td>
            <td>
                <p-button
                    (onClick)="handleOpenMenu($event, page)"
                    id="pageActionButton-{{ rowIndex }}"
                    icon="pi pi-ellipsis-v"
                    styleClass="p-button-rounded p-button-sm p-button-text" />
            </td>
        </tr>
    </ng-template>
    <ng-template #emptymessage>
        <tr>
            <td [attr.colspan]="7">
                <div class="flex items-center justify-center gap-2 py-8 text-surface-600">
                    @if ($isLoading()) {
                        <span class="pi pi-spinner pi-spin"></span>
                        <span>{{ 'page.listing.loading.table' | dm }}</span>
                    } @else {
                        <span>{{ 'page.listing.empty.table' | dm }}</span>
                    }
                </div>
            </td>
        </tr>
    </ng-template>
</p-table>
