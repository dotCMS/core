<div class="dot-pages__container" *ngIf="vm$ | async as vm">
    <p-panel
        [ngClass]="{
            'dot-pages-panel__expanded': vm.favoritePages.total === vm.favoritePages.items.length,
            'dot-pages-panel__hide-panel-actions': !vm.favoritePages.showLoadMoreButton,
            'dot-pages-panel__empty-state': vm.favoritePages?.items?.length === 0
        }"
        [toggleable]="true"
        [header]="'favorites' | dm"
        iconPos="start"
        expandIcon="pi pi-angle-down"
        collapseIcon="pi pi-angle-up"
    >
        <ng-template *ngIf="vm.favoritePages.showLoadMoreButton" pTemplate="icons">
            <button
                class="p-button-secondary dot-pages-panel-action__button"
                [label]="
                    vm.favoritePages.total > vm.favoritePages.items.length
                        ? ('see.all' | dm)
                        : ('see.less' | dm)
                "
                (click)="
                    toggleFavoritePagesData(
                        vm.favoritePages.total === vm.favoritePages.items.length,
                        vm.favoritePages.total
                    )
                "
                pButton
                type="button"
                data-testid="seeAllBtn"
            ></button>
        </ng-template>

        <ng-template [ngIf]="vm.favoritePages?.items?.length !== 0" [ngIfElse]="emptyState">
            <dot-pages-card
                *ngFor="let item of vm.favoritePages.items"
                [imageUri]="item.screenshot"
                [title]="item.title"
                [url]="item.url"
                [ownerPage]="item.owner === vm.loggedUserId"
                (click)="goToUrl(item.url)"
            ></dot-pages-card>
        </ng-template>

        <ng-template #emptyState>
            <dot-pages-card-empty *ngFor="let item of [1, 2, 3, 4, 5]"></dot-pages-card-empty>

            <div class="dot-pages-empty__container">
                <dot-icon name="library_add" size="40"></dot-icon>
                <div class="dot-pages-empty__header">
                    {{ 'favoritePage.listing.empty.header' | dm }}
                </div>
                <p>
                    {{ 'favoritePage.listing.empty.content' | dm }}
                </p>
            </div>
        </ng-template>
    </p-panel>

    <p-table
        [columns]="cols"
        [value]="vm.pages.items"
        [scrollable]="true"
        [rows]="40"
        [virtualScroll]="true"
        [virtualScrollItemSize]="26"
        [lazy]="true"
        [customSort]="true"
        (sortFunction)="customSort($event)"
        (onLazyLoad)="loadPagesLazy($event)"
        scrollHeight="flex"
    >
        <ng-template pTemplate="header" let-columns>
            <tr>
                <th pSortableColumn="title" style="width: 20%">
                    {{ 'title' | dm }}<p-sortIcon field="title"></p-sortIcon>
                </th>
                <th style="width: 20%">
                    {{ 'url' | dm }}
                </th>
                <th style="width: 10%">
                    {{ 'status' | dm }}
                </th>
                <th style="width: 10%">
                    {{ 'type' | dm }}
                </th>
                <th style="width: 10%">
                    {{ 'language' | dm }}
                </th>
                <th style="width: 10%">
                    {{ 'Last-Editor' | dm }}
                </th>
                <th style="width: 10%">
                    {{ 'Last-Edit-Date' | dm }}
                </th>
                <th style="width: 10%"></th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData let-columns="columns">
            <tr style="height: 26px">
                <td>
                    {{ rowData['title'] }}
                </td>
                <td>
                    {{ rowData['url'] }}
                </td>
                <td>
                    <dot-state-icon
                        [labels]="dotStateLabels"
                        [state]="rowData"
                        size="14px"
                    ></dot-state-icon>
                </td>
                <td>
                    {{ rowData['contentType'] }}
                </td>
                <td>
                    <dot-badge style="white-space: nowrap" bordered="true">{{
                        rowData['languageId']
                    }}</dot-badge>
                </td>
                <td>
                    {{ rowData['modUserName'] }}
                </td>
                <td>
                    {{ rowData['modDate'] }}
                </td>
                <td>
                    <button>*</button>
                </td>
            </tr>
        </ng-template>
        <ng-template pTemplate="loadingbody" let-columns="columns">
            <tr style="height: 26px">
                <td *ngFor="let col of columns; let even = even">
                    <p-skeleton
                        [ngStyle]="{
                            width: even ? (col.field === 'year' ? '30%' : '40%') : '60%'
                        }"
                    ></p-skeleton>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>
