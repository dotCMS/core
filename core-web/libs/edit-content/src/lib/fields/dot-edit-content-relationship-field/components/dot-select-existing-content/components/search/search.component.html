<form [formGroup]="form" #formElement>
    <p-inputgroup class="flex items-center">
        <p-inputgroup-addon>
            <i class="pi pi-search search-icon"></i>
        </p-inputgroup-addon>

        <!-- TODO: (migration): Check with design, this chips here not good, actually we don't need them if you ask me. -->
        @for (filter of $activeFilters(); track filter.value) {
            <p-chip
                [label]="filter.label"
                [removable]="true"
                (onRemove)="removeFilter(filter.type)"
                class="mr-2 p-chip-sm flex align-items-center" />
        }
        <input
            pInputText
            type="text"
            class="w-88"
            [placeholder]="'dot.file.relationship.dialog.search.placeholder' | dm"
            formControlName="query" />
        <p-inputgroup-addon>
            <p-button
                (onClick)="popover.toggle($event, formElement)"
                data-testid="open-filters-button"
                size="small"
                type="button"
                icon="pi pi-sliders-h"
                [text]="true" />
        </p-inputgroup-addon>
    </p-inputgroup>

    <p-popover #popover class="w-96">
        <div class="flex flex-col gap-6">
            <div class="flex flex-col gap-6" formGroupName="systemSearchableFields">
                <dot-language-field formControlName="languageId" />
                <dot-site-field formControlName="siteOrFolderId" />
            </div>

            <div class="flex justify-end gap-2">
                <p-button
                    (onClick)="clearForm()"
                    data-testid="clear-button"
                    [label]="'dot.file.relationship.dialog.search.btn.clear' | dm"
                    type="button"
                    size="small"
                    text="true"
                    severity="primary"
                    outline="true" />

                <p-button
                    [loading]="$isLoading()"
                    (onClick)="doSearch()"
                    data-testid="search-button"
                    [label]="'dot.file.relationship.dialog.search.btn.search' | dm"
                    size="small"
                    type="submit"
                    severity="primary" />
            </div>
        </div>
    </p-popover>
</form>
