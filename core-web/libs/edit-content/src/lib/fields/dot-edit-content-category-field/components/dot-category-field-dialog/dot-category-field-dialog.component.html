<p-dialog
    (onHide)="closedDialog.emit()"
    [(visible)]="$isVisible"
    data-testId="dialog"
    [draggable]="false"
    [resizable]="false"
    [maximizable]="false"
    [modal]="true"
    [header]="'edit.content.category-field.dialog.header.select-categories' | dm"
    styleClass="min-h-[90%] h-full w-[75vw]"
    [pt]="{ content: { class: 'h-full p-0' } }">
    <div class="flex flex-row m-auto bg-(--gray-300) p-6 gap-2 h-full w-full">
        <div class="flex flex-col flex-1 gap-2 max-w-[75vw] overflow-hidden h-full">
            <div>
                <dot-category-field-search
                    (changeMode)="store.setMode($event)"
                    (term)="store.search($event)"
                    [isLoading]="store.isSearchLoading()" />
            </div>
            <div
                class="grow border-[1.5px] border-(--gray-400) rounded-md bg-white overflow-hidden">
                @if (store.mode() === 'list') {
                    <dot-category-field-category-list
                        (itemChecked)="store.updateSelected($event.selected, $event.item)"
                        (rowClicked)="store.getCategories($event)"
                        [categories]="store.categoryList()"
                        [state]="store.listState()"
                        [selected]="store.dialogSelectedKeys()"
                        [breadcrumbs]="store.breadcrumbMenu()" />
                } @else {
                    <dot-category-field-search-list
                        (itemChecked)="store.addSelected($event)"
                        (removeItem)="store.removeSelected($event)"
                        [state]="store.searchState()"
                        [categories]="store.searchCategoryList()"
                        [selected]="store.dialog.selected()" />
                }
            </div>
        </div>

        <div
            class="flex flex-col flex-[0_0_25%] gap-2 p-4 border-[1.5px] border-(--gray-400) rounded-md bg-white overflow-hidden"
            [ngClass]="{ 'pl-0': !store.dialog.selected().length }">
            @if (store.dialog.selected().length) {
                <div class="flex-1 overflow-y-auto [scrollbar-gutter:auto]">
                    <dot-category-field-selected
                        (removeItem)="store.removeSelected($event)"
                        [categories]="store.dialog.selected()" />
                </div>
                <div class="flex justify-end">
                    <button
                        (click)="store.removeSelected(store.dialogSelectedKeys())"
                        class="p-button p-button-link"
                        data-testId="clear_all-btn"
                        pButton>
                        {{ 'edit.content.category-field.dialog.button.clear-all' | dm }}
                    </button>
                </div>
            } @else {
                <div
                    class="flex flex-col items-center justify-center h-full p-4"
                    data-testId="category-field__empty-state">
                    <i class="pi pi-check-square"></i>
                    <p class="text-center text-xs">
                        {{ 'edit.content.category-field.dialog.empty-state' | dm }}
                    </p>
                </div>
            }
        </div>
    </div>
    <ng-template pTemplate="footer">
        <p-button
            (click)="closedDialog.emit()"
            [label]="'Cancel' | dm"
            class="p-button-outlined"
            data-testId="dialog-cancel" />
        <p-button (click)="confirmCategories()" [label]="'Apply' | dm" data-testId="dialog-apply" />
    </ng-template>
</p-dialog>
