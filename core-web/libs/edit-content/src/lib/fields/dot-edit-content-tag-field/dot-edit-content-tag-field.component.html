@let field = $field();
@let variable = field.variable;
@let showLabel = $showLabel();

<dot-card-field [hasError]="hasError">
    @if (showLabel) {
        <dot-card-field-label
            [attr.data-testId]="'label-' + field.variable"
            [isRequired]="isRequired"
            [for]="field.variable">
            {{ field.name }}
        </dot-card-field-label>
    }
    <dot-card-field-content>
        <p-autoComplete
            #autocomplete
            [attr.data-testid]="'tag-field-container-' + variable"
            [id]="'tag-id-' + variable"
            [inputId]="variable"
            [suggestions]="$suggestions()"
            [class.ng-invalid]="hasError"
            [class.ng-dirty]="hasError"
            [(ngModel)]="$values"
            [ngModelOptions]="{ standalone: true }"
            [multiple]="true"
            [forceSelection]="false"
            [unique]="AUTO_COMPLETE_UNIQUE"
            [minLength]="AUTO_COMPLETE_MIN_LENGTH"
            [delay]="AUTO_COMPLETE_DELAY"
            [disabled]="$disabled()"
            (ngModelChange)="onTagsChange($event)"
            (completeMethod)="onSearch($event)"
            (keydown.enter)="onEnterKey($event)">
            <ng-template pTemplate="removetokenicon">
                <i class="pi pi-times"></i>
            </ng-template>
        </p-autoComplete>
    </dot-card-field-content>
    <dot-card-field-footer>
        @if (hasError) {
            <div class="error-message">
                @if (isRequired) {
                    <small>{{ 'dot.edit.content.form.field.required' | dm }}</small>
                }
            </div>
        }

        @if (!hasError && field.hint) {
            <div class="hint-message">
                <small [attr.data-testId]="'hint-' + field.variable">
                    {{ field.hint }}
                </small>
            </div>
        }
    </dot-card-field-footer>
</dot-card-field>
