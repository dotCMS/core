<div
    *ngIf="vm$ | async as vm"
    [ngClass]="{
        'binary-field__container--uploading': vm.status === BinaryFieldStatus.UPLOADING,
        'binary-field__container--empty': vm.status === BinaryFieldStatus.INIT
    }"
    class="binary-field__container">
    <ng-container *ngIf="vm.status === BinaryFieldStatus.INIT">
        <div
            [ngClass]="{ 'binary-field__drop-zone--active': vm.dropZoneActive }"
            class="binary-field__drop-zone">
            <dot-drop-zone
                (fileDragLeave)="setDropZoneActiveState(false)"
                (fileDragOver)="setDropZoneActiveState(true)"
                (fileDropped)="handleFileDrop($event)"
                [accept]="accept"
                [maxFileSize]="maxFileSize"
                data-testId="dropzone">
                <dot-binary-field-ui-message [uiMessage]="vm.uiMessage">
                    <button
                        (click)="openFilePicker()"
                        class="binary-field__drop-zone-btn"
                        data-testId="choose-file-btn"
                        type="button">
                        {{ 'dot.binary.field.action.choose.file' | dm }}
                    </button>
                </dot-binary-field-ui-message>
            </dot-drop-zone>
            <input
                (change)="handleFileSelection($event)"
                [accept]="accept.join(',')"
                #inputFile
                data-testId="binary-field__file-input"
                type="file" />
        </div>

        <div class="binary-field__actions">
            <p-button
                *ngIf="systemOptions.allowURLImport"
                (click)="openDialog(BinaryFieldMode.URL)"
                [label]="'dot.binary.field.action.import.from.url' | dm"
                data-testId="action-url-btn"
                icon="pi pi-link"
                styleClass="p-button-link p-button-secondary p-button-sm"></p-button>
            <p-button
                *ngIf="systemOptions.allowCodeWrite"
                (click)="openDialog(BinaryFieldMode.EDITOR)"
                [label]="'dot.binary.field.action.create.new.file' | dm"
                data-testId="action-editor-btn"
                icon="pi pi-code"
                styleClass="p-button-link p-button-secondary p-button-sm"></p-button>
        </div>
    </ng-container>

    <dot-spinner
        *ngIf="vm.status === BinaryFieldStatus.UPLOADING"
        data-testId="loading"></dot-spinner>

    <dot-binary-field-preview
        *ngIf="vm.status === BinaryFieldStatus.PREVIEW"
        (editFile)="onEditFile()"
        (editImage)="onEditImage()"
        (removeFile)="removeFile()"
        [contentlet]="vm.contentlet"
        [editableImage]="vm.isEnterprise && imageEditor"
        [tempFile]="vm.tempFile"
        [fieldVariable]="variable"
        data-testId="preview"></dot-binary-field-preview>

    <p-dialog
        [(visible)]="dialogOpen"
        [appendTo]="'body'"
        [closeOnEscape]="false"
        [draggable]="false"
        [header]="dialogHeaderMap[vm.mode] | dm"
        [keepInViewport]="false"
        [maskStyleClass]="'p-dialog-mask-transparent'"
        [modal]="true"
        [resizable]="false"
        [style]="vm.mode === BinaryFieldMode.EDITOR ? dialogFullScreenStyles : {}">
        <ng-container [ngSwitch]="vm.mode">
            <dot-binary-field-url-mode
                *ngSwitchCase="BinaryFieldMode.URL"
                (cancel)="closeDialog()"
                (tempFileUploaded)="setTempFile($event)"
                data-testId="url-mode"></dot-binary-field-url-mode>
            <dot-binary-field-editor
                *ngSwitchCase="BinaryFieldMode.EDITOR"
                (cancel)="closeDialog()"
                (tempFileUploaded)="setTempFile($event)"
                [fileName]="vm.tempFile?.fileName || vm.contentlet?.name"
                [fileContent]="vm.tempFile?.content || vm.contentlet?.content"
                [userMonacoOptions]="customMonacoOptions()"
                data-testId="editor-mode"></dot-binary-field-editor>
        </ng-container>
    </p-dialog>
</div>
