@if (vm$ | async; as vm) {
    <div
        [ngClass]="{
            'binary-field__container--uploading': vm.status === BinaryFieldStatus.UPLOADING,
            'binary-field__container--empty': vm.status === BinaryFieldStatus.INIT
        }"
        class="binary-field__container">
        @if (vm.status === BinaryFieldStatus.INIT) {
            <div
                [ngClass]="{ 'binary-field__drop-zone--active': vm.dropZoneActive }"
                class="binary-field__drop-zone">
                <dot-drop-zone
                    (fileDragLeave)="setDropZoneActiveState(false)"
                    (fileDragOver)="setDropZoneActiveState(true)"
                    (fileDropped)="handleFileDrop($event)"
                    [accept]="accept"
                    [maxFileSize]="maxFileSize"
                    data-testId="dropzone">
                    <dot-binary-field-ui-message [uiMessage]="vm.uiMessage">
                        <button
                            (click)="openFilePicker()"
                            class="binary-field__drop-zone-btn"
                            data-testId="choose-file-btn"
                            type="button">
                            {{ 'dot.binary.field.action.choose.file' | dm }}
                        </button>
                    </dot-binary-field-ui-message>
                </dot-drop-zone>
                <input
                    (change)="handleFileSelection($event)"
                    [accept]="accept.join(',')"
                    #inputFile
                    data-testId="binary-field__file-input"
                    type="file" />
            </div>
            <div class="binary-field__actions">
                @if (systemOptions.allowURLImport) {
                    <p-button
                        (click)="openDialog(BinaryFieldMode.URL)"
                        [label]="'dot.binary.field.action.import.from.url' | dm"
                        data-testId="action-url-btn"
                        icon="pi pi-link"
                        styleClass="p-button-link p-button-secondary p-button-sm"></p-button>
                }
                @if (systemOptions.allowCodeWrite) {
                    <p-button
                        (click)="openDialog(BinaryFieldMode.EDITOR)"
                        [label]="'dot.binary.field.action.create.new.file' | dm"
                        data-testId="action-editor-btn"
                        icon="pi pi-code"
                        styleClass="p-button-link p-button-secondary p-button-sm"></p-button>
                }
            </div>
        }
        @if (vm.status === BinaryFieldStatus.UPLOADING) {
            <dot-spinner data-testId="loading"></dot-spinner>
        }
        @if (vm.status === BinaryFieldStatus.PREVIEW) {
            <dot-binary-field-preview
                (editFile)="onEditFile()"
                (editImage)="onEditImage()"
                (removeFile)="removeFile()"
                [contentlet]="vm.contentlet"
                [editableImage]="vm.isEnterprise && imageEditor"
                [tempFile]="vm.tempFile"
                [fieldVariable]="variable"
                data-testId="preview"></dot-binary-field-preview>
        }
        <p-dialog
            [(visible)]="dialogOpen"
            [appendTo]="'body'"
            [closeOnEscape]="false"
            [draggable]="false"
            [header]="dialogHeaderMap[vm.mode] | dm"
            [keepInViewport]="false"
            [maskStyleClass]="'p-dialog-mask-transparent'"
            [modal]="true"
            [resizable]="false"
            [style]="vm.mode === BinaryFieldMode.EDITOR ? dialogFullScreenStyles : {}">
            @switch (vm.mode) {
                @case (BinaryFieldMode.URL) {
                    <dot-binary-field-url-mode
                        (cancel)="closeDialog()"
                        (tempFileUploaded)="setTempFile($event)"
                        data-testId="url-mode"></dot-binary-field-url-mode>
                }
                @case (BinaryFieldMode.EDITOR) {
                    <dot-binary-field-editor
                        (cancel)="closeDialog()"
                        (tempFileUploaded)="setTempFile($event)"
                        [fileName]="vm.tempFile?.fileName || vm.contentlet?.name"
                        [fileContent]="vm.tempFile?.content || vm.contentlet?.content"
                        [userMonacoOptions]="customMonacoOptions()"
                        data-testId="editor-mode"></dot-binary-field-editor>
                }
            }
        </p-dialog>
    </div>
}
