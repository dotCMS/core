@let field = $field();
@let variable = field.variable;
@let name = field.name;

@let fieldTypeConfig = $fieldTypeConfig();
@let systemTimezone = $systemTimezone();

@let showTimezoneInfo = $showTimezoneInfo();

<dot-card-field [hasError]="hasError">
    <dot-card-field-label [for]="field.variable" [isRequired]="isRequired" [for]="field.variable">
        {{ field.name }}
    </dot-card-field-label>
    <dot-card-field-content>
        <p-calendar
            class="w-full"
            [class.ng-invalid]="hasError"
            [class.ng-dirty]="hasError"
            [formControl]="internalFormControl"
            [defaultDate]="$defaultDate()"
            [timeOnly]="fieldTypeConfig.timeOnly"
            [showTime]="fieldTypeConfig.showTime"
            (onSelect)="onCalendarChange($event)"
            [id]="'calendar-id-' + variable"
            [inputId]="variable"
            [attr.data-testid]="'calendar-input-' + variable"
            [showIcon]="true"
            [icon]="fieldTypeConfig.icon"
            [showButtonBar]="true"
            [showClear]="$isExpireDateField()"
            [placeholder]="
                $isExpireDateField() ? ('edit.content.form.field.calendar.never.expires' | dm) : ''
            "
            [attr.aria-label]="name"
            [attr.aria-describedby]="field.hint ? 'hint-' + variable : null" />
    </dot-card-field-content>
    <dot-card-field-footer>
        <div
            class="flex justify-content-between align-items-center"
            data-testid="calendar-field-hints">
            <div class="flex-grow-1">
                @if (hasError) {
                    <div class="error-message">
                        @if (isRequired) {
                            <small>{{ 'dot.edit.content.form.field.required' | dm }}</small>
                        }
                    </div>
                }

                @if (!hasError && field.hint) {
                    <div class="hint-message">
                        <small
                            [attr.data-testId]="'hint-' + field.variable"
                            data-testid="calendar-field-hint">
                            {{ field.hint }}
                        </small>
                    </div>
                }
            </div>
            @if (showTimezoneInfo && systemTimezone) {
                <small class="text-gray-700" role="status" aria-live="polite">
                    {{ systemTimezone.label }}
                </small>
            }
        </div>
    </dot-card-field-footer>
</dot-card-field>
