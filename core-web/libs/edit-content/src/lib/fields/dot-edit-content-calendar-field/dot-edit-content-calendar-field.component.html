@let field = $field();
@let variable = field.variable;
@let name = field.name;

@let fieldTypeConfig = $fieldTypeConfig();
@let systemTimezone = $systemTimezone();

@let showTimezoneInfo = $showTimezoneInfo();
@let internalValue = $internalValue();
@let isDisabled = $isDisabled();

<h1>{{ hasError ? 'true' : 'false' }}</h1>

<div class="w-full" data-testid="calendar-field-container">
    <p-calendar
        class="w-full"
        [ngModel]="internalValue"
        (ngModelChange)="onCalendarChange($event)"
        [ngModelOptions]="{ standalone: true }"
        [defaultDate]="$defaultDate()"
        [timeOnly]="fieldTypeConfig.timeOnly"
        [showTime]="fieldTypeConfig.showTime"
        [disabled]="isDisabled"
        [id]="'calendar-id-' + variable"
        [inputId]="variable"
        [attr.data-testid]="'calendar-input-' + variable"
        [showIcon]="true"
        [icon]="fieldTypeConfig.icon"
        [showButtonBar]="true"
        [showClear]="$isExpireDateField()"
        [placeholder]="
            $isExpireDateField() ? ('edit.content.form.field.calendar.never.expires' | dm) : ''
        "
        [class.ng-invalid]="hasError"
        [class.ng-dirty]="hasError"
        [attr.aria-label]="name"
        [attr.aria-describedby]="field.hint ? 'hint-' + variable : null" />

    @if (field.hint || showTimezoneInfo) {
        <div
            class="flex justify-content-between align-items-center"
            data-testid="calendar-field-hints">
            <div class="flex-grow-1">
                @if (field.hint) {
                    <small
                        id="hint-{{ variable }}"
                        [attr.data-testId]="'hint-' + variable"
                        data-testid="calendar-field-hint">
                        {{ field.hint }}
                    </small>
                }
            </div>
            @if (showTimezoneInfo) {
                <div class="flex flex-column align-items-end" data-testid="calendar-field-timezone">
                    @if (systemTimezone) {
                        <small class="text-500" role="status" aria-live="polite">
                            {{ systemTimezone.label }}
                        </small>
                    }
                </div>
            }
        </div>
    }
</div>

@if (hasError) {
    <div class="error-message">
        @if (isRequired) {
            <span class="required-message">{{ 'dot.edit.content.form.field.required' | dm }}</span>
        }
    </div>
}
