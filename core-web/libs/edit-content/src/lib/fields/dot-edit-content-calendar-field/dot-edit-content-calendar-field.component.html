@let field = $field();
@let variable = field.variable;
@let name = field.name;
@let showLabel = $showLabel();
@let fieldTypeConfig = $fieldTypeConfig();
@let systemTimezone = $systemTimezone();
@let showTimezoneInfo = $showTimezoneInfo();
@let hasTimezone = showTimezoneInfo && systemTimezone;
@let hasHint = field.hint;

<dot-card-field [hasError]="hasError">
    @if (showLabel && hasHint && hasTimezone) {
        <div class="flex gap-1 align-items-center">
            <label
                [attr.data-testid]="'label-' + field.variable"
                [checkIsRequiredControl]="field.variable"
                [for]="field.variable"
                dotFieldRequired>
                {{ field.name }}
            </label>
            <i class="pi pi-info-circle text-xs" [pTooltip]="field.hint"></i>
        </div>
    }
    <dot-card-field-content>
        <p-calendar
            class="w-full"
            [class.ng-invalid]="hasError"
            [class.ng-dirty]="hasError"
            [formControl]="internalFormControl"
            [defaultDate]="$defaultDate()"
            [timeOnly]="fieldTypeConfig.timeOnly"
            [showTime]="fieldTypeConfig.showTime"
            (onSelect)="onCalendarChange($event)"
            [id]="'calendar-id-' + variable"
            [inputId]="variable"
            [attr.data-testid]="'calendar-input-' + variable"
            [showIcon]="true"
            [icon]="fieldTypeConfig.icon"
            [showButtonBar]="true"
            [showClear]="$isExpireDateField()"
            [placeholder]="
                $isExpireDateField() ? ('edit.content.form.field.calendar.never.expires' | dm) : ''
            "
            [attr.aria-label]="name"
            [attr.aria-describedby]="field.hint ? 'hint-' + variable : null" />
    </dot-card-field-content>
    <dot-card-field-footer>
        <div class="flex justify-content-between align-items-center">
            <div class="flex-grow-1">
                @if (hasError) {
                    <div class="error-message">
                        @if (isRequired) {
                            <small>{{ 'dot.edit.content.form.field.required' | dm }}</small>
                        }
                    </div>
                }

                @if (!hasError && !hasTimezone && hasHint) {
                    <div class="hint-message" data-testid="calendar-field-hints">
                        <small
                            [attr.data-testId]="'hint-' + field.variable"
                            data-testid="calendar-field-hint">
                            {{ field.hint }}
                        </small>
                    </div>
                }
                @if (!hasError && hasTimezone && hasHint) {
                    <small
                        data-testid="calendar-field-timezone"
                        class="text-gray-700"
                        role="status"
                        aria-live="polite">
                        {{ systemTimezone.label }}
                    </small>
                }
            </div>
        </div>
    </dot-card-field-footer>
</dot-card-field>
