@if ($store.isLoaded() || $store.isSaving()) {
    @let showSidebar = $store.isSidebarOpen();
    @let showSelectWorkflowWarning = $store.showSelectWorkflowWarning();
    @let lockWarningMessage = $store.lockWarningMessage();
    @let showBetaMessage = $store.isBetaMessageVisible();
    @let view = $store.uiState().view;
    @let showInvalidMessage = $store.formStatus() === 'invalid';
    @let isEnabledNewContentEditor = $store.isEnabledNewContentEditor();

    @let topBarHasMessages =
        (isEnabledNewContentEditor && showBetaMessage) ||
        lockWarningMessage ||
        showSelectWorkflowWarning;
    <div
        class="edit-content-layout__topBar flex flex-col [grid-area:topBar] [&_.p-message]:mb-2"
        [ngClass]="{ 'border-b border-[var(--gray-300)]': topBarHasMessages }"
        data-testId="edit-content-layout__topBar">
        @if (isEnabledNewContentEditor && showBetaMessage) {
            <p-message
                class="edit-content-layout__beta-message"
                [style.animation]="'slideIn 0.15s ease-out'"
                severity="info"
                data-testId="edit-content-layout__beta-message">
                <ng-template #container>
                    <div class="flex w-full items-center gap-1">
                        <i class="pi pi-info-circle shrink-0 size-4"></i>
                        <div
                            class="flex items-center mr-auto gap-1"
                            data-testId="edit-content-layout__beta-message-content">
                            {{ 'edit.content.layout.back.to.old.edit.content' | dm }}
                            <a
                                href="#"
                                (click)="$event.preventDefault(); $store.disableNewContentEditor()"
                                data-testId="edit-content-layout__beta-message-link">
                                {{ 'edit.content.layout.back.to.old.edit.content.switch' | dm }}
                            </a>
                            {{ 'edit.content.layout.back.to.old.edit.content.subtitle' | dm }}
                        </div>

                        <p-button
                            type="button"
                            icon="pi pi-times"
                            (onClick)="closeMessage('betaMessage')"
                            [rounded]="true"
                            [text]="true"
                            data-testId="edit-content-layout__beta-message-close-button"
                            severity="info"
                            size="small" />
                    </div>
                </ng-template>
            </p-message>
        }

        @if (lockWarningMessage) {
            <p-message severity="warn" data-testId="edit-content-layout__lock-warning">
                <ng-template pTemplate>
                    <div class="flex w-full items-center gap-1">
                        <i class="pi pi-exclamation-triangle shrink-0 size-4"></i>
                        <div
                            class="flex items-center mr-auto gap-1"
                            data-testId="edit-content-layout__lock-warning-content"
                            [innerHTML]="lockWarningMessage"></div>
                    </div>
                </ng-template>
            </p-message>
        }

        @if (showSelectWorkflowWarning) {
            <p-message
                [style.animation]="'slideIn 0.15s ease-out'"
                severity="warn"
                data-testId="edit-content-layout__select-workflow-warning">
                <ng-template pTemplate>
                    <div class="flex w-full items-center gap-1">
                        <i class="pi pi-info-circle shrink-0 size-4"></i>
                        <div class="flex items-center mr-auto gap-1">
                            <span
                                [innerHTML]="
                                    ('edit.content.layout.select.workflow.warning' | dm) + ' '
                                "></span>
                            <a
                                href="#"
                                data-testId="select-workflow-link"
                                (click)="$event.preventDefault(); selectWorkflow()">
                                {{ 'edit.content.layout.select.workflow.warning.switch' | dm }}
                            </a>
                            <span
                                [innerHTML]="
                                    ('edit.content.layout.select.workflow.warning.subtitle' | dm) +
                                    ' '
                                "></span>
                        </div>
                    </div>
                </ng-template>
            </p-message>
        }

        @if (showInvalidMessage) {
            <p-message severity="error" data-testId="edit-content-layout__lock-warning">
                <ng-template pTemplate>
                    <div class="flex w-full items-center gap-1">
                        <i class="pi pi-times-circle shrink-0 size-4"></i>
                        <div
                            class="flex items-center mr-auto gap-1"
                            data-testId="edit-content-layout__lock-warning-content">
                            {{ 'edit.content.layout.invalid.message' | dm }}
                        </div>
                    </div>
                </ng-template>
            </p-message>
        }
    </div>

    @if (view === 'form') {
        @defer (when view === 'form') {
            <dot-edit-content-form
                data-testId="edit-content-layout__body"
                (changeValue)="onFormChange($event)"
                class="edit-content-layout__body min-w-0 overflow-x-hidden [grid-area:body]" />
        }
    } @else if (view === 'compare') {
        @defer (when view === 'compare') {
            <dot-edit-content-compare
                class="edit-content-layout__body min-w-0 overflow-x-hidden [grid-area:body]" />
        }
    }

    @if (showSidebar) {
        @defer (when showSidebar) {
            <dot-edit-content-sidebar
                [(showDialog)]="$showDialog"
                data-testId="edit-content-layout__sidebar"
                class="edit-content-layout__sidebar min-w-0 overflow-x-hidden [grid-area:sidebar]" />
        }
    }
}

<p-confirmDialog />
