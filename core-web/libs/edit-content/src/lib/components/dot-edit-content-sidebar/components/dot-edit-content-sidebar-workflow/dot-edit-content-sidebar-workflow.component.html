@let scheme = $workflow().scheme;
@let task = $workflow().task;

@let isLoading = $isLoading();
@let noWorkflowSelectedYet = $noWorkflowSelectedYet();
@let currentStep = $workflow().step;
@let showResetAction = $showResetAction();

<dl class="workflow-list">
    <dt class="workflow-column__title" id="workflow-title">{{ 'Workflow' | dm }}</dt>
    <dd
        class="workflow-column__description"
        aria-labelledby="workflow-title"
        data-testId="workflow-name">
        @if (isLoading) {
            <p-skeleton />
        } @else if (noWorkflowSelectedYet) {
            <a
                href="#"
                class="select-workflow-link"
                data-testId="select-workflow-link"
                (click)="$event.preventDefault(); showDialog()"
                tabindex="0">
                {{ 'Select Workflow' | dm }}
            </a>
        } @else {
            {{ scheme?.name }}

            <!-- Show the workflow dialog selection icon -->
            @if ($showWorkflowDialogIcon()) {
                <p-button
                    [pTooltip]="'edit.content.sidebar.workflow.change' | dm"
                    data-testId="workflow-dialog-icon"
                    (click)="showDialog()"
                    pButton
                    styleClass="p-button-link"
                    icon="pi pi-pencil"></p-button>
            }

            <!-- Show the reset action button -->
            @if (showResetAction.showReset) {
                <p-button
                    [pTooltip]="'edit.content.sidebar.workflow.reset' | dm"
                    data-testId="workflow-reset-action"
                    (click)="onResetWorkflow.emit(showResetAction.resetAction)"
                    pButton
                    styleClass="p-button-link"
                    icon="pi pi-replay"></p-button>
            }
        }
    </dd>

    @if (!noWorkflowSelectedYet) {
        <dt class="workflow-column__title" id="step-title">{{ 'Step' | dm }}</dt>
        <dd
            class="workflow-column__description"
            aria-labelledby="step-title"
            data-testId="workflow-step">
            @if (isLoading) {
                <p-skeleton />
            } @else {
                {{ currentStep?.name }}
            }
        </dd>

        @if (task) {
            <dt class="workflow-column__title" id="assignee-title">{{ 'Assignee' | dm }}</dt>
            <dd
                class="workflow-column__description"
                aria-labelledby="assignee-title"
                data-testId="workflow-assigned">
                @if (isLoading) {
                    <p-skeleton />
                } @else {
                    {{ task.assignedTo }}
                }
            </dd>
        }
    }
</dl>

<!-- Dialog to select workflow -->
@defer (when $showDialog()) {
    <p-dialog
        [(visible)]="$showDialog"
        [modal]="true"
        [style]="{ width: '550px' }"
        header="{{ 'edit.content.layout.select.workflow.warning.switch' | dm }}"
        [closable]="true">
        <div class="p-fluid">
            <div class="field">
                <label for="workflow">
                    {{ 'edit.content.sidebar.workflow.dialog.title' | dm }}
                </label>
                <p-dropdown
                    id="workflow"
                    appendTo="body"
                    [options]="$workflowSchemeOptions()"
                    optionLabel="label"
                    [(ngModel)]="$selectedWorkflow"
                    placeholder="{{
                        'edit.content.sidebar.workflow.dialog.dropdown.placeholder' | dm
                    }}"></p-dropdown>
            </div>
        </div>
        <ng-template pTemplate="footer">
            <p-button
                label="{{ 'Cancel' | dm }}"
                (onClick)="closeDialog()"
                styleClass="p-button-text"></p-button>
            <p-button label="{{ 'Select' | dm }}" (onClick)="selectWorkflow()"></p-button>
        </ng-template>
    </p-dialog>
}
