@let icon = $icon();
@let subtitle = $subtitle();

<p-card
    class="h-full metric-card"
    [ngClass]="{
        'metric-card--loading': $isLoading(),
        'metric-card--empty': $isEmpty(),
        'metric-card--error': $isError()
    }"
    data-testid="metric-card">
    @if ($isError()) {
        <!-- Error state -->
        <div class="flex flex-column justify-content-between h-full gap-3">
            <!-- Header with title and icon -->
            <div class="flex justify-content-between align-items-start">
                <h3 class="metric-title" data-testid="metric-title">
                    {{ $name() | dm }}
                </h3>
                @if (icon) {
                    <i
                        [class]="$iconClasses()"
                        class="metric-icon pi icon-md"
                        data-testid="metric-icon"></i>
                }
            </div>

            <!-- Error message centered -->
            <div class="flex flex-column justify-content-center align-items-center flex-1">
                <dot-analytics-state-message
                    message="analytics.metrics.error.reload"
                    icon="pi-exclamation-triangle" />
            </div>
        </div>
    } @else if ($isEmpty()) {
        <!-- Empty state -->
        <div class="flex flex-column justify-content-between h-full gap-3">
            <!-- Header with title and icon -->
            <div class="flex justify-content-between align-items-start">
                <h3 class="metric-title" data-testid="metric-title">
                    {{ $name() | dm }}
                </h3>
                @if (icon) {
                    <i
                        [class]="$iconClasses()"
                        class="metric-icon pi icon-md"
                        data-testid="metric-icon"></i>
                }
            </div>

            <!-- Empty message centered -->
            <div class="flex flex-column justify-content-center align-items-center flex-1">
                <dot-analytics-state-message
                    message="analytics.metrics.empty.insufficient-data"
                    icon="pi-info-circle" />
            </div>
        </div>
    } @else if ($isLoading()) {
        <!-- Loading state with skeleton -->
        <div class="flex flex-column justify-content-between h-full gap-3">
            <!-- Header with title and icon skeletons -->
            <div class="flex justify-content-between align-items-start">
                <p-skeleton width="10rem" height="1.15rem"></p-skeleton>
                @if (icon) {
                    <p-skeleton width="1.5rem" height="1.5rem" shape="circle"></p-skeleton>
                }
            </div>

            <!-- Skeleton content -->
            <div class="flex flex-column gap-3">
                <!-- Skeleton value -->
                <p-skeleton width="1.5rem" height="1.2rem"></p-skeleton>
            </div>

            <!-- Skeleton subtitle -->
            <p-skeleton width="10rem" height="0.75rem"></p-skeleton>
        </div>
    } @else {
        <!-- Normal content - only shown when LOADED -->
        <div class="flex flex-column justify-content-between h-full gap-3">
            <!-- Header with title and icon -->
            <div class="flex justify-content-between align-items-start">
                <h3 class="metric-title" data-testid="metric-title">
                    {{ $name() | dm }}
                </h3>
                @if (icon) {
                    <i
                        [class]="$iconClasses()"
                        class="metric-icon pi icon-md"
                        data-testid="metric-icon"></i>
                }
            </div>

            <!-- Contenido principal -->
            <div class="flex flex-column gap-3">
                <div class="metric-value" data-testid="metric-value">
                    {{ $formattedValue() }}
                </div>
            </div>

            <!-- SubtÃ­tulo -->
            @if (subtitle) {
                <div class="metric-subtitle" data-testid="metric-subtitle">
                    {{ subtitle | dm }}
                </div>
            }
        </div>
    }
</p-card>
