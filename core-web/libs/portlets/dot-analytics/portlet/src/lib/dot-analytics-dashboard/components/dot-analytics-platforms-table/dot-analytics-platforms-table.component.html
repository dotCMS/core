@let isLoading = $isLoading();
@let deviceData = $deviceData();
@let browserData = $browserData();
@let languageData = $languageData();

<p-card class="platforms-card h-full">
    <p-tabs value="device">
        <p-tablist>
            <p-tab value="device">{{ 'analytics.engagement.platforms.device' | dm }}</p-tab>
            <p-tab value="browser">{{ 'analytics.engagement.platforms.browser' | dm }}</p-tab>
            <p-tab value="language">{{ 'analytics.engagement.platforms.language' | dm }}</p-tab>
        </p-tablist>

        <p-tabpanels>
            <!-- Device Tab -->
            <p-tabpanel value="device">
                @if (isLoading) {
                    <ng-container [ngTemplateOutlet]="skeletonTable" />
                } @else {
                    <p-table [value]="deviceData" styleClass="platforms-table">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>{{ 'analytics.engagement.table.headers.device' | dm }}</th>
                                <th>{{ 'analytics.engagement.table.headers.views' | dm }}</th>
                                <th class="text-right">
                                    {{ 'analytics.engagement.table.headers.time' | dm }}
                                </th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-device>
                            <tr>
                                <td class="font-medium">{{ device.name }}</td>
                                <td>
                                    <div class="views-cell">
                                        <div class="views-bar-row">
                                            <p-progressBar
                                                [value]="device.percentage"
                                                [showValue]="false"
                                                styleClass="views-progress" />
                                            <span class="views-percentage">
                                                {{ device.percentage }}%
                                            </span>
                                        </div>
                                        <span class="views-count text-color-secondary">
                                            {{ device.views | number }}
                                            {{ 'analytics.engagement.table.sessions-suffix' | dm }}
                                        </span>
                                    </div>
                                </td>
                                <td class="text-right">{{ device.time }}</td>
                            </tr>
                        </ng-template>
                    </p-table>
                }
            </p-tabpanel>

            <!-- Browser Tab -->
            <p-tabpanel value="browser">
                @if (isLoading) {
                    <ng-container [ngTemplateOutlet]="skeletonTable" />
                } @else {
                    <p-table [value]="browserData" styleClass="platforms-table">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>{{ 'analytics.engagement.table.headers.browser' | dm }}</th>
                                <th>{{ 'analytics.engagement.table.headers.views' | dm }}</th>
                                <th class="text-right">
                                    {{ 'analytics.engagement.table.headers.time' | dm }}
                                </th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-browser>
                            <tr>
                                <td class="font-medium">{{ browser.name }}</td>
                                <td>
                                    <div class="views-cell">
                                        <div class="views-bar-row">
                                            <p-progressBar
                                                [value]="browser.percentage"
                                                [showValue]="false"
                                                styleClass="views-progress" />
                                            <span class="views-percentage">
                                                {{ browser.percentage }}%
                                            </span>
                                        </div>
                                        <span class="views-count text-color-secondary">
                                            {{ browser.views | number }}
                                            {{ 'analytics.engagement.table.sessions-suffix' | dm }}
                                        </span>
                                    </div>
                                </td>
                                <td class="text-right">{{ browser.time }}</td>
                            </tr>
                        </ng-template>
                    </p-table>
                }
            </p-tabpanel>

            <!-- Language Tab -->
            <p-tabpanel value="language">
                @if (isLoading) {
                    <ng-container [ngTemplateOutlet]="skeletonTable" />
                } @else {
                    <p-table [value]="languageData" styleClass="platforms-table">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>{{ 'analytics.engagement.table.headers.language' | dm }}</th>
                                <th>{{ 'analytics.engagement.table.headers.views' | dm }}</th>
                                <th class="text-right">
                                    {{ 'analytics.engagement.table.headers.time' | dm }}
                                </th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-lang>
                            <tr>
                                <td class="font-medium">{{ lang.name }}</td>
                                <td>
                                    <div class="views-cell">
                                        <div class="views-bar-row">
                                            <p-progressBar
                                                [value]="lang.percentage"
                                                [showValue]="false"
                                                styleClass="views-progress" />
                                            <span class="views-percentage">
                                                {{ lang.percentage }}%
                                            </span>
                                        </div>
                                        <span class="views-count text-color-secondary">
                                            {{ lang.views | number }}
                                            {{ 'analytics.engagement.table.sessions-suffix' | dm }}
                                        </span>
                                    </div>
                                </td>
                                <td class="text-right">{{ lang.time }}</td>
                            </tr>
                        </ng-template>
                    </p-table>
                }
            </p-tabpanel>
        </p-tabpanels>
    </p-tabs>
</p-card>

<!-- Skeleton Table Template -->
<ng-template #skeletonTable>
    <div class="skeleton-table">
        <!-- Header skeleton -->
        <div class="skeleton-row skeleton-header">
            <p-skeleton width="5rem" height="1rem" />
            <p-skeleton width="6rem" height="1rem" />
            <div class="flex justify-content-end">
                <p-skeleton width="4rem" height="1rem" />
            </div>
        </div>
        <!-- Body rows skeleton -->
        @for (i of [1, 2, 3]; track i) {
            <div class="skeleton-row">
                <p-skeleton width="5rem" height="1rem" />
                <div class="flex flex-column gap-1">
                    <p-skeleton width="6rem" height="1rem" />
                    <p-skeleton width="100%" height="0.5rem" />
                </div>
                <div class="flex justify-content-end">
                    <p-skeleton width="4rem" height="1rem" />
                </div>
            </div>
        }
    </div>
</ng-template>
