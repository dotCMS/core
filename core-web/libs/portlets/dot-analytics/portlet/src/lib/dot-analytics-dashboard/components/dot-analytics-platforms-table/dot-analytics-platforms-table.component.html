@let isLoading = $isLoading();
@let deviceData = $deviceData();
@let browserData = $browserData();
@let languageData = $languageData();

<p-card class="platforms-card h-full">
    <p-tabView>
        <!-- Device Tab -->
        <p-tabPanel [header]="'analytics.engagement.platforms.device' | dm">
            @if (isLoading) {
                <ng-container [ngTemplateOutlet]="skeletonTable" />
            } @else {
                <p-table [value]="deviceData" class="p-datatable-sm">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>{{ 'analytics.engagement.table.headers.device' | dm }}</th>
                            <th>{{ 'analytics.engagement.table.headers.views' | dm }}</th>
                            <th class="text-right">
                                {{ 'analytics.engagement.table.headers.time' | dm }}
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-device>
                        <tr>
                            <td>{{ device.name }}</td>
                            <td>
                                <div class="flex flex-column gap-1">
                                    <span>
                                        {{ device.views | number }}
                                        {{ 'analytics.engagement.table.sessions-suffix' | dm }}
                                    </span>
                                    <p-progressBar
                                        [value]="device.percentage"
                                        [showValue]="false"
                                        styleClass="h-1rem" />
                                </div>
                            </td>
                            <td class="text-right">{{ device.time }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            }
        </p-tabPanel>

        <!-- Browser Tab -->
        <p-tabPanel [header]="'analytics.engagement.platforms.browser' | dm">
            @if (isLoading) {
                <ng-container [ngTemplateOutlet]="skeletonTable" />
            } @else {
                <p-table [value]="browserData" class="p-datatable-sm">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>{{ 'analytics.engagement.table.headers.browser' | dm }}</th>
                            <th>{{ 'analytics.engagement.table.headers.views' | dm }}</th>
                            <th class="text-right">
                                {{ 'analytics.engagement.table.headers.time' | dm }}
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-browser>
                        <tr>
                            <td>{{ browser.name }}</td>
                            <td>
                                <div class="flex flex-column gap-1">
                                    <span>
                                        {{ browser.views | number }}
                                        {{ 'analytics.engagement.table.sessions-suffix' | dm }}
                                    </span>
                                    <p-progressBar
                                        [value]="browser.percentage"
                                        [showValue]="false"
                                        styleClass="h-1rem" />
                                </div>
                            </td>
                            <td class="text-right">{{ browser.time }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            }
        </p-tabPanel>

        <!-- Language Tab -->
        <p-tabPanel [header]="'analytics.engagement.platforms.language' | dm">
            @if (isLoading) {
                <ng-container [ngTemplateOutlet]="skeletonTable" />
            } @else {
                <p-table [value]="languageData" class="p-datatable-sm">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>{{ 'analytics.engagement.table.headers.language' | dm }}</th>
                            <th>{{ 'analytics.engagement.table.headers.views' | dm }}</th>
                            <th class="text-right">
                                {{ 'analytics.engagement.table.headers.time' | dm }}
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-lang>
                        <tr>
                            <td>{{ lang.name }}</td>
                            <td>
                                <div class="flex flex-column gap-1">
                                    <span>
                                        {{ lang.views | number }}
                                        {{ 'analytics.engagement.table.sessions-suffix' | dm }}
                                    </span>
                                    <p-progressBar
                                        [value]="lang.percentage"
                                        [showValue]="false"
                                        styleClass="h-1rem" />
                                </div>
                            </td>
                            <td class="text-right">{{ lang.time }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            }
        </p-tabPanel>
    </p-tabView>
</p-card>

<!-- Skeleton Table Template -->
<ng-template #skeletonTable>
    <div class="skeleton-table">
        <!-- Header skeleton -->
        <div class="skeleton-row skeleton-header">
            <p-skeleton width="5rem" height="1rem" />
            <p-skeleton width="6rem" height="1rem" />
            <div class="flex justify-content-end">
                <p-skeleton width="4rem" height="1rem" />
            </div>
        </div>
        <!-- Body rows skeleton -->
        @for (i of [1, 2, 3]; track i) {
            <div class="skeleton-row">
                <p-skeleton width="5rem" height="1rem" />
                <div class="flex flex-column gap-1">
                    <p-skeleton width="6rem" height="1rem" />
                    <p-skeleton width="100%" height="0.5rem" />
                </div>
                <div class="flex justify-content-end">
                    <p-skeleton width="4rem" height="1rem" />
                </div>
            </div>
        }
    </div>
</ng-template>
