<ng-container *ngIf="vm$ | async as vm">
    <dot-edit-ema-toolbar>
        <ng-container left>
            <p-button label="Preview" icon="pi pi-desktop" styleClass="p-button-text p-button-sm" />
            <p-button label="Bookmark" icon="pi pi-star" styleClass="p-button-text p-button-sm" />
            <p-button
                [cdkCopyToClipboard]="vm.iframeUrl"
                [label]="'editpage.header.copy' | dm"
                (onClick)="triggerCopyToast()"
                icon="pi pi-copy"
                styleClass="p-button-text p-button-sm"
                data-testId="ema-copy-url" />
            <a
                class="p-button-sm p-button-text"
                [href]="vm.apiURL"
                [title]="vm.apiURL"
                pButton
                target="_blank"
                data-testId="ema-api-link">
                <i class="pi pi-link"></i>
                <span class="p-button-label">API</span>
            </a>
        </ng-container>
        <ng-container right>
            <dot-edit-ema-language-selector
                [language]="vm.editor.viewAs.language"
                (selected)="onLanguageSelected($event)"
                data-testId="language-selector" />
            <dot-edit-ema-persona-selector
                #personaSelector
                [pageID]="vm.editor.page.identifier"
                [value]="vm.selectedPersona"
                (selected)="onPersonaSelected($event)"
                data-testId="persona-selector" />
            <p-button class="p-button-sm" label="Save" />
        </ng-container>
    </dot-edit-ema-toolbar>
    <div class="iframe-wrapper">
        <iframe
            #iframe
            [src]="vm.iframeUrl | safeUrl"
            [title]="host"
            data-testId="iframe"
            style="border: none"
            width="100%"
            height="100%"></iframe>
    </div>
    <p-dialog
        #dialog
        [visible]="vm.dialogVisible"
        [style]="{ height: '90vh', width: '90vw' }"
        [header]="vm.dialogHeader"
        [draggable]="false"
        [resizable]="false"
        [maximizable]="true"
        [modal]="true"
        (visibleChange)="resetDialogIframeData()"
        data-testId="dialog">
        <iframe
            #dialogIframe
            [style]="{ border: 'none', display: vm.dialogIframeLoading ? 'none' : 'block' }"
            [src]="vm.dialogIframeURL | safeUrl"
            (load)="onIframeLoad($event)"
            title="dialog"
            data-testId="dialog-iframe"
            width="100%"
            height="100%"></iframe>
        <dot-spinner *ngIf="vm.dialogIframeLoading" data-testId="spinner"></dot-spinner>
    </p-dialog>

    <p-confirmDialog
        [style]="{
            width: '400px'
        }"
        [rejectIcon]="null"
        [acceptIcon]="null"
        rejectButtonStyleClass="p-button-outlined"
        data-testId="confirm-dialog"></p-confirmDialog>
</ng-container>
<p-toast position="top-center" data-testId="ema-toast"></p-toast>
