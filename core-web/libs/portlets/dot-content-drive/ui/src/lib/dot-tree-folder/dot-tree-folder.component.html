@let loading = $loading();

@if (!loading) {
    <p-tree
        [value]="$folders()"
        [loading]="loading"
        selectionMode="multiple"
        loadingMode="icon"
        [class]="treeStyleClasses()"
        [selection]="$selectedNode()"
        [scrollHeight]="'auto'"
        [metaKeySelection]="true"
        [pt]="{
            root: { class: 'w-full h-full border-none overflow-y-auto' },
            nodeLabel: { class: 'overflow-hidden text-ellipsis whitespace-nowrap' }
        }"
        (onNodeSelect)="onNodeSelect.emit($event)"
        (onNodeExpand)="onNodeExpand.emit($event)"
        (onNodeCollapse)="onNodeCollapse.emit($event)">
        <ng-template let-node pTemplate="default">
            <span
                data-testid="tree-node-label"
                [attr.data-json-node]="node.data | json"
                class="font-normal text-lg"
                [class.active]="$activeDropNode()?.id === node?.data.id">
                {{ node.key === ALL_FOLDER_KEY ? (node.label | dm) : (node.label | folderName) }}
            </span>
        </ng-template>
        <!-- LOADING WONT WORK WITH CUSTOM TEMPLATE: https://github.com/primefaces/primeng/blob/v17/src/app/components/tree/tree.ts#L113 -->
        <ng-template pTemplate="togglericon" let-expanded>
            <span class="toggler-regular">
                <i
                    class="pi text-sm text-(--color-palette-gray-600)"
                    [class]="expanded ? 'pi-chevron-down' : 'pi-chevron-right'"></i>
            </span>
            <span class="toggler-first">
                <i
                    class="pi text-(--color-palette-gray-800)"
                    [class]="expanded ? 'pi-folder-open' : 'pi-folder'"></i>
            </span>
        </ng-template>
    </p-tree>
} @else {
    <div
        class="flex flex-col items-center justify-center h-full w-full gap-6 font-normal select-none pointer-events-none">
        <div class="pulse-container relative inline-block">
            <i class="pi pi-folder text-[64px] text-(--gray-400) z-1"></i>
        </div>
        <span class="text-base">{{ 'content.drive.loading.folders.title' | dm }}</span>
    </div>
}
