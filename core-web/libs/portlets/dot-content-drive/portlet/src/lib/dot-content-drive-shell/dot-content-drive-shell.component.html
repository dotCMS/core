@if ($showMessage()) {
    <p-message severity="info" data-testid="message">
        <ng-template pTemplate="content">
            <div class="flex items-center justify-between gap-2 w-full">
                <div class="flex items-center gap-2">
                    <i class="pi pi-info-circle"></i>
                    <span data-testid="message-content">
                        {{ 'content-drive.feature.state' | dm }}
                        <b>{{ 'development' | dm }}</b>
                    </span>
                </div>
                <div class="flex items-center gap-2">
                    <a
                        href="https://community.dotcms.com/t/check-out-an-early-version-of-our-content-drive/242?u=marcboutillette"
                        target="_blank"
                        data-testid="learn-more-link">
                        {{ 'content-drive.feature.learn-more' | dm }}
                    </a>
                    <p-button
                        styleClass="p-button-text p-button-rounded p-button-sm p-button-icon-only"
                        type="button"
                        icon="pi pi-times"
                        data-testid="close-message"
                        (click)="onCloseMessage()"></p-button>
                </div>
            </div>
        </ng-template>
    </p-message>
}

<dot-content-drive-toolbar (addNewDotAsset)="onAddNewDotAsset()" data-testid="toolbar" />

<div
    class="tree-selector flex flex-col justify-center items-center text-xl font-semibold overflow-hidden transition-all duration-300 ease-in-out w-0 border-r border-gray-300"
    [class.invisible]="!$treeExpanded()"
    [class.visible]="$treeExpanded()"
    [class.expanded]="$treeExpanded()"
    data-testid="tree-selector">
    <dot-content-drive-sidebar
        data-testid="sidebar"
        (uploadFiles)="resolveFilesUpload($event)"
        (moveItems)="onMoveItems($event)" />
</div>

<dot-content-drive-dropzone data-testid="dropzone" (uploadFiles)="resolveFilesUpload($event)">
    <dot-folder-list-view
        [items]="$items()"
        [totalItems]="$totalItems()"
        [loading]="$loading()"
        [offset]="$offset()"
        (paginate)="onPaginate($event)"
        (sort)="onSort($event)"
        (selectionChange)="onSelectItems($event)"
        (rightClick)="onContextMenu($event)"
        (doubleClick)="onDoubleClick($event)"
        (dragStart)="onDragStart($event)"
        (dragEnd)="onDragEnd()"
        (drop)="onTableDrop($event)"
        #listView />
</dot-content-drive-dropzone>
<dot-folder-list-context-menu />

<p-toast position="top-center" data-testId="content-drive-toast">
    <ng-template let-message pTemplate="message">
        <span
            class="p-toast-message-icon"
            [attr.aria-hidden]="true"
            [attr.data-pc-section]="'icon'">
            <dot-severity-icon [severity]="message.severity" />
        </span>
        <div class="p-toast-message-text">
            <span class="p-toast-summary" innerHtml="{{ message.summary }}"></span>
            <span class="p-toast-detail" innerHtml="{{ message.detail }}"></span>
        </div>
    </ng-template>
</p-toast>

@if ($contextMenuData()?.showAddToBundle) {
    <dot-add-to-bundle
        (cancel)="cancelAddToBundle()"
        [assetIdentifier]="$contextMenuData().contentlet.identifier" />
}

<!-- Just placeholders for now. Let's leave it here so we can maintain the layout. But we are not going to use for this version. -->
<div class="detail-view flex flex-col justify-center items-center text-xl font-semibold"></div>
<p-dialog
    [visible]="!!$dialog()"
    [header]="$dialog()?.header"
    [draggable]="false"
    [resizable]="false"
    [modal]="true"
    appendTo="body"
    data-testId="dialog"
    styleClass="content-drive-dialog"
    (visibleChange)="onHideDialog()">
    @switch ($dialog()?.type) {
        @case (DIALOG_TYPE.FOLDER) {
            <dot-content-drive-dialog-folder
                data-testId="dialog-folder"
                [folder]="$dialog()?.payload" />
        }
        @default {
            <div>Default dialog</div>
        }
    }
</p-dialog>

<!-- Is pending to add the accept attribute. This will be come from the backend in the future. -->
<input type="file" (change)="onFileChange($event)" #fileInput hidden />
