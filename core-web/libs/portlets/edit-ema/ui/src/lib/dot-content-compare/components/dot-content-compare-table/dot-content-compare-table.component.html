@if (data) {
    <p-table [value]="data.fields" styleClass="p-datatable-gridlines">
        <ng-template pTemplate="header">
            <tr>
                <th></th>
                <th>
                    <span class="dot-content-compare-table__title" data-testId="table-tittle">
                        {{ 'edit.content.sidebar.history.menu.current' | dm }}
                    </span>
                </th>
                <th>
                    <div class="flex flex-column gap-2">
                        <div class="flex">
                            <span
                                class="dot-content-compare-table__title"
                                data-testId="table-tittle">
                                {{ 'edit.content.sidebar.history.menu.previous' | dm }}
                            </span>
                        </div>
                        @if ($showActions()) {
                            <div class="dot-content-compare-table__controls">
                                <p-select
                                    (onChange)="changeVersion.emit($event.value)"
                                    [options]="data.versions"
                                    data-testid="versions-dropdown"
                                    appendTo="body">
                                    <ng-template let-selected pTemplate="selectedItem">
                                        {{
                                            (selected.modDate
                                                | dotRelativeDate: 'MM/dd/yyyy - hh:mm aa') +
                                                (' by ' | dm) +
                                                selected.modUserName
                                        }}
                                    </ng-template>
                                    <ng-template let-item pTemplate="item">
                                        {{
                                            (item.modDate
                                                | dotRelativeDate: 'MM/dd/yyyy - hh:mm aa') +
                                                (' by ' | dm) +
                                                item.modUserName
                                        }}
                                    </ng-template>
                                </p-select>
                                <p-selectButton
                                    (onChange)="changeDiff.emit($event.value)"
                                    [(ngModel)]="showDiff"
                                    [options]="displayOptions"
                                    class="p-button-compact"
                                    data-testid="show-diff"></p-selectButton>
                                <button
                                    (click)="bringBack.emit(data.compare.inode)"
                                    [label]="'Bring-Back' | dm"
                                    class="p-button-sm p-button"
                                    data-testId="table-bring-back"
                                    pButton></button>
                            </div>
                        }
                    </div>
                </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-field>
            <tr>
                <td>{{ field.name }}</td>
                @switch (field?.fieldType) {
                    @case ('Image') {
                        <td>
                            @if (data.working[field.variable]) {
                                <img
                                    [alt]="data.working[field.variable]"
                                    [src]="'/dA/' + data.working[field.variable] + '/20q'"
                                    data-testId="table-image-working" />
                            }
                        </td>
                        <td>
                            @if (data.compare[field.variable]) {
                                <img
                                    [alt]="data.compare[field.variable]"
                                    [src]="'/dA/' + data.compare[field.variable] + '/20q'"
                                    data-testId="table-image-compare" />
                            }
                        </td>
                    }
                    @case ('File') {
                        <td>
                            @if (data.working[field.variable]) {
                                <dot-content-compare-preview-field
                                    [fileURL]="
                                        '/dA/' + data.working[field.variable] + '/fileAsset/'
                                    "
                                    [label]="'/dA/' + data.working[field.variable] + '/fileAsset/'"
                                    data-testId="table-file-working" />
                            }
                        </td>
                        <td>
                            @if (data.compare[field.variable]) {
                                <dot-content-compare-preview-field
                                    [fileURL]="
                                        '/dA/' + data.compare[field.variable] + '/fileAsset/'
                                    "
                                    [label]="
                                        '/dA/' + data.working[field.variable] + '/fileAsset/'
                                            | dotDiff
                                                : '/dA/' +
                                                      data.compare[field.variable] +
                                                      '/fileAsset/'
                                                : showDiff
                                    "
                                    data-testId="table-file-compare" />
                            }
                        </td>
                    }
                    @case ('Binary') {
                        <td>
                            @if (data.working[field.variable + 'Version']) {
                                <dot-content-compare-preview-field
                                    [fileURL]="data.working[field.variable + 'Version']"
                                    [label]="data.working[field.variable + 'Version']"
                                    data-testId="table-binary-working" />
                            }
                        </td>
                        <td>
                            @if (data.compare[field.variable + 'Version']) {
                                <dot-content-compare-preview-field
                                    [fileURL]="data.compare[field.variable + 'Version']"
                                    [label]="
                                        data.working[field.variable + 'Version']
                                            | dotDiff
                                                : data.compare[field.variable + 'Version']
                                                : showDiff
                                    "
                                    data-testId="table-binary-compare" />
                            }
                        </td>
                    }
                    @case ('JSON-Field') {
                        <td
                            [innerHTML]="data.working[field.variable] | json"
                            data-testId="table-json-working"></td>
                        <td
                            [innerHTML]="
                                data.working[field.variable]
                                    | json
                                    | dotDiff: (data.compare[field.variable] | json) : showDiff
                            "
                            data-testId="table-json-compare"></td>
                    }
                    @case ('Story-Block') {
                        <td>
                            <dot-content-compare-block-editor
                                [field]="field.variable"
                                [data]="data"
                                [showAsCompare]="false" />
                        </td>
                        <td>
                            <dot-content-compare-block-editor
                                [showDiff]="showDiff"
                                [field]="field.variable"
                                [data]="data"
                                [showAsCompare]="true" />
                        </td>
                    }
                    @default {
                        <td
                            [innerHTML]="data.working[field.variable]"
                            data-testId="table-field-working"></td>
                        <td
                            [innerHTML]="
                                data.working[field.variable]
                                    | dotDiff: data.compare[field.variable] : showDiff
                            "
                            data-testId="table-field-compare"></td>
                    }
                }
            </tr>
        </ng-template>
    </p-table>
}
