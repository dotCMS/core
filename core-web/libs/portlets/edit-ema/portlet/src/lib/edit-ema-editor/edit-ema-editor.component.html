@let ogTagsResults = ogTagsResults$;
@let showSEOTool = $editorProps().seoResults && ogTagsResults;
@let dropzone = $editorProps().dropzone;

<dot-uve-toolbar
    (translatePage)="translatePage($event)"
    (editUrlContentMap)="editContentMap($event)" />

@if (showSEOTool) {
    <dot-results-seo-tool
        [seoMedia]="$editorProps().seoResults.socialMedia"
        [seoOGTags]="$editorProps().seoResults.ogTags"
        [seoOGTagsResults]="ogTagsResults"
        data-testId="results-seo-tool"></dot-results-seo-tool>
}

@if (uveStore.$canEditPage()) {
    <dot-uve-palette
        [ngClass]="$paletteClass()"
        [languageId]="uveStore.$languageId()"
        [pagePath]="uveStore.$pageURI()"
        [variantId]="uveStore.$variantId()"
        data-testId="palette" />
}

<div
    class="editor-content"
    [ngStyle]="$editorContentStyles()"
    [ngClass]="{ 'editor-content-preview': $isPreviewMode() }"
    data-testId="editor-content">
    <div
        [ngClass]="{
            'iframe-wrapper--device': $editorProps().iframe.wrapper
        }"
        [ngStyle]="{
            width: $editorProps().iframe?.wrapper?.width,
            height: $editorProps().iframe?.wrapper?.height
        }"
        class="iframe-wrapper">
        @if (uveStore.status() === UVE_STATUS.ERROR) {
            <dot-uve-page-version-not-found />
        }
        <iframe
            (load)="onIframePageLoad()"
            [src]="uveStore.$iframeURL() | safeUrl"
            [title]="host"
            [ngStyle]="{
                pointerEvents: $editorProps().iframe.pointerEvents,
                opacity: $editorProps().iframe.opacity
            }"
            sandbox="allow-scripts allow-same-origin allow-forms"
            #iframe
            data-testId="iframe"
            width="100%"
            height="100%"></iframe>

        @if ($editorProps().progressBar) {
            <p-progressBar
                [ngStyle]="{ position: 'absolute', top: '0', left: '0', width: '100%' }"
                [style]="{ height: '6px' }"
                data-testId="progress-bar"
                mode="indeterminate" />
        }
        @if ($showContentletControls()) {
            <dot-uve-contentlet-tools
                (editVTL)="handleEditVTL($event)"
                (editContent)="handleEditContentlet($event)"
                (deleteContent)="deleteContent($event)"
                (addContent)="handleAddContent($event)"
                [activeContentlet]="uveStore.activeContentlet()"
                (selectContent)="handleSelectContent($event)"
                [contentletArea]="$contentArea()"
                [isEnterprise]="uveStore.isEnterprise()"
                [allowContentDelete]="$allowContentDelete()"
                [hide]="$isDragging()"
                data-testId="contentlet-tools" />
        }
        @if (!$toggleLockOptions()?.showOverlay && dropzone) {
            <dot-ema-page-dropzone
                [containers]="dropzone.bounds"
                [dragItem]="dropzone.dragItem"
                data-testId="dropzone" />
        }

        @if ($toggleLockOptions()?.showOverlay) {
            <dot-uve-lock-overlay />
        }
    </div>
</div>

@if ($editorProps().showDialogs) {
    <dot-edit-ema-dialog
        (action)="onCustomEvent($event)"
        (reloadFromDialog)="reloadPage()"
        #dialog
        data-testId="ema-dialog" />
}
<p-confirmDialog
    [style]="{
        width: '400px'
    }"
    rejectIcon="hidden"
    acceptIcon="hidden"
    rejectButtonStyleClass="p-button-outlined"
    data-testId="confirm-dialog" />

@if ($editorProps().showBlockEditorSidebar) {
    <dot-block-editor-sidebar #blockSidebar (onSaved)="reloadPage()" />
}
