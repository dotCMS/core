@if (vm$ | async; as vm) {
    <p-drawer (onHide)="closeSidebar()" [(visible)]="vm.status.isOpen" dotSidebar>
        <dot-sidebar-header
            [actionButtonTpl]="actionHeaderBtnTpl"
            dotTitle="{{ 'experiments.configure.traffic.split.title' | dm }}"></dot-sidebar-header>
        <div class="experiment-traffic-split__form-wrapper flex flex-col">
            <form
                [formGroup]="form"
                class="p-fluid"
                data-testId="add-traffic-split-form"
                novalidate>
                <div class="experiment-traffic-split__radio">
                    <label>
                        {{ 'experiments.configure.traffic.split.name' | dm }}
                    </label>
                    <div class="flex items-center">
                        <p-radioButton
                            (click)="splitVariantsEvenly()"
                            [inputId]="'splitEvenly'"
                            [value]="splitEvenly"
                            formControlName="type"></p-radioButton>
                        <label [for]="'splitEvenly'">
                            {{ 'experiments.configure.traffic.split.evenly' | dm }}
                        </label>
                    </div>
                    <div class="flex items-center">
                        <p-radioButton
                            [inputId]="'customPercentages'"
                            [value]="customPercentages"
                            formControlName="type"></p-radioButton>
                        <label [for]="'customPercentages'">
                            {{ 'experiments.configure.traffic.split.custom' | dm }}
                        </label>
                    </div>
                </div>
                <div class="experiment-traffic-split__variants">
                    <header class="experiment-traffic-split__variants-header">
                        <span>{{ 'variant' | dm }}</span>
                        <span class="experiment-traffic-split__variants-weight">%</span>
                    </header>
                    <ng-container formArrayName="variants">
                        @for (variant of variants.controls; track variant; let i = $index) {
                            <div
                                [formGroupName]="i"
                                class="experiment-traffic-split__variants-item">
                                <span
                                    class="experiment-traffic-split__variants-name"
                                    data-testId="variant-name">
                                    {{ variant.value.name }}
                                </span>
                                @if (form.value.type === customPercentages) {
                                    <p-inputNumber
                                        (onInput)="checkControl(i, $event.value)"
                                        [maxFractionDigits]="2"
                                        [max]="100"
                                        [min]="0"
                                        class="experiment-traffic-split__variants-weight p-inputtext-sm"
                                        formControlName="weight"
                                        mode="decimal"></p-inputNumber>
                                } @else {
                                    <span
                                        class="experiment-traffic-split__variants-weight"
                                        data-testId="variant-weight">
                                        {{ variant.value.weight }}
                                    </span>
                                }
                            </div>
                        }
                    </ng-container>
                </div>
                @if (variants.invalid) {
                    <small class="p-invalid self-end" data-testId="dotErrorMsg">
                        {{ 'experiments.configure.traffic.split.variants.error' | dm }}
                    </small>
                }
            </form>
        </div>
    </p-drawer>
    <ng-template #actionHeaderBtnTpl>
        <button
            (click)="save(vm.experimentId)"
            [disabled]="!form.valid"
            [loading]="vm.status.status === stepStatus.SAVING"
            data-testId="add-traffic-split-button"
            label="{{ 'Done' | dm }}"
            pButton
            type="submit"></button>
    </ng-template>
}
