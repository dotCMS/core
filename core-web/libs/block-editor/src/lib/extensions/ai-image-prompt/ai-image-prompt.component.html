<ng-container *ngIf="vm$ | async as vm">
    <p-dialog
        [(visible)]="vm.showDialog"
        [dismissableMask]="true"
        [draggable]="false"
        [resizable]="false"
        [style]="{ width: '882px' }"
        (onHide)="hideDialog()"
        appendTo="body"
        header="{{ 'block-editor.extension.ai-image.dialog-title' | dm }}">
        <div class="dialog-prompt__wrapper flex">
<!--            <form [formGroup]="form">-->
<!--                <p-accordion-->
<!--                    *ngIf="vm.showDialog"-->
<!--                    [activeIndex]="0"-->
<!--                    expandIcon="pi pi-angle-down"-->
<!--                    collapseIcon="pi pi-angle-up">-->
<!--                    <p-accordionTab [disabled]="form.disabled" header="Settings" iconPos="end">-->
<!--                        <div class="field dialog-prompt__input">-->
<!--                            <label dotFieldRequired>Input</label>-->
<!--                            <div>-->
<!--                                <p-radioButton-->
<!--                                    formControlName="type"-->
<!--                                    value="input"-->
<!--                                    inputId="optionOne"></p-radioButton>-->
<!--                                <label class="ml-2" for="optionOne"-->
<!--                                    >Create with Custom Prompt</label-->
<!--                                >-->
<!--                            </div>-->
<!--                            <span-->
<!--                                >Write your own prompt and have full creative control over the image-->
<!--                                generation.</span-->
<!--                            >-->
<!--                            <div>-->
<!--                                <p-radioButton-->
<!--                                    formControlName="type"-->
<!--                                    value="auto"-->
<!--                                    inputId="option2"></p-radioButton>-->
<!--                                <label class="ml-2" for="option2"-->
<!--                                    >Create based on Existing Content</label-->
<!--                                >-->
<!--                            </div>-->
<!--                            <span-->
<!--                                >Generate and image based on provided content. You may Customize-->
<!--                                with mood, colors and size.</span-->
<!--                            >-->
<!--                        </div>-->
<!--                        <div class="field dialog-prompt__orientation">-->
<!--                            <label dotFieldRequired>Orientation</label>-->

<!--                            <p-dropdown-->
<!--                                [options]="vm.orientationOptions"-->
<!--                                formControlName="size"-->
<!--                                styleClass="w-full"></p-dropdown>-->
<!--                        </div>-->
<!--                    </p-accordionTab>-->
<!--                    <p-accordionTab [disabled]="form.disabled" header="Prompt" iconPos="end">-->
<!--                        <div class="dialog-prompt__text" [class.dialog-prompt__text&#45;&#45;generated]="vm.images.length">-->
<!--                            <div class="field">-->
<!--                                <label dotFieldRequired>{{-->
<!--                                        form.get('type').value === 'input'-->
<!--                                            ? 'Prompt'-->
<!--                                            : 'Customize images Properties ( Optional )'-->
<!--                                    }}</label>-->
<!--                                <textarea-->
<!--                                    class="w-full dialog-prompt__textarea"-->
<!--                                    rows="11"-->
<!--                                    cols="30"-->
<!--                                    pInputTextarea-->
<!--                                    formControlName="text"-->
<!--                                    placeholder="Describe the image you want to create, including details like subjects, colors, mood, and style. The more specific, the better!">-->
<!--                                </textarea>-->
<!--                            </div>-->
<!--                            <div class="field" *ngIf="vm.images.length">-->
<!--                                <label>AI Prompt (Rewritten)</label>-->
<!--                                <textarea-->
<!--                                    class="w-full dialog-prompt__ai-rewritten-textarea"-->
<!--                                    rows="11"-->
<!--                                    cols="30"-->
<!--                                    pInputTextarea-->
<!--                                    readonly-->
<!--                                    [value]="vm.images[vm.galleryActiveIndex].aiResponse.revised_prompt">-->
<!--                                </textarea>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </p-accordionTab>-->
<!--                </p-accordion>-->
<!--                <button-->
<!--                    class="align-self-end p-button-outlined"-->
<!--                    [disabled]="form.invalid || form.disabled"-->
<!--                    [label]="-->
<!--                        vm.status === 'LOADING'-->
<!--                            ? 'Generating'-->
<!--                            : vm.images.length-->
<!--                            ? 'Regenerate'-->
<!--                            : 'Generate'-->
<!--                    "-->
<!--                    (click)="generateImage()"-->
<!--                    pButton-->
<!--                    type="submit">-->
<!--                    <svg-->
<!--                        *ngIf="vm.status !== 'LOADING'; else loading"-->
<!--                        xmlns="http://www.w3.org/2000/svg"-->
<!--                        width="18"-->
<!--                        height="22"-->
<!--                        viewBox="0 0 18 22"-->
<!--                        fill="none">-->
<!--                        <path-->
<!--                            d="M9.48043 13.2597L5.40457 14.5046C5.29885 14.5368 5.20602 14.6037 5.13999 14.6952C5.07396 14.7868 5.03828 14.8981 5.03828 15.0124C5.03828 15.1268 5.07396 15.238 5.13999 15.3296C5.20602 15.4211 5.29885 15.488 5.40457 15.5203L9.48043 16.7651L10.6799 20.9949C10.711 21.1046 10.7755 21.2009 10.8637 21.2695C10.9519 21.338 11.0591 21.375 11.1693 21.375C11.2795 21.375 11.3867 21.338 11.4749 21.2695C11.5631 21.2009 11.6276 21.1046 11.6586 20.9949L12.8586 16.7651L16.9345 15.5203C17.0402 15.488 17.133 15.4211 17.1991 15.3296C17.2651 15.238 17.3008 15.1268 17.3008 15.0124C17.3008 14.8981 17.2651 14.7868 17.1991 14.6952C17.133 14.6037 17.0402 14.5368 16.9345 14.5046L12.8586 13.2597L11.6586 9.02989C11.6276 8.92018 11.5631 8.82385 11.4749 8.75533C11.3867 8.6868 11.2795 8.64977 11.1693 8.64977C11.0591 8.64977 10.9519 8.6868 10.8637 8.75533C10.7754 8.82385 10.711 8.92018 10.6799 9.02989L9.48043 13.2597Z"-->
<!--                            fill="#426BF0" />-->
<!--                        <path-->
<!--                            d="M14.4668 5.66732L16.6779 4.99138C16.7836 4.95914 16.8764 4.89224 16.9424 4.8007C17.0084 4.70916 17.0441 4.59789 17.0441 4.48355C17.0441 4.3692 17.0084 4.25794 16.9424 4.16639C16.8764 4.07485 16.7836 4.00795 16.6779 3.97571L14.4668 3.3003L13.8154 1.00513C13.7844 0.895414 13.7199 0.799084 13.6317 0.730559C13.5435 0.662034 13.4362 0.625 13.3261 0.625C13.2159 0.625 13.1086 0.662034 13.0204 0.730559C12.9322 0.799084 12.8677 0.895414 12.8367 1.00513L12.1859 3.3003L9.9743 3.97571C9.86858 4.00794 9.77575 4.07483 9.70972 4.16638C9.6437 4.25792 9.60801 4.3692 9.60801 4.48355C9.60801 4.5979 9.6437 4.70917 9.70972 4.80072C9.77575 4.89226 9.86858 4.95915 9.9743 4.99138L12.1859 5.66732L12.8367 7.96196C12.8677 8.07168 12.9322 8.16801 13.0204 8.23653C13.1086 8.30506 13.2159 8.34209 13.3261 8.34209C13.4362 8.34209 13.5435 8.30506 13.6317 8.23653C13.7199 8.16801 13.7844 8.07168 13.8154 7.96196L14.4668 5.66732Z"-->
<!--                            fill="#426BF0" />-->
<!--                        <path-->
<!--                            d="M3.24925 6.62823L1.01825 7.57256C0.924385 7.61231 0.844063 7.68016 0.787521 7.76748C0.730978 7.8548 0.700781 7.95761 0.700781 8.06282C0.700781 8.16802 0.730978 8.27083 0.787521 8.35815C0.844063 8.44547 0.924385 8.51333 1.01825 8.55307L3.24925 9.4974L4.1592 11.8127C4.19751 11.9101 4.2629 11.9935 4.34704 12.0522C4.43118 12.1109 4.53026 12.1422 4.63163 12.1422C4.733 12.1422 4.83208 12.1109 4.91622 12.0522C5.00036 11.9935 5.06576 11.9101 5.10406 11.8127L6.01402 9.4974L8.24456 8.55307C8.33841 8.51332 8.41873 8.44546 8.47527 8.35815C8.53181 8.27083 8.56201 8.16801 8.56201 8.06282C8.56201 7.95762 8.53181 7.8548 8.47527 7.76749C8.41873 7.68017 8.33841 7.61231 8.24456 7.57256L6.01402 6.62823L5.10406 4.31342C5.06576 4.21602 5.00036 4.13266 4.91622 4.07399C4.83208 4.01531 4.733 3.98397 4.63163 3.98397C4.53026 3.98397 4.43118 4.01531 4.34704 4.07399C4.2629 4.13266 4.19751 4.21602 4.1592 4.31342L3.24925 6.62823Z"-->
<!--                            fill="#426BF0" />-->
<!--                    </svg>-->
<!--                    <ng-template #loading>-->
<!--                        <i class="pi pi-spin pi-spinner"></i>-->
<!--                    </ng-template>-->
<!--                </button>-->
<!--            </form>-->

            <dot-ai-image-prompt-form
                (value)="generateImage($event)"
                [generatedValue]="selectedImage"
                [isLoading]="vm.status === 'LOADING'"
                [orientationOptions]="vm.orientationOptions"
            />



            <div>
                <div
                    *ngIf="vm.status !== 'LOADING' && !vm.images?.length; else gallery"
                    [className]="'s' + form.get('size').value + ' dialog-prompt__placeholder'">
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="54"
                        height="52"
                        viewBox="0 0 54 52"
                        fill="none">
                        <path
                            fill-rule="evenodd"
                            clip-rule="evenodd"
                            d="M6.78857 13.8503C4.98813 13.8503 3.26143 14.5569 1.98833 15.8146C0.715222 17.0723 0 18.7781 0 20.5568V44.9439C0 46.7225 0.715222 48.4284 1.98833 49.6861C3.26143 50.9438 4.98813 51.6503 6.78857 51.6503H36.4114C38.2119 51.6503 39.9386 50.9438 41.2117 49.6861C42.4848 48.4284 43.2 46.7225 43.2 44.9439V44.9003L43.2 44.0903L39.4971 40.5298L32.7826 33.8965C32.6071 33.7112 32.3919 33.5669 32.1528 33.4741C31.9136 33.3813 31.6565 33.3423 31.4002 33.36C31.1409 33.3749 30.8873 33.4408 30.6541 33.5539C30.421 33.667 30.213 33.8249 30.0425 34.0185L26.8581 37.7985L15.5026 26.5804C15.3353 26.4047 15.1322 26.2661 14.9067 26.1736C14.6812 26.0811 14.4384 26.0369 14.1943 26.0439C13.935 26.0588 13.6813 26.1247 13.4482 26.2378C13.215 26.3509 13.0071 26.5088 12.8366 26.7023L3.70286 37.4571V20.5568C3.70286 19.7483 4.02796 18.9729 4.60664 18.4013C5.18533 17.8296 5.97019 17.5084 6.78857 17.5084H19.1962V15.6794V13.8503H6.78857ZM3.70327 44.9439V43.1637L14.3181 30.5799L24.4886 40.6274L18.2678 47.9435H6.78899C5.97909 47.9436 5.20161 47.6292 4.62433 47.068C4.04704 46.5068 3.71623 45.7439 3.70327 44.9439ZM23.0816 47.9923L31.5981 37.8961L39.3741 45.578C39.2376 46.256 38.8682 46.8666 38.3284 47.3066C37.7886 47.7465 37.1116 47.9887 36.4118 47.9923H29.7467H23.0816Z"
                            fill="#7042F0" />
                        <path
                            d="M38.7362 25.0102L30.7809 27.4398C30.5745 27.5027 30.3934 27.6333 30.2645 27.812C30.1356 27.9907 30.066 28.2079 30.066 28.4311C30.066 28.6543 30.1356 28.8715 30.2645 29.0501C30.3934 29.2288 30.5745 29.3594 30.7809 29.4223L38.7362 31.8519L41.0774 40.1078C41.138 40.3219 41.2638 40.5099 41.436 40.6436C41.6082 40.7773 41.8174 40.8496 42.0325 40.8496C42.2475 40.8496 42.4568 40.7773 42.629 40.6436C42.8011 40.5099 42.927 40.3219 42.9876 40.1078L45.3298 31.8519L53.2851 29.4223C53.4914 29.3594 53.6726 29.2288 53.8015 29.0501C53.9303 28.8715 54 28.6543 54 28.4311C54 28.2079 53.9303 27.9907 53.8015 27.812C53.6726 27.6333 53.4914 27.5027 53.2851 27.4398L45.3298 25.0102L42.9876 16.7543C42.927 16.5402 42.8012 16.3522 42.629 16.2184C42.4568 16.0847 42.2475 16.0124 42.0325 16.0124C41.8174 16.0124 41.6081 16.0847 41.436 16.2184C41.2638 16.3522 41.138 16.5402 41.0774 16.7543L38.7362 25.0102Z"
                            fill="#7042F0" />
                        <path
                            d="M48.4685 10.1913L52.7842 8.87194C52.9905 8.80901 53.1716 8.67845 53.3005 8.49977C53.4294 8.3211 53.499 8.10392 53.499 7.88075C53.499 7.65757 53.4294 7.4404 53.3005 7.26172C53.1716 7.08305 52.9905 6.95248 52.7842 6.88955L48.4685 5.57127L47.1973 1.09156C47.1366 0.877406 47.0108 0.689388 46.8386 0.555641C46.6665 0.421893 46.4572 0.349609 46.2421 0.349609C46.027 0.349609 45.8177 0.421893 45.6456 0.555641C45.4734 0.689388 45.3476 0.877406 45.2869 1.09156L44.0167 5.57127L39.7001 6.88955C39.4938 6.95245 39.3126 7.08301 39.1837 7.26169C39.0548 7.44037 38.9852 7.65756 38.9852 7.88075C38.9852 8.10394 39.0548 8.32112 39.1837 8.4998C39.3126 8.67848 39.4938 8.80904 39.7001 8.87194L44.0167 10.1913L45.2869 14.6699C45.3476 14.8841 45.4734 15.0721 45.6456 15.2059C45.8177 15.3396 46.027 15.4119 46.2421 15.4119C46.4572 15.4119 46.6665 15.3396 46.8386 15.2059C47.0108 15.0721 47.1366 14.8841 47.1973 14.6699L48.4685 10.1913Z"
                            fill="#7042F0" />
                        <path
                            d="M26.5741 12.0668L22.2196 13.9099C22.0364 13.9875 21.8797 14.1199 21.7693 14.2904C21.6589 14.4608 21.6 14.6615 21.6 14.8668C21.6 15.0721 21.6589 15.2728 21.7693 15.4432C21.8797 15.6137 22.0364 15.7461 22.2196 15.8237L26.5741 17.6668L28.3502 22.1859C28.4249 22.376 28.5526 22.5387 28.7168 22.6532C28.881 22.7678 29.0744 22.8289 29.2723 22.8289C29.4701 22.8289 29.6635 22.7678 29.8277 22.6532C29.992 22.5387 30.1196 22.376 30.1944 22.1859L31.9704 17.6668L36.324 15.8237C36.5072 15.7461 36.664 15.6136 36.7743 15.4432C36.8847 15.2728 36.9436 15.0721 36.9436 14.8668C36.9436 14.6615 36.8847 14.4608 36.7743 14.2904C36.664 14.1199 36.5072 13.9875 36.324 13.9099L31.9704 12.0668L30.1944 7.5487C30.1196 7.35858 29.992 7.19589 29.8277 7.08136C29.6635 6.96684 29.4701 6.90568 29.2723 6.90568C29.0744 6.90568 28.881 6.96684 28.7168 7.08136C28.5526 7.19589 28.4249 7.35858 28.3502 7.5487L26.5741 12.0668Z"
                            fill="#7042F0" />
                    </svg>
                    <i></i>
                </div>

                <p-skeleton *ngIf="vm.status === 'LOADING'" width="10rem" styleClass="mb-2">
                </p-skeleton>

                <ng-template #gallery>
                    <div *ngIf="vm.status !== 'LOADING'">
                        <p-galleria
                            #galleria
                            [(activeIndex)]="vm.galleryActiveIndex"
                            visible="true"
                            [circular]="true"
                            [showItemNavigators]="true"
                            [showThumbnails]="false"
                            [value]="vm.images"
                            [containerStyle]="{ 'max-width': '100%' }">
                            <ng-template pTemplate="item" let-item>
                                <p-image [src]="item.response.contentlet.assetVersion" [imageStyle]="'width: 100%; display: block'" alt="image"  [preview]="true"></p-image>
                            </ng-template>

                        </p-galleria>
                    </div>
                    <span class="dialog-prompt__gallery-count"> {{ vm.galleryActiveIndex + 1 }}/{{ vm.images.length }} </span>

                    <button
                        class="align-self-end"
                        (click)="insetImage(vm.images[vm.galleryActiveIndex])"
                        [disabled]="form.disabled"
                        pButton
                        type="submit"
                        icon="pi pi-check"
                        label="Insert"></button>
                </ng-template>
            </div>
        </div>
    </p-dialog>
</ng-container>

<p-confirmDialog
    [style]="{ width: '500px' }"
    (onHide)="onHideConfirm()"
    appendTo="body"
    dismissableMask="true"
    key="ai-image-prompt-msg" />
