<ng-container *ngIf="vm$ | async as vm">
    <p-dialog
        [(visible)]="vm.showDialog"
        [dismissableMask]="true"
        [draggable]="false"
        [resizable]="false"
        [style]="{ width: '1040px' }"
        (onHide)="store.hideDialog()"
        appendTo="body"
        header="{{ 'block-editor.extension.ai-image.dialog-title' | dm }}">
        <div class="dialog-prompt__wrapper">
            <dot-ai-image-prompt-form
                *ngIf="vm.showDialog"
                [value]="vm.images[vm.galleryActiveIndex]"
                [isLoading]="vm.isLoading"
                (valueChange)="store.setFormValue($event)"
                (generate)="store.generateImage()" />
            <div [class.dialog-prompt_gallery]="vm.images.length || vm.isLoading">
                <dot-ai-image-prompt-gallery
                    [isLoading]="vm.isLoading"
                    [images]="vm.images"
                    [activeImageIndex]="vm.galleryActiveIndex"
                    [orientation]="vm.formValue?.size"
                    (activeIndexChange)="store.setGalleryActiveIndex($event)"
                    (regenerate)="store.generateImage()" />
                <div class="dot-ai-image__buttons" *ngIf="vm.images.length || vm.isLoading">
                    <button
                        class="p-button-text"
                        [label]="'Cancel' | dm"
                        (click)="closeDialog()"
                        data-testid="close-btn"
                        type="button"
                        pButton></button>
                    <button
                        class="align-self-end"
                        [disabled]="vm.isLoading || vm.images[vm.galleryActiveIndex].error"
                        [label]="'block-editor.extension.ai-image.insert' | dm"
                        (click)="store.setSelectedImage(vm.images[vm.galleryActiveIndex])"
                        data-testid="submit-btn"
                        pButton
                        type="submit"
                        icon="pi pi-check"></button>
                </div>
            </div>
            <p-confirmDialog
                [style]="{ width: '500px' }"
                key="ai-image-prompt"
                rejectButtonStyleClass="p-button-outlined"
                acceptIcon="null"
                rejectIcon="null">
            </p-confirmDialog>
        </div>
    </p-dialog>
</ng-container>
