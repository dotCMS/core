steps:

  # https://docs.docker.com/release-notes/docker-compose/
  # Build the new docker image.
  - name: 'docker/compose:1.24.1'
    env:
      - 'BUILD_FROM=COMMIT'
      - 'COMMIT_SHA=$COMMIT_SHA'
      - 'LICENSE_KEY=$_LICENSE_KEY'
    args: ['-f', './docker/tests/integration/$_DB_TYPE-docker-compose.yml', 'build',
           '--build-arg', 'BUILD_ID=$_GIT_BRANCH_COMMIT']

  # Run the integration tests image
  - name: 'docker/compose:1.24.1'
    args: ['-f', './docker/tests/integration/$_DB_TYPE-docker-compose.yml', 'up',
           '--abort-on-container-exit']

  # Shutdown the images
  - name: 'docker/compose:1.24.1'
    args: ['-f', './docker/tests/integration/$_DB_TYPE-docker-compose.yml', 'down']

timeout: 3600s