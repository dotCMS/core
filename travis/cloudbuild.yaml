steps:
  # Build the new docker image.
  - name: 'gcr.io/$GOOGLE_PROJECT_ID/docker-compose'
    env:
      - 'BUILD_FROM=COMMIT'
      - 'BUILD_ID=$BRANCH_NAME'
      - 'DB_TYPE=$DB_TYPE'
      - 'COMMIT_SHA=$COMMIT_SHA'
      - 'PROJECT_ID=$GOOGLE_PROJECT_ID'
    args: ['build', '-f', 'postgres-docker-compose.yml', '.']

  - name: 'gcr.io/$GOOGLE_PROJECT_ID/docker-compose'
    env:
      - 'PROJECT_ID=$GOOGLE_PROJECT_ID'
    args: ['up', '-f', 'postgres-docker-compose.yml', '.']

#  - name: 'gcr.io/cloud-builders/docker'
#    env:
#      - 'BRANCH_NAME=$BRANCH_NAME'
#      - 'COMMIT_SHA=$COMMIT_SHA'
#    args: [ 'build', '-t', "gcr.io/cicd-246518/dotcms-$BRANCH_NAME-$COMMIT_SHA", '--build-arg', 'BUILD_FROM=COMMIT', '--build-arg', "BUILD_ID=$COMMIT_SHA", '.' ]

timeout: 1800s