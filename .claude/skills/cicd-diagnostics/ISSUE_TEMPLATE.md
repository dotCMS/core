# GitHub Issue Templates for CI/CD Failures

Standard templates for documenting build failures.

## Template Selection Guide

**New Build Failure** → Use "Build Failure Report" template
**Flaky Test** → Use "Flaky Test Report" template
**Infrastructure Issue** → Use "Infrastructure Issue" template
**Add to existing issue** → Use "Failure Update Comment" template

## Build Failure Report Template

Use when creating a new issue for a consistent build failure.

```markdown
## Build Failure Report

**Workflow Run**: [workflow-name #run-id](run-url)
**Failed Job**: `job-name`
**Commit**: [`short-sha`](commit-url) - commit message
**Branch**: `branch-name`
**PR**: #pr-number (if applicable)
**Date**: YYYY-MM-DD HH:MM UTC

### Failure Summary

Brief description of what failed (1-2 sentences).

### Failed Test(s)

If test failure, list test class and method:
```
com.dotcms.contenttype.business.ContentTypeAPIImplTest.testCreateContentType
```

If build failure, describe the build phase:
```
Maven compilation phase - Java syntax error in ContentTypeResource.java
```

### Error Message

```
[Insert relevant error message]
Example:
java.lang.AssertionError: Expected content type to be created
    Expected: ContentType{name='test', baseType=CONTENT}
    Actual: null
```

### Stack Trace

```
[Insert relevant stack trace, focus on com.dotcms.* lines]
Example:
java.lang.NullPointerException: Cannot invoke method on null object
    at com.dotcms.contenttype.business.ContentTypeAPIImpl.save(ContentTypeAPIImpl.java:456)
    at com.dotcms.contenttype.business.ContentTypeAPIImplTest.testCreateContentType(ContentTypeAPIImplTest.java:123)
```

### Root Cause

**Category**: [Code Change | Test Issue | Infrastructure | External Dependency]

**Analysis**:
Explain the identified root cause with evidence (changed files, recent commits, historical pattern).

Example:
"The failure was introduced in commit abc1234 which refactored the ContentType save logic. The test expects the save method to return the created object, but the refactored code returns null when validation fails."

### Classification

- **Type**: [New Failure | Regression | Test Gap]
- **Introduced in**: commit-sha or "unknown"
- **First failed**: run-id and date
- **Reproducibility**: [Always | Sometimes | Once]
- **Affects workflows**: [PR | Merge Queue | Trunk | Nightly]

### Related Changes

Commits between last success and this failure:
- `abc1234` - Refactor ContentType API by @author (YYYY-MM-DD)
- `def5678` - Update test fixtures by @author (YYYY-MM-DD)

### Reproduction Steps

Steps to reproduce locally (if known):
```bash
./mvnw test -Dtest=ContentTypeAPIImplTest#testCreateContentType
```

Or mark as:
```
Cannot reproduce locally - CI environment specific
```

### Recommendations

1. **Immediate action**: [Specific fix or workaround]
   ```bash
   [Command or code snippet if applicable]
   ```

2. **Verification**: [How to verify the fix]
   ```bash
   [Test command]
   ```

3. **Prevention**: [How to prevent similar issues]
   [Description]

### Related Issues

- Related to #issue-number
- Similar to #issue-number
- Depends on #issue-number

### Additional Context

[Any other relevant information: environment details, configuration, external factors]

---
*Generated by CI/CD Diagnostics Skill*
```

**Labels to add**:
- `bug` (always)
- `ci-cd` (always)
- Workflow-specific: `pr-workflow`, `merge-queue`, `trunk-workflow`, or `nightly`
- Type-specific: `test-failure`, `build-failure`, `deployment-failure`

**gh CLI command**:
```bash
gh issue create \
  --title "[CI/CD] Brief description of failure" \
  --body "$(cat issue-body.md)" \
  --label "bug,ci-cd,pr-workflow"
```

## Flaky Test Report Template

Use when documenting a test that fails intermittently.

```markdown
## Flaky Test Report

**Test**: `com.dotcms.package.TestClass.testMethod`
**Failure Rate**: X failures out of Y runs (Z%)
**Date Range**: YYYY-MM-DD to YYYY-MM-DD
**Workflows Affected**: [PR | Merge Queue | Nightly]

### Failure Pattern

**Frequency**:
- Last 30 days: X failures / Y runs (Z%)
- Last 7 days: X failures / Y runs (Z%)

**Time pattern** (if any):
- Random failures: No time pattern detected
- OR: Tends to fail during high load / specific time of day

**Workflow pattern**:
- Fails in: [which workflows]
- Always passes in: [which workflows]
- Pattern: [describe any pattern]

### Example Failures

**Recent failure 1**:
- Run: [run-name #run-id](run-url)
- Date: YYYY-MM-DD
- Error: `brief error message`

**Recent failure 2**:
- Run: [run-name #run-id](run-url)
- Date: YYYY-MM-DD
- Error: `brief error message`

**Recent failure 3**:
- Run: [run-name #run-id](run-url)
- Date: YYYY-MM-DD
- Error: `brief error message`

### Error Messages

Common error patterns seen:
```
[Error message variant 1]
```

```
[Error message variant 2]
```

### Suspected Root Cause

**Hypothesis**: [Your hypothesis about why it's flaky]

Examples:
- Race condition in async operation
- Timing dependency on external service
- Resource contention (database connections, ports)
- Non-deterministic test data
- Cleanup issue leaving state for next test

**Evidence**:
- [Supporting evidence for hypothesis]
- [Stack trace analysis]
- [Timing information]

### Test Code Location

- File: `src/test/java/com/dotcms/package/TestClass.java`
- Method: `testMethod` (line XXX)
- Related code: [Files tested by this test]

### Mitigation Options

**Option 1: Fix the root cause** (preferred)
- [ ] Identify race condition
- [ ] Add proper synchronization/waiting
- [ ] Improve test isolation
- [ ] Fix cleanup issues

**Option 2: Improve test resilience** (temporary)
- [ ] Add retry logic
- [ ] Increase timeouts
- [ ] Add explicit waits
- [ ] Improve assertions

**Option 3: Quarantine** (last resort)
- [ ] Mark with `@Flaky` annotation
- [ ] Exclude from CI runs temporarily
- [ ] Track in separate test suite
- [ ] Create investigation task

### Recommended Actions

1. [Specific action 1]
2. [Specific action 2]
3. [Specific action 3]

### Related Issues

- Similar flaky test: #issue-number
- Related to: #issue-number

---
*Generated by CI/CD Diagnostics Skill*
```

**Labels to add**:
- `flaky-test` (always)
- `test-failure`
- `ci-cd`
- Severity: `high-priority` if >20% failure rate, `medium-priority` if 5-20%, `low-priority` if <5%

**gh CLI command**:
```bash
gh issue create \
  --title "[Flaky Test] TestClass.testMethod - X% failure rate" \
  --body "$(cat flaky-test.md)" \
  --label "flaky-test,test-failure,ci-cd,high-priority"
```

## Infrastructure Issue Template

Use for issues related to CI/CD infrastructure, not code.

```markdown
## CI/CD Infrastructure Issue

**Affected Workflows**: [PR | Merge Queue | Trunk | Nightly | All]
**Issue Type**: [Timeout | Connectivity | Resource | Service Outage]
**First Observed**: YYYY-MM-DD HH:MM UTC
**Status**: [Ongoing | Resolved | Intermittent]

### Symptom

Brief description of the infrastructure issue.

Example:
"Multiple workflow runs timing out during Elasticsearch startup phase"

### Affected Runs

Recent runs experiencing this issue:
- [workflow #run-id](run-url) - YYYY-MM-DD - timeout after 15 minutes
- [workflow #run-id](run-url) - YYYY-MM-DD - connection refused
- [workflow #run-id](run-url) - YYYY-MM-DD - rate limit exceeded

### Error Patterns

```
[Common error message 1]
```

```
[Common error message 2]
```

### Investigation

**External Service Status**:
- GitHub Actions status: [Link to status page]
- Maven Central: [Status]
- Docker Hub: [Status]
- Other services: [Status]

**Runner Information**:
- Runner OS: [ubuntu-latest, macos-latest, etc.]
- Runner version: [if known]
- Resource limits: [if relevant]

**Timing**:
- Time of day pattern: [if any]
- Duration of issue: [how long observed]
- Frequency: [always, intermittent, rare]

### Root Cause

**Identified cause** (if known):
[Description of root cause]

**Suspected cause** (if investigating):
[Hypothesis about cause]

### Impact

- **Workflows blocked**: X runs failed
- **PRs affected**: Y PRs unable to merge
- **Duration**: Started YYYY-MM-DD, ongoing/resolved YYYY-MM-DD
- **Severity**: [Critical | High | Medium | Low]

### Workaround

**Temporary workaround** (if available):
```bash
[Commands or config changes]
```

Or:
```
No workaround available - must wait for service restoration
```

### Resolution

**Status**: [Investigating | Waiting for external fix | Fixed]

**Actions taken**:
1. [Action 1]
2. [Action 2]
3. [Action 3]

**Permanent fix** (if applicable):
[Description of fix implemented]

### Related Issues

- Related to #issue-number
- Duplicate of #issue-number
- External issue: [link to GitHub Actions, service status, etc.]

---
*Generated by CI/CD Diagnostics Skill*
```

**Labels to add**:
- `ci-cd`
- `infrastructure`
- Severity based on impact: `critical`, `high-priority`, `medium-priority`
- Type: `timeout`, `connectivity`, `resource-constraint`

## Failure Update Comment Template

Use when adding information to an existing issue.

```markdown
### Additional Failure - YYYY-MM-DD

**Run**: [workflow #run-id](run-url)
**Commit**: `short-sha`
**Workflow**: [PR | Merge Queue | Trunk | Nightly]

**Status**: [Same error | Slightly different | Related]

**Error**:
```
[Error message if different]
```

**Notes**:
[Any new observations or patterns]

**Failure count**: Now X failures out of Y observed runs
```

**gh CLI command**:
```bash
gh issue comment ISSUE_NUMBER --body "$(cat update-comment.md)"
```

## Label Standards

**Workflow labels** (one):
- `pr-workflow` - cicd_1-pr.yml
- `merge-queue` - cicd_2-merge-queue.yml
- `trunk-workflow` - cicd_3-trunk.yml
- `nightly` - cicd_4-nightly.yml

**Type labels** (one or more):
- `test-failure` - Test failed
- `build-failure` - Compilation/build failed
- `deployment-failure` - Deployment step failed
- `flaky-test` - Intermittent test failure
- `infrastructure` - Infrastructure/external issue

**Severity labels** (one):
- `critical` - Blocking all builds
- `high-priority` - Affecting multiple PRs/runs
- `medium-priority` - Intermittent or limited impact
- `low-priority` - Rare or minor issue

**Always include**:
- `bug` (for failures)
- `ci-cd` (for all CI/CD issues)

## Title Conventions

**Build Failure**:
```
[CI/CD] Brief description of what failed
```
Examples:
- `[CI/CD] ContentTypeAPIImplTest.testCreate fails with NPE`
- `[CI/CD] Maven compilation error in ContentTypeResource`
- `[CI/CD] Docker build timeout in trunk workflow`

**Flaky Test**:
```
[Flaky Test] TestClass.testMethod - X% failure rate
```
Examples:
- `[Flaky Test] ContentTypeAPIImplTest.testConcurrent - 15% failure rate`
- `[Flaky Test] WorkflowAPITest.testTransition - intermittent timeout`

**Infrastructure**:
```
[Infrastructure] Brief description of issue
```
Examples:
- `[Infrastructure] Elasticsearch startup timeouts in nightly builds`
- `[Infrastructure] Maven Central connectivity issues`

## Quick Issue Creation Commands

**New build failure**:
```bash
gh issue create \
  --title "[CI/CD] Test/Build description" \
  --label "bug,ci-cd,pr-workflow,test-failure" \
  --assignee "@me" \
  --body "$(cat <<EOF
[Use Build Failure Report template]
EOF
)"
```

**Flaky test**:
```bash
gh issue create \
  --title "[Flaky Test] TestClass.method - X% failure" \
  --label "flaky-test,test-failure,ci-cd,high-priority" \
  --body "$(cat <<EOF
[Use Flaky Test Report template]
EOF
)"
```

**Infrastructure issue**:
```bash
gh issue create \
  --title "[Infrastructure] Issue description" \
  --label "ci-cd,infrastructure,high-priority" \
  --body "$(cat <<EOF
[Use Infrastructure Issue template]
EOF
)"
```

## Issue Lifecycle

1. **Create** - Use appropriate template
2. **Investigate** - Add findings as comments
3. **Fix** - Reference issue in PR
4. **Verify** - Confirm fix in CI runs
5. **Close** - Link to fixing PR or resolution

**Closing message**:
```markdown
Fixed in #pr-number

Verified in:
- [run #id](url) - passed
- [run #id](url) - passed

Closing as resolved.
```