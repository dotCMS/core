{
	"info": {
		"_postman_id": "a60c8d93-b01a-4fc7-b817-5080ab8ff140",
		"name": "Integrity Checker JWT Token Test",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "generate",
			"item": [
				{
					"name": "with_admin_user",
					"item": [
						{
							"name": "request_token",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "80afc1ed-8a26-413c-9960-3aa034991ebf",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.errors.length).to.eql(0);",
											"    pm.expect(jsonData.entity).to.not.eq(undefined);",
											"    pm.expect(jsonData.entity.jwt).to.not.eq(undefined);",
											"    pm.collectionVariables.set(\"token\", jsonData.entity.jwt);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "basic",
									"basic": [
										{
											"key": "password",
											"value": "admin",
											"type": "string"
										},
										{
											"key": "username",
											"value": "admin@dotcms.com",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"claims\": {\n        \"label\": \"testing\"\n    },\n    \"expirationSeconds\": 94571365,\n    \"network\": \"0.0.0.0/0\",\n    \"userId\": \"dotcms.org.1\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{serverURL}}/api/v1/apitoken",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"v1",
										"apitoken"
									]
								}
							},
							"response": []
						},
						{
							"name": "logout",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "6c8540af-784c-4821-af20-9c64ca3092af",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{serverURL}}/api/v1/logout",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"v1",
										"logout"
									]
								}
							},
							"response": []
						},
						{
							"name": "request_integrity_checker_generate",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "062243b0-ea15-492e-a4c3-47351fe304f2",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"",
											"    var transactionId = pm.response.text();",
											"    pm.collectionVariables.set(\"transactionId\", transactionId);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{serverURL}}/api/integrity/_generateintegritydata",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"integrity",
										"_generateintegritydata"
									]
								}
							},
							"response": []
						},
						{
							"name": "check_transaction_id",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "a63b3d2d-516c-41ee-a33d-9c3e119dc9a5",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "multipart/form-data",
										"type": "text"
									}
								],
								"body": {
									"mode": "file",
									"file": {
										"src": "/build/src/core/dotCMS/src/curl-test/resources/Push_publish/bundle_test-01EAJHA26FZGPAEZBSGJGNG82A.tar.gz"
									}
								},
								"url": {
									"raw": "{{serverURL}}/api/integrity/{{transactionId}}/status",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"integrity",
										"{{transactionId}}",
										"status"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "using_basic_authentication_instead_JWT_token",
					"item": [
						{
							"name": "request_pp",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "d36a15a3-9ebe-4b22-9de7-bd2cb7acae51",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(401);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "basic",
									"basic": [
										{
											"key": "password",
											"value": "admin",
											"type": "string"
										},
										{
											"key": "username",
											"value": "admin@dotcms.com",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/octet-stream",
										"type": "text"
									},
									{
										"key": "Content-Disposition",
										"value": "attachment",
										"type": "text"
									}
								],
								"body": {
									"mode": "file",
									"file": {
										"src": "/build/src/core/dotCMS/src/curl-test/resources/Push_publish/bundle_test-01EAJHA26FZGPAEZBSGJGNG82A.tar.gz"
									},
									"options": {
										"file": {}
									}
								},
								"url": {
									"raw": "{{serverURL}}/api/bundlePublisher/publish",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"bundlePublisher",
										"publish"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "fail_not_token_sent",
					"item": [
						{
							"name": "request_integrity_generate",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "815e86d1-3067-4131-88c5-7325b3a82c90",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(401);",
											"});",
											"",
											"pm.test(\"Check WWW-Authenticate header\", function () {",
											"    expected = 'Bearer realm=\"example\",error=\"invalid_token\",error_key=\"__invalid_token__\",error_description=\"\"';",
											"",
											"    pm.response.to.be.header('WWW-Authenticate', expected);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"type": "text",
										"value": "application/octet-stream"
									},
									{
										"key": "Content-Disposition",
										"type": "text",
										"value": "attachment"
									}
								],
								"body": {
									"mode": "file",
									"file": {
										"src": "/build/src/core/dotCMS/src/curl-test/resources/Push_publish/bundle_test-01EAJHA26FZGPAEZBSGJGNG82A.tar.gz"
									}
								},
								"url": {
									"raw": "{{serverURL}}/api/integrity/_generateintegritydata",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"integrity",
										"_generateintegritydata"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "fail_not_valid_token",
					"item": [
						{
							"name": "request_integrity_generate",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "da716781-b552-4bcb-903d-1768b4d86d60",
										"exec": [
											"pm.test(\"Status code is 401\", function () {",
											"    pm.response.to.have.status(401);",
											"});",
											"",
											"pm.test(\"Check WWW-Authenticate header\", function () {",
											"    expected = 'Bearer realm=\"example\",error=\"invalid_token\",error_key=\"__invalid_token__\",error_description=\"\"';",
											"",
											"    pm.response.to.be.header('WWW-Authenticate', expected);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "not_valid_token",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"type": "text",
										"value": "application/octet-stream"
									},
									{
										"key": "Content-Disposition",
										"type": "text",
										"value": "attachment"
									}
								],
								"body": {
									"mode": "file",
									"file": {
										"src": ""
									}
								},
								"url": {
									"raw": "{{serverURL}}/api/integrity/_generateintegritydata",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"integrity",
										"_generateintegritydata"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				}
			],
			"protocolProfileBehavior": {}
		},
		{
			"name": "Fix conflicts",
			"item": [
				{
					"name": "with_admin_user",
					"item": [
						{
							"name": "create folder",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "673944eb-40c9-49cc-8bb9-bc6d5cc38d8a",
										"exec": [
											"pm.test(\"Bundle uploaded sucessfully\", function () {",
											"    pm.response.to.have.status(200);",
											"",
											"    var jsonData = pm.response.json();",
											"    console.log(jsonData);",
											"",
											"    pm.expect(jsonData[\"bundleName\"]).to.eql(\"folder_integrity_test_demo.tar.gz\");",
											"    pm.expect(jsonData[\"status\"]).to.eql(\"SUCCESS\");",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "basic",
									"basic": [
										{
											"key": "username",
											"value": "admin@dotcms.com",
											"type": "string"
										},
										{
											"key": "password",
											"value": "admin",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"type": "text",
										"value": "application/octet-stream"
									},
									{
										"key": "Content-Disposition",
										"type": "text",
										"value": "attachment"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "file",
											"contentType": "application/tar+gzip ",
											"type": "file",
											"src": "/build/src/core/dotCMS/src/curl-test/resources/Push_publish/folder_integrity_test_demo.tar.gz"
										}
									],
									"options": {
										"formdata": {}
									}
								},
								"url": {
									"raw": "{{serverURL}}/api/bundle/sync",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"bundle",
										"sync"
									]
								},
								"description": "Imports a Bundle that includes:\n*  A piece of content of type \"Rich text\" with \"test Content\" as title and body"
							},
							"response": []
						},
						{
							"name": "request_token",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "3d676359-d941-4461-bc4d-078b13d334f2",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.errors.length).to.eql(0);",
											"    pm.expect(jsonData.entity).to.not.eq(undefined);",
											"    pm.expect(jsonData.entity.jwt).to.not.eq(undefined);",
											"    pm.collectionVariables.set(\"token\", jsonData.entity.jwt);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "basic",
									"basic": [
										{
											"key": "password",
											"value": "admin",
											"type": "string"
										},
										{
											"key": "username",
											"value": "admin@dotcms.com",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"claims\": {\n        \"label\": \"testing\"\n    },\n    \"expirationSeconds\": 94571365,\n    \"network\": \"0.0.0.0/0\",\n    \"userId\": \"dotcms.org.1\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{serverURL}}/api/v1/apitoken",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"v1",
										"apitoken"
									]
								}
							},
							"response": []
						},
						{
							"name": "logout",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "c7823712-8ca6-44a0-baff-b203e3a88bc5",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{serverURL}}/api/v1/logout",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"v1",
										"logout"
									]
								}
							},
							"response": []
						},
						{
							"name": "Execute Task Upgrade",
							"request": {
								"auth": {
									"type": "basic",
									"basic": [
										{
											"key": "password",
											"value": "admin",
											"type": "string"
										},
										{
											"key": "username",
											"value": "admin@dotcms.com",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"upgradeTaskClass\":\"com.dotmarketing.startup.runonce.Task05390RemoveEndpointIdForeignKeyInIntegrityResolverTables\"\n}\n",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "http://localhost:8080/api/v1/upgradetask",
									"protocol": "http",
									"host": [
										"localhost"
									],
									"port": "8080",
									"path": [
										"api",
										"v1",
										"upgradetask"
									]
								}
							},
							"response": []
						},
						{
							"name": "request_fix_conflicts",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "00e15a74-7360-40d8-a6ba-33bdbd7b6896",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"warning": "This is a duplicate header and will be overridden by the Content-Type header generated by Postman.",
										"key": "Content-Type",
										"value": "multipart/form-data",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "DATA_TO_FIX",
											"type": "file",
											"src": "/build/src/core/dotCMS/src/curl-test/resources/Push_publish/DataToFix.zip"
										},
										{
											"key": "TYPE",
											"value": "FOLDERS",
											"type": "text"
										}
									]
								},
								"url": {
									"raw": "{{serverURL}}/api/integrity/_fixconflictsfromremote",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"integrity",
										"_fixconflictsfromremote"
									]
								}
							},
							"response": []
						},
						{
							"name": "check folder id",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "3db6822c-c9e6-4f33-8f1d-632af0063d9d",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData[\"entity\"][\"identifier\"]).to.eql(\"ecf8d1d2-d150-4af8-9a0b-93bd53143c11\");",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "basic",
									"basic": [
										{
											"key": "password",
											"value": "admin",
											"type": "string"
										},
										{
											"key": "username",
											"value": "admin@dotcms.com",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{serverURL}}/api/v1/folder/sitename/default/uri/folder_integrity_test_demo",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"v1",
										"folder",
										"sitename",
										"default",
										"uri",
										"folder_integrity_test_demo"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				}
			],
			"protocolProfileBehavior": {}
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "49ce2425-9a2b-4425-92e0-2d6e1c24c38e",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "d3aa9e2b-4aa1-4882-9876-65b9266fe453",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"id": "81a21cd1-affe-4e42-914a-894e7ffde1e9",
			"key": "serverURL",
			"value": "http://localhost:8080"
		},
		{
			"id": "547ffe1c-a555-4e44-903f-c80060dccb1c",
			"key": "token",
			"value": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhcGk1MGY1N2RlNi02MjJhLTQyMWYtYThjYy0wZTY0ZDIwOGY3NTgiLCJ4bW9kIjoxNjAwOTgwMTYyMDAwLCJuYmYiOjE2MDA5ODAxNjIsImlzcyI6IjZmZWRmNjBhMTYiLCJsYWJlbCI6InRlc3RpbmciLCJleHAiOjE2OTU1NTE1MjcsImlhdCI6MTYwMDk4MDE2MiwianRpIjoiZjAwYjcyZmItNDQ0YS00MGUzLWI1MzItMDBiZDk4NzFmMTk3In0.S3W8wZV8SAtTxPwlxoB1nzd301wvNDZDEFzVis-UdfA"
		},
		{
			"id": "1f57fb71-9bc1-4a31-b3b4-4ab44647f181",
			"key": "bundle_id",
			"value": "bundle_1598948729120"
		},
		{
			"id": "b4166b36-71b9-4cc9-ab25-4514b88e07c7",
			"key": "transactionId",
			"value": "48db03da-d303-47cc-af29-9be490e99648"
		}
	],
	"protocolProfileBehavior": {}
}