{
	"info": {
		"_postman_id": "0edfa926-4880-4395-8e3f-2b9c1a5746f5",
		"name": "Integrity Checker JWT Token Test",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "generate",
			"item": [
				{
					"name": "with_admin_user",
					"item": [
						{
							"name": "request_token",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "3780408c-6a5e-4cf5-a596-33338d59a9d5",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.errors.length).to.eql(0);",
											"    pm.expect(jsonData.entity).to.not.eq(undefined);",
											"    pm.expect(jsonData.entity.jwt).to.not.eq(undefined);",
											"    pm.collectionVariables.set(\"token\", jsonData.entity.jwt);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "basic",
									"basic": [
										{
											"key": "password",
											"value": "admin",
											"type": "string"
										},
										{
											"key": "username",
											"value": "admin@dotcms.com",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"claims\": {\n        \"label\": \"testing\"\n    },\n    \"expirationSeconds\": 94571365,\n    \"network\": \"0.0.0.0/0\",\n    \"userId\": \"dotcms.org.1\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{serverURL}}/api/v1/apitoken",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"v1",
										"apitoken"
									]
								}
							},
							"response": []
						},
						{
							"name": "logout",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "1b608153-74a6-4ef7-9c28-f88bae1e94d0",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{serverURL}}/api/v1/logout",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"v1",
										"logout"
									]
								}
							},
							"response": []
						},
						{
							"name": "request_integrity_checker_generate",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "1185664c-f4ac-460e-9de2-eeeca14b96c9",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"",
											"    var transactionId = pm.response.text();",
											"    pm.collectionVariables.set(\"transactionId\", transactionId);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "formdata",
									"formdata": []
								},
								"url": {
									"raw": "{{serverURL}}/api/integrity/_generateintegritydata",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"integrity",
										"_generateintegritydata"
									]
								}
							},
							"response": []
						},
						{
							"name": "check_transaction_id",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "03ee6681-0c9a-45be-9e8f-ca6174165f7e",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "multipart/form-data",
										"type": "text"
									}
								],
								"body": {
									"mode": "file",
									"file": {
										"src": "/build/src/core/dotCMS/src/curl-test/resources/Push_publish/bundle_test-01EAJHA26FZGPAEZBSGJGNG82A.tar.gz"
									}
								},
								"url": {
									"raw": "{{serverURL}}/api/integrity/{{transactionId}}/status",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"integrity",
										"{{transactionId}}",
										"status"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "using_basic_authentication_instead_JWT_token",
					"item": [
						{
							"name": "request_pp",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "d68aca10-87c4-4ad9-a56c-545e30c6f430",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(401);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "basic",
									"basic": [
										{
											"key": "password",
											"value": "admin",
											"type": "string"
										},
										{
											"key": "username",
											"value": "admin@dotcms.com",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/octet-stream",
										"type": "text"
									},
									{
										"key": "Content-Disposition",
										"value": "attachment",
										"type": "text"
									}
								],
								"body": {
									"mode": "file",
									"file": {
										"src": "/build/src/core/dotCMS/src/curl-test/resources/Push_publish/bundle_test-01EAJHA26FZGPAEZBSGJGNG82A.tar.gz"
									},
									"options": {
										"file": {}
									}
								},
								"url": {
									"raw": "{{serverURL}}/api/bundlePublisher/publish",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"bundlePublisher",
										"publish"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "fail_not_token_sent",
					"item": [
						{
							"name": "request_integrity_generate",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "8fe02d21-5ba5-4c6e-be67-5effd5e53463",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(401);",
											"});",
											"",
											"pm.test(\"Check WWW-Authenticate header\", function () {",
											"    expected = 'Bearer realm=\"example\",error=\"invalid_token\",error_key=\"__invalid_token__\",error_description=\"\"';",
											"",
											"    pm.response.to.be.header('WWW-Authenticate', expected);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "noauth"
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"type": "text",
										"value": "application/octet-stream"
									},
									{
										"key": "Content-Disposition",
										"type": "text",
										"value": "attachment"
									}
								],
								"body": {
									"mode": "file",
									"file": {
										"src": "/build/src/core/dotCMS/src/curl-test/resources/Push_publish/bundle_test-01EAJHA26FZGPAEZBSGJGNG82A.tar.gz"
									}
								},
								"url": {
									"raw": "{{serverURL}}/api/integrity/_generateintegritydata",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"integrity",
										"_generateintegritydata"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				},
				{
					"name": "fail_not_valid_token",
					"item": [
						{
							"name": "request_integrity_generate",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "4cadaed2-6ecf-4028-9491-534d53d77cdc",
										"exec": [
											"pm.test(\"Status code is 401\", function () {",
											"    pm.response.to.have.status(401);",
											"});",
											"",
											"pm.test(\"Check WWW-Authenticate header\", function () {",
											"    expected = 'Bearer realm=\"example\",error=\"invalid_token\",error_key=\"__invalid_token__\",error_description=\"\"';",
											"",
											"    pm.response.to.be.header('WWW-Authenticate', expected);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "not_valid_token",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"type": "text",
										"value": "application/octet-stream"
									},
									{
										"key": "Content-Disposition",
										"type": "text",
										"value": "attachment"
									}
								],
								"body": {
									"mode": "file",
									"file": {
										"src": ""
									}
								},
								"url": {
									"raw": "{{serverURL}}/api/integrity/_generateintegritydata",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"integrity",
										"_generateintegritydata"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				}
			],
			"protocolProfileBehavior": {}
		},
		{
			"name": "Fix conflicts",
			"item": [
				{
					"name": "with_admin_user",
					"item": [
						{
							"name": "create folder",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "2d1f4319-9e32-455d-90db-ae3e299196e5",
										"exec": [
											"pm.test(\"Bundle uploaded sucessfully\", function () {",
											"    pm.response.to.have.status(200);",
											"",
											"    var jsonData = pm.response.json();",
											"    console.log(jsonData);",
											"",
											"    pm.expect(jsonData[\"bundleName\"]).to.eql(\"folder_integrity_test_demo.tar.gz\");",
											"    pm.expect(jsonData[\"status\"]).to.eql(\"SUCCESS\");",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "basic",
									"basic": [
										{
											"key": "username",
											"value": "admin@dotcms.com",
											"type": "string"
										},
										{
											"key": "password",
											"value": "admin",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"type": "text",
										"value": "application/octet-stream"
									},
									{
										"key": "Content-Disposition",
										"type": "text",
										"value": "attachment"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "file",
											"contentType": "application/tar+gzip ",
											"type": "file",
											"src": "/Users/freddyrodriguez/DOTCMS/core/dotCMS/src/curl-test/resources/Push_publish/folder_integrity_test_demo.tar.gz"
										}
									],
									"options": {
										"formdata": {}
									}
								},
								"url": {
									"raw": "{{serverURL}}/api/bundle/sync",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"bundle",
										"sync"
									]
								},
								"description": "Imports a Bundle that includes:\n*  A piece of content of type \"Rich text\" with \"test Content\" as title and body"
							},
							"response": []
						},
						{
							"name": "request_token",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "2673af26-ed03-4e15-ba26-9ea0c0908e3d",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData.errors.length).to.eql(0);",
											"    pm.expect(jsonData.entity).to.not.eq(undefined);",
											"    pm.expect(jsonData.entity.jwt).to.not.eq(undefined);",
											"    pm.collectionVariables.set(\"token\", jsonData.entity.jwt);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "basic",
									"basic": [
										{
											"key": "password",
											"value": "admin",
											"type": "string"
										},
										{
											"key": "username",
											"value": "admin@dotcms.com",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"claims\": {\n        \"label\": \"testing\"\n    },\n    \"expirationSeconds\": 94571365,\n    \"network\": \"0.0.0.0/0\",\n    \"userId\": \"dotcms.org.1\"\n}",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "{{serverURL}}/api/v1/apitoken",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"v1",
										"apitoken"
									]
								}
							},
							"response": []
						},
						{
							"name": "logout",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "19323924-d877-4aeb-9ae4-61e055fc157c",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{serverURL}}/api/v1/logout",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"v1",
										"logout"
									]
								}
							},
							"response": []
						},
						{
							"name": "Execute Task Upgrade",
							"request": {
								"auth": {
									"type": "basic",
									"basic": [
										{
											"key": "password",
											"value": "admin",
											"type": "string"
										},
										{
											"key": "username",
											"value": "admin@dotcms.com",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"upgradeTaskClass\":\"com.dotmarketing.startup.runonce.Task05390RemoveEndpointIdForeignKeyInIntegrityResolverTables\"\n}\n",
									"options": {
										"raw": {
											"language": "json"
										}
									}
								},
								"url": {
									"raw": "http://localhost:8080/api/v1/upgradetask",
									"protocol": "http",
									"host": [
										"localhost"
									],
									"port": "8080",
									"path": [
										"api",
										"v1",
										"upgradetask"
									]
								}
							},
							"response": []
						},
						{
							"name": "request_fix_conflicts",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "ad9f66ef-9f27-4ab8-8e59-1100d7cce987",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "bearer",
									"bearer": [
										{
											"key": "token",
											"value": "{{token}}",
											"type": "string"
										}
									]
								},
								"method": "POST",
								"header": [
									{
										"warning": "This is a duplicate header and will be overridden by the Content-Type header generated by Postman.",
										"key": "Content-Type",
										"value": "multipart/form-data",
										"type": "text"
									}
								],
								"body": {
									"mode": "formdata",
									"formdata": [
										{
											"key": "DATA_TO_FIX",
											"type": "file",
											"src": "/build/src/core/dotCMS/src/curl-test/resources/Push_publish/DataToFix.zip"
										},
										{
											"key": "TYPE",
											"value": "FOLDERS",
											"type": "text"
										}
									]
								},
								"url": {
									"raw": "{{serverURL}}/api/integrity/_fixconflictsfromremote",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"integrity",
										"_fixconflictsfromremote"
									]
								}
							},
							"response": []
						},
						{
							"name": "check folder id",
							"event": [
								{
									"listen": "test",
									"script": {
										"id": "1a6e5aff-7276-47a1-af74-5230e2515add",
										"exec": [
											"pm.test(\"Status code is 200\", function () {",
											"    pm.response.to.have.status(200);",
											"",
											"    var jsonData = pm.response.json();",
											"    pm.expect(jsonData[\"entity\"][\"identifier\"]).to.eql(\"ecf8d1d2-d150-4af8-9a0b-93bd53143c11\");",
											"});"
										],
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"auth": {
									"type": "basic",
									"basic": [
										{
											"key": "password",
											"value": "admin",
											"type": "string"
										},
										{
											"key": "username",
											"value": "admin@dotcms.com",
											"type": "string"
										}
									]
								},
								"method": "GET",
								"header": [],
								"url": {
									"raw": "{{serverURL}}/api/v1/folder/sitename/default/uri/folder_integrity_test_demo",
									"host": [
										"{{serverURL}}"
									],
									"path": [
										"api",
										"v1",
										"folder",
										"sitename",
										"default",
										"uri",
										"folder_integrity_test_demo"
									]
								}
							},
							"response": []
						}
					],
					"protocolProfileBehavior": {},
					"_postman_isSubFolder": true
				}
			],
			"protocolProfileBehavior": {}
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"id": "1445153e-5315-42db-9ece-8bdcb182aae3",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"id": "80980b55-233c-427a-9897-df788b1dccc4",
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"id": "e2d29d4e-c09b-44e4-917c-b522c8010b9e",
			"key": "serverURL",
			"value": "http://localhost:8080"
		},
		{
			"id": "2c415bb4-e0ab-4b1e-8e1c-97415d4be808",
			"key": "token",
			"value": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhcGkwYWIzNWEyZS0yZmNjLTRiNTktYTgzZC0yZGNhODQ1ZDJiNzMiLCJ4bW9kIjoxNjAyMjYyMzA0MDAwLCJuYmYiOjE2MDIyNjIzMDQsImlzcyI6ImI2ZTc1ZTIyNzMiLCJsYWJlbCI6InRlc3RpbmciLCJleHAiOjE2OTY4MzM2NjksImlhdCI6MTYwMjI2MjMwNCwianRpIjoiYjhkYTkzNzQtNThlNC00NTFkLThmM2QtYmZmMWQ5YjAyMGM4In0.fLNFl1RnrCEXrpkSMwCqBDlMRLHngkAPxugqW3x6FU4"
		},
		{
			"id": "68cc22b5-c200-4675-ad5e-05117c139b4c",
			"key": "bundle_id",
			"value": "bundle_1598948729120"
		},
		{
			"id": "2317e5d1-2c8f-44ec-a232-12930cd4d60b",
			"key": "transactionId",
			"value": "48db03da-d303-47cc-af29-9be490e99648"
		}
	],
	"protocolProfileBehavior": {}
}