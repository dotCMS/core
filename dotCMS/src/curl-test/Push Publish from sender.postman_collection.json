{
  "info": {
    "_postman_id": "46cc0b22-5ba5-4e67-a8d7-d29b8e9497f4",
    "name": "Push Publish from sender",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "5403727"
  },
  "item": [
    {
      "name": "Push Publish Old Way",
      "item": [
        {
          "name": "Happy path",
          "item": [
            {
              "name": "set USE_JWT_TOKEN_IN_PUSH_PUBLISH to false",
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "PUT",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"USE_JWT_TOKEN_IN_PUSH_PUBLISH\": false\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{serverURL}}/api/v1/configuration",
                  "host": ["{{serverURL}}"],
                  "path": ["api", "v1", "configuration"]
                }
              },
              "response": []
            },
            {
              "name": "create environment",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "",
                      "",
                      "environmentName = 'environment-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"environmentName\", environmentName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    var environmentId = pm.response.text();",
                      "    pm.collectionVariables.set(\"environmentId\", environmentId);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "value": "{{origin}}",
                    "type": "text"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction/cmd/addEnvironment?environmentName={{environmentName}}&pushType=pushToOne&whoCanUseSelect=e7d4e34e-5127-45fc-8123-d48b62d510e3&whoCanUse=e7d4e34e-5127-45fc-8123-d48b62d510e3",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction",
                    "cmd",
                    "addEnvironment"
                  ],
                  "query": [
                    {
                      "key": "environmentName",
                      "value": "{{environmentName}}"
                    },
                    {
                      "key": "pushType",
                      "value": "pushToOne"
                    },
                    {
                      "key": "whoCanUseSelect",
                      "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                    },
                    {
                      "key": "whoCanUse",
                      "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "create end point",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "endpointName = 'endpoint-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"endpointName\", endpointName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction/cmd/addEndpoint?sending=false&serverName={{endpointName}}&environmentId={{environmentId}}&protocol=http&address=localhost&port=8080&authKey=123&enabled=on",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction",
                    "cmd",
                    "addEndpoint"
                  ],
                  "query": [
                    {
                      "key": "sending",
                      "value": "false"
                    },
                    {
                      "key": "serverName",
                      "value": "{{endpointName}}"
                    },
                    {
                      "key": "environmentId",
                      "value": "{{environmentId}}"
                    },
                    {
                      "key": "protocol",
                      "value": "http"
                    },
                    {
                      "key": "address",
                      "value": "localhost"
                    },
                    {
                      "key": "port",
                      "value": "8080"
                    },
                    {
                      "key": "authKey",
                      "value": "123"
                    },
                    {
                      "key": "enabled",
                      "value": "on"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "create content type and content",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    },
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "type": "text",
                    "value": "application/octet-stream"
                  },
                  {
                    "key": "Content-Disposition",
                    "type": "text",
                    "value": "attachment"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "file",
                      "contentType": "application/tar+gzip ",
                      "type": "file",
                      "src": "resources/Push_publish/content_type_and_content_demo.tar.gz"
                    }
                  ]
                },
                "url": {
                  "raw": "{{serverURL}}/api/bundle/sync",
                  "host": ["{{serverURL}}"],
                  "path": ["api", "bundle", "sync"]
                },
                "description": "Imports a Bundle that includes:\n*  A piece of content of type \"Rich text\" with \"test Content\" as title and body"
              },
              "response": []
            },
            {
              "name": "Add bundle",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "bundleName = 'bundleName-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"bundleName\", bundleName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    var jsonData = pm.response.json();",
                      "    pm.collectionVariables.set(\"bundleId\", jsonData[\"bundleId\"]);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.ajax.RemotePublishAjaxAction/cmd/addToBundle?assetIdentifier=ea533f67-4883-42bb-9701-83293e7313e5&bundleName={{bundleName}}",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.ajax.RemotePublishAjaxAction",
                    "cmd",
                    "addToBundle"
                  ],
                  "query": [
                    {
                      "key": "assetIdentifier",
                      "value": "ea533f67-4883-42bb-9701-83293e7313e5"
                    },
                    {
                      "key": "bundleName",
                      "value": "{{bundleName}}"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "Push publish",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [""],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.ajax.RemotePublishAjaxAction/cmd/pushBundle?assetIdentifier={{bundleId}}&iWantTo=publish&whoToSend={{environmentId}}&remotePublishDate=2020-09-10&remotePublishTime=17-14",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.ajax.RemotePublishAjaxAction",
                    "cmd",
                    "pushBundle"
                  ],
                  "query": [
                    {
                      "key": "assetIdentifier",
                      "value": "{{bundleId}}"
                    },
                    {
                      "key": "iWantTo",
                      "value": "publish"
                    },
                    {
                      "key": "whoToSend",
                      "value": "{{environmentId}}"
                    },
                    {
                      "key": "remotePublishDate",
                      "value": "2020-09-10"
                    },
                    {
                      "key": "remotePublishTime",
                      "value": "17-14"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "check success status",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": ["", ""],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "",
                      "    checkBundleStatus = eval(pm.collectionVariables.get(\"checkBundleStatus\", checkBundleStatus.toString()));",
                      "",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    checkBundleStatus(pm.response.text(), [\"bundleSuccess\", \"endpointSuccess\"], \"check success status\");",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/html/portlet/ext/contentlet/publishing/view_publish_audit_detail.jsp?bundle={{bundleId}}",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "html",
                    "portlet",
                    "ext",
                    "contentlet",
                    "publishing",
                    "view_publish_audit_detail.jsp"
                  ],
                  "query": [
                    {
                      "key": "bundle",
                      "value": "{{bundleId}}"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "set USE_JWT_TOKEN_IN_PUSH_PUBLISH to true",
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "PUT",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"USE_JWT_TOKEN_IN_PUSH_PUBLISH\": true\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{serverURL}}/api/v1/configuration",
                  "host": ["{{serverURL}}"],
                  "path": ["api", "v1", "configuration"]
                }
              },
              "response": []
            }
          ]
        },
        {
          "name": "Invalid token",
          "item": [
            {
              "name": "set USE_JWT_TOKEN_IN_PUSH_PUBLISH to false",
              "request": {
                "method": "PUT",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"USE_JWT_TOKEN_IN_PUSH_PUBLISH\": false\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{serverURL}}/api/v1/configuration",
                  "host": ["{{serverURL}}"],
                  "path": ["api", "v1", "configuration"]
                }
              },
              "response": []
            },
            {
              "name": "create environment",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "",
                      "environmentName = 'environment-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"environmentName\", environmentName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    var environmentId = pm.response.text();",
                      "    pm.collectionVariables.set(\"environmentId\", environmentId);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "value": "{{origin}}",
                    "type": "text"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction/cmd/addEnvironment?environmentName={{environmentName}}&pushType=pushToOne&whoCanUseSelect=e7d4e34e-5127-45fc-8123-d48b62d510e3&whoCanUse=e7d4e34e-5127-45fc-8123-d48b62d510e3",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction",
                    "cmd",
                    "addEnvironment"
                  ],
                  "query": [
                    {
                      "key": "environmentName",
                      "value": "{{environmentName}}"
                    },
                    {
                      "key": "pushType",
                      "value": "pushToOne"
                    },
                    {
                      "key": "whoCanUseSelect",
                      "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                    },
                    {
                      "key": "whoCanUse",
                      "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "create end point",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "endpointName = 'endpoint-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"endpointName\", endpointName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction/cmd/addEndpoint?sending=false&serverName={{endpointName}}&environmentId={{environmentId}}&protocol=http&address=localhost&port=8080&authKey=invalid&enabled=on",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction",
                    "cmd",
                    "addEndpoint"
                  ],
                  "query": [
                    {
                      "key": "sending",
                      "value": "false"
                    },
                    {
                      "key": "serverName",
                      "value": "{{endpointName}}"
                    },
                    {
                      "key": "environmentId",
                      "value": "{{environmentId}}"
                    },
                    {
                      "key": "protocol",
                      "value": "http"
                    },
                    {
                      "key": "address",
                      "value": "localhost"
                    },
                    {
                      "key": "port",
                      "value": "8080"
                    },
                    {
                      "key": "authKey",
                      "value": "invalid"
                    },
                    {
                      "key": "enabled",
                      "value": "on"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "create content type and content",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    },
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "type": "text",
                    "value": "application/octet-stream"
                  },
                  {
                    "key": "Content-Disposition",
                    "type": "text",
                    "value": "attachment"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "file",
                      "contentType": "application/tar+gzip ",
                      "type": "file",
                      "src": "resources/Push_publish/content_type_and_content_demo.tar.gz"
                    }
                  ]
                },
                "url": {
                  "raw": "{{serverURL}}/api/bundle/sync",
                  "host": ["{{serverURL}}"],
                  "path": ["api", "bundle", "sync"]
                },
                "description": "Imports a Bundle that includes:\n*  A piece of content of type \"Rich text\" with \"test Content\" as title and body"
              },
              "response": []
            },
            {
              "name": "Add bundle",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "bundleName = 'bundleName-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"bundleName\", bundleName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    var jsonData = pm.response.json();",
                      "    pm.collectionVariables.set(\"bundleId\", jsonData[\"bundleId\"]);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.ajax.RemotePublishAjaxAction/cmd/addToBundle?assetIdentifier=ea533f67-4883-42bb-9701-83293e7313e5&bundleName={{bundleName}}",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.ajax.RemotePublishAjaxAction",
                    "cmd",
                    "addToBundle"
                  ],
                  "query": [
                    {
                      "key": "assetIdentifier",
                      "value": "ea533f67-4883-42bb-9701-83293e7313e5"
                    },
                    {
                      "key": "bundleName",
                      "value": "{{bundleName}}"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "Push publish",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [""],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.ajax.RemotePublishAjaxAction/cmd/pushBundle?assetIdentifier={{bundleId}}&iWantTo=publish&whoToSend={{environmentId}}&remotePublishDate=2020-09-10&remotePublishTime=17-14",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.ajax.RemotePublishAjaxAction",
                    "cmd",
                    "pushBundle"
                  ],
                  "query": [
                    {
                      "key": "assetIdentifier",
                      "value": "{{bundleId}}"
                    },
                    {
                      "key": "iWantTo",
                      "value": "publish"
                    },
                    {
                      "key": "whoToSend",
                      "value": "{{environmentId}}"
                    },
                    {
                      "key": "remotePublishDate",
                      "value": "2020-09-10"
                    },
                    {
                      "key": "remotePublishTime",
                      "value": "17-14"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "check failed status",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": ["", ""],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "",
                      "    checkBundleStatus = eval(pm.collectionVariables.get(\"checkBundleStatus\", checkBundleStatus.toString()));",
                      "",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    checkBundleStatus(pm.response.text(), [\"bundleFailed\", \"endpointInvalidtoken\"], \"check failed status\");",
                      "});",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/html/portlet/ext/contentlet/publishing/view_publish_audit_detail.jsp?bundle={{bundleId}}",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "html",
                    "portlet",
                    "ext",
                    "contentlet",
                    "publishing",
                    "view_publish_audit_detail.jsp"
                  ],
                  "query": [
                    {
                      "key": "bundle",
                      "value": "{{bundleId}}"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "set USE_JWT_TOKEN_IN_PUSH_PUBLISH to true",
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "PUT",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"USE_JWT_TOKEN_IN_PUSH_PUBLISH\": true\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{serverURL}}/api/v1/configuration",
                  "host": ["{{serverURL}}"],
                  "path": ["api", "v1", "configuration"]
                }
              },
              "response": []
            }
          ]
        }
      ],
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "type": "text/javascript",
            "exec": [""]
          }
        },
        {
          "listen": "test",
          "script": {
            "type": "text/javascript",
            "exec": [""]
          }
        }
      ]
    },
    {
      "name": "Push Publish JWT token",
      "item": [
        {
          "name": "Happy path",
          "item": [
            {
              "name": "request_token",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.errors.length).to.eql(0);",
                      "    pm.expect(jsonData.entity).to.not.eq(undefined);",
                      "    pm.expect(jsonData.entity.jwt).to.not.eq(undefined);",
                      "    pm.collectionVariables.set(\"token\", jsonData.entity.jwt);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"claims\": {\n        \"label\": \"testing\"\n    },\n    \"expirationSeconds\": 94571365,\n    \"network\": \"0.0.0.0/0\",\n    \"userId\": \"dotcms.org.1\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{serverURL}}/api/v1/apitoken",
                  "host": ["{{serverURL}}"],
                  "path": ["api", "v1", "apitoken"]
                }
              },
              "response": []
            },
            {
              "name": "create environment",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "",
                      "environmentName = 'environment-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"environmentName\", environmentName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    var environmentId = pm.response.text();",
                      "    pm.collectionVariables.set(\"environmentId\", environmentId);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "value": "{{origin}}",
                    "type": "text"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction/cmd/addEnvironment?environmentName={{environmentName}}&pushType=pushToOne&whoCanUseSelect=e7d4e34e-5127-45fc-8123-d48b62d510e3&whoCanUse=e7d4e34e-5127-45fc-8123-d48b62d510e3",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction",
                    "cmd",
                    "addEnvironment"
                  ],
                  "query": [
                    {
                      "key": "environmentName",
                      "value": "{{environmentName}}"
                    },
                    {
                      "key": "pushType",
                      "value": "pushToOne"
                    },
                    {
                      "key": "whoCanUseSelect",
                      "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                    },
                    {
                      "key": "whoCanUse",
                      "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "create end point",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "endpointName = 'endpoint-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"endpointName\", endpointName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction/cmd/addEndpoint?sending=false&serverName={{endpointName}}&environmentId={{environmentId}}&protocol=http&address=localhost&port=8080&authKey={{token}}&enabled=on",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction",
                    "cmd",
                    "addEndpoint"
                  ],
                  "query": [
                    {
                      "key": "sending",
                      "value": "false"
                    },
                    {
                      "key": "serverName",
                      "value": "{{endpointName}}"
                    },
                    {
                      "key": "environmentId",
                      "value": "{{environmentId}}"
                    },
                    {
                      "key": "protocol",
                      "value": "http"
                    },
                    {
                      "key": "address",
                      "value": "localhost"
                    },
                    {
                      "key": "port",
                      "value": "8080"
                    },
                    {
                      "key": "authKey",
                      "value": "{{token}}"
                    },
                    {
                      "key": "enabled",
                      "value": "on"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "create content type and content",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    },
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "type": "text",
                    "value": "application/octet-stream"
                  },
                  {
                    "key": "Content-Disposition",
                    "type": "text",
                    "value": "attachment"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "file",
                      "contentType": "application/tar+gzip ",
                      "type": "file",
                      "src": "resources/Push_publish/content_type_and_content_demo.tar.gz"
                    }
                  ]
                },
                "url": {
                  "raw": "{{serverURL}}/api/bundle/sync",
                  "host": ["{{serverURL}}"],
                  "path": ["api", "bundle", "sync"]
                },
                "description": "Imports a Bundle that includes:\n*  A piece of content of type \"Rich text\" with \"test Content\" as title and body"
              },
              "response": []
            },
            {
              "name": "Add bundle",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "bundleName = 'bundleName-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"bundleName\", bundleName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    var jsonData = pm.response.json();",
                      "    pm.collectionVariables.set(\"bundleId\", jsonData[\"bundleId\"]);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.ajax.RemotePublishAjaxAction/cmd/addToBundle?assetIdentifier=cc8d9edc-f01e-405d-b2c0-020869391bdb&bundleName={{bundleName}}",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.ajax.RemotePublishAjaxAction",
                    "cmd",
                    "addToBundle"
                  ],
                  "query": [
                    {
                      "key": "assetIdentifier",
                      "value": "cc8d9edc-f01e-405d-b2c0-020869391bdb"
                    },
                    {
                      "key": "bundleName",
                      "value": "{{bundleName}}"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "Push publish",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [""],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.ajax.RemotePublishAjaxAction/cmd/pushBundle?assetIdentifier={{bundleId}}&iWantTo=publish&whoToSend={{environmentId}}&remotePublishDate=2020-09-10&remotePublishTime=17-14",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.ajax.RemotePublishAjaxAction",
                    "cmd",
                    "pushBundle"
                  ],
                  "query": [
                    {
                      "key": "assetIdentifier",
                      "value": "{{bundleId}}"
                    },
                    {
                      "key": "iWantTo",
                      "value": "publish"
                    },
                    {
                      "key": "whoToSend",
                      "value": "{{environmentId}}"
                    },
                    {
                      "key": "remotePublishDate",
                      "value": "2020-09-10"
                    },
                    {
                      "key": "remotePublishTime",
                      "value": "17-14"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "check success status",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": ["", ""],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "",
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "",
                      "    checkBundleStatus = eval(pm.collectionVariables.get(\"checkBundleStatus\", checkBundleStatus.toString()));",
                      "",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    checkBundleStatus(pm.response.text(), [\"bundleSuccess\", \"endpointSuccess\"], \"check success status\");",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/html/portlet/ext/contentlet/publishing/view_publish_audit_detail.jsp?bundle={{bundleId}}",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "html",
                    "portlet",
                    "ext",
                    "contentlet",
                    "publishing",
                    "view_publish_audit_detail.jsp"
                  ],
                  "query": [
                    {
                      "key": "bundle",
                      "value": "{{bundleId}}"
                    }
                  ]
                }
              },
              "response": []
            }
          ]
        },
        {
          "name": "Expired token",
          "item": [
            {
              "name": "request_token",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    var jsonData = pm.response.json();",
                      "    pm.expect(jsonData.errors.length).to.eql(0);",
                      "    pm.expect(jsonData.entity).to.not.eq(undefined);",
                      "    pm.expect(jsonData.entity.jwt).to.not.eq(undefined);",
                      "    pm.collectionVariables.set(\"token\", jsonData.entity.jwt);",
                      "",
                      "    eval(pm.collectionVariables.get(\"wait\"))(2000); //wait 2 seconds",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"claims\": {\n        \"label\": \"testing\"\n    },\n    \"expirationSeconds\": 1,\n    \"network\": \"0.0.0.0/0\",\n    \"userId\": \"dotcms.org.1\"\n}",
                  "options": {
                    "raw": {
                      "language": "json"
                    }
                  }
                },
                "url": {
                  "raw": "{{serverURL}}/api/v1/apitoken",
                  "host": ["{{serverURL}}"],
                  "path": ["api", "v1", "apitoken"]
                }
              },
              "response": []
            },
            {
              "name": "create environment",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "",
                      "environmentName = 'environment-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"environmentName\", environmentName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    var environmentId = pm.response.text();",
                      "    pm.collectionVariables.set(\"environmentId\", environmentId);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "value": "{{origin}}",
                    "type": "text"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction/cmd/addEnvironment?environmentName={{environmentName}}&pushType=pushToOne&whoCanUseSelect=e7d4e34e-5127-45fc-8123-d48b62d510e3&whoCanUse=e7d4e34e-5127-45fc-8123-d48b62d510e3",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction",
                    "cmd",
                    "addEnvironment"
                  ],
                  "query": [
                    {
                      "key": "environmentName",
                      "value": "{{environmentName}}"
                    },
                    {
                      "key": "pushType",
                      "value": "pushToOne"
                    },
                    {
                      "key": "whoCanUseSelect",
                      "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                    },
                    {
                      "key": "whoCanUse",
                      "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "create end point",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "endpointName = 'endpoint-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"endpointName\", endpointName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction/cmd/addEndpoint?sending=false&serverName={{endpointName}}&environmentId={{environmentId}}&protocol=http&address=localhost&port=8080&authKey={{token}}&enabled=on",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction",
                    "cmd",
                    "addEndpoint"
                  ],
                  "query": [
                    {
                      "key": "sending",
                      "value": "false"
                    },
                    {
                      "key": "serverName",
                      "value": "{{endpointName}}"
                    },
                    {
                      "key": "environmentId",
                      "value": "{{environmentId}}"
                    },
                    {
                      "key": "protocol",
                      "value": "http"
                    },
                    {
                      "key": "address",
                      "value": "localhost"
                    },
                    {
                      "key": "port",
                      "value": "8080"
                    },
                    {
                      "key": "authKey",
                      "value": "{{token}}"
                    },
                    {
                      "key": "enabled",
                      "value": "on"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "create content type and content",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    },
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "type": "text",
                    "value": "application/octet-stream"
                  },
                  {
                    "key": "Content-Disposition",
                    "type": "text",
                    "value": "attachment"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "file",
                      "contentType": "application/tar+gzip ",
                      "type": "file",
                      "src": "resources/Push_publish/content_type_and_content_demo.tar.gz"
                    }
                  ]
                },
                "url": {
                  "raw": "{{serverURL}}/api/bundle/sync",
                  "host": ["{{serverURL}}"],
                  "path": ["api", "bundle", "sync"]
                },
                "description": "Imports a Bundle that includes:\n*  A piece of content of type \"Rich text\" with \"test Content\" as title and body"
              },
              "response": []
            },
            {
              "name": "Add bundle",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "bundleName = 'bundleName-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"bundleName\", bundleName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    var jsonData = pm.response.json();",
                      "    pm.collectionVariables.set(\"bundleId\", jsonData[\"bundleId\"]);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.ajax.RemotePublishAjaxAction/cmd/addToBundle?assetIdentifier=cc8d9edc-f01e-405d-b2c0-020869391bdb&bundleName={{bundleName}}",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.ajax.RemotePublishAjaxAction",
                    "cmd",
                    "addToBundle"
                  ],
                  "query": [
                    {
                      "key": "assetIdentifier",
                      "value": "cc8d9edc-f01e-405d-b2c0-020869391bdb"
                    },
                    {
                      "key": "bundleName",
                      "value": "{{bundleName}}"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "Push publish",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [""],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.ajax.RemotePublishAjaxAction/cmd/pushBundle?assetIdentifier={{bundleId}}&iWantTo=publish&whoToSend={{environmentId}}&remotePublishDate=2020-09-10&remotePublishTime=17-14",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.ajax.RemotePublishAjaxAction",
                    "cmd",
                    "pushBundle"
                  ],
                  "query": [
                    {
                      "key": "assetIdentifier",
                      "value": "{{bundleId}}"
                    },
                    {
                      "key": "iWantTo",
                      "value": "publish"
                    },
                    {
                      "key": "whoToSend",
                      "value": "{{environmentId}}"
                    },
                    {
                      "key": "remotePublishDate",
                      "value": "2020-09-10"
                    },
                    {
                      "key": "remotePublishTime",
                      "value": "17-14"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "check failed status",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": ["", ""],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "",
                      "    checkBundleStatus = eval(pm.collectionVariables.get(\"checkBundleStatus\", checkBundleStatus.toString()));",
                      "",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    checkBundleStatus(pm.response.text(), [\"bundleFailed\", \"endpointInvalidtoken\"], \"check failed status\");",
                      "});",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/html/portlet/ext/contentlet/publishing/view_publish_audit_detail.jsp?bundle={{bundleId}}",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "html",
                    "portlet",
                    "ext",
                    "contentlet",
                    "publishing",
                    "view_publish_audit_detail.jsp"
                  ],
                  "query": [
                    {
                      "key": "bundle",
                      "value": "{{bundleId}}"
                    }
                  ]
                }
              },
              "response": []
            }
          ]
        },
        {
          "name": "Invalid token",
          "item": [
            {
              "name": "create environment",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "",
                      "environmentName = 'environment-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"environmentName\", environmentName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    var environmentId = pm.response.text();",
                      "    pm.collectionVariables.set(\"environmentId\", environmentId);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "value": "{{origin}}",
                    "type": "text"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction/cmd/addEnvironment?environmentName={{environmentName}}&pushType=pushToOne&whoCanUseSelect=e7d4e34e-5127-45fc-8123-d48b62d510e3&whoCanUse=e7d4e34e-5127-45fc-8123-d48b62d510e3",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction",
                    "cmd",
                    "addEnvironment"
                  ],
                  "query": [
                    {
                      "key": "environmentName",
                      "value": "{{environmentName}}"
                    },
                    {
                      "key": "pushType",
                      "value": "pushToOne"
                    },
                    {
                      "key": "whoCanUseSelect",
                      "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                    },
                    {
                      "key": "whoCanUse",
                      "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "create end point",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "endpointName = 'endpoint-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"endpointName\", endpointName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction/cmd/addEndpoint?sending=false&serverName={{endpointName}}&environmentId={{environmentId}}&protocol=http&address=localhost&port=8080&authKey=invalid_token&enabled=on",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction",
                    "cmd",
                    "addEndpoint"
                  ],
                  "query": [
                    {
                      "key": "sending",
                      "value": "false"
                    },
                    {
                      "key": "serverName",
                      "value": "{{endpointName}}"
                    },
                    {
                      "key": "environmentId",
                      "value": "{{environmentId}}"
                    },
                    {
                      "key": "protocol",
                      "value": "http"
                    },
                    {
                      "key": "address",
                      "value": "localhost"
                    },
                    {
                      "key": "port",
                      "value": "8080"
                    },
                    {
                      "key": "authKey",
                      "value": "invalid_token"
                    },
                    {
                      "key": "enabled",
                      "value": "on"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "create content type and content",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    },
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "type": "text",
                    "value": "application/octet-stream"
                  },
                  {
                    "key": "Content-Disposition",
                    "type": "text",
                    "value": "attachment"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "file",
                      "contentType": "application/tar+gzip ",
                      "type": "file",
                      "src": "resources/Push_publish/content_type_and_content_demo.tar.gz"
                    }
                  ]
                },
                "url": {
                  "raw": "{{serverURL}}/api/bundle/sync",
                  "host": ["{{serverURL}}"],
                  "path": ["api", "bundle", "sync"]
                },
                "description": "Imports a Bundle that includes:\n*  A piece of content of type \"Rich text\" with \"test Content\" as title and body"
              },
              "response": []
            },
            {
              "name": "Add bundle",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "bundleName = 'bundleName-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"bundleName\", bundleName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    var jsonData = pm.response.json();",
                      "    pm.collectionVariables.set(\"bundleId\", jsonData[\"bundleId\"]);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.ajax.RemotePublishAjaxAction/cmd/addToBundle?assetIdentifier=cc8d9edc-f01e-405d-b2c0-020869391bdb&bundleName={{bundleName}}",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.ajax.RemotePublishAjaxAction",
                    "cmd",
                    "addToBundle"
                  ],
                  "query": [
                    {
                      "key": "assetIdentifier",
                      "value": "cc8d9edc-f01e-405d-b2c0-020869391bdb"
                    },
                    {
                      "key": "bundleName",
                      "value": "{{bundleName}}"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "Push publish",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [""],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.ajax.RemotePublishAjaxAction/cmd/pushBundle?assetIdentifier={{bundleId}}&iWantTo=publish&whoToSend={{environmentId}}&remotePublishDate=2020-09-10&remotePublishTime=17-14",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.ajax.RemotePublishAjaxAction",
                    "cmd",
                    "pushBundle"
                  ],
                  "query": [
                    {
                      "key": "assetIdentifier",
                      "value": "{{bundleId}}"
                    },
                    {
                      "key": "iWantTo",
                      "value": "publish"
                    },
                    {
                      "key": "whoToSend",
                      "value": "{{environmentId}}"
                    },
                    {
                      "key": "remotePublishDate",
                      "value": "2020-09-10"
                    },
                    {
                      "key": "remotePublishTime",
                      "value": "17-14"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "check failed status",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": ["", ""],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "",
                      "    checkBundleStatus = eval(pm.collectionVariables.get(\"checkBundleStatus\", checkBundleStatus.toString()));",
                      "",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    checkBundleStatus(pm.response.text(), [\"bundleFailed\", \"endpointInvalidtoken\"], \"check failed status\");",
                      "});",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/html/portlet/ext/contentlet/publishing/view_publish_audit_detail.jsp?bundle={{bundleId}}",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "html",
                    "portlet",
                    "ext",
                    "contentlet",
                    "publishing",
                    "view_publish_audit_detail.jsp"
                  ],
                  "query": [
                    {
                      "key": "bundle",
                      "value": "{{bundleId}}"
                    }
                  ]
                }
              },
              "response": []
            }
          ],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [""]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [""]
              }
            }
          ]
        },
        {
          "name": "When JWT fail should use old way",
          "item": [
            {
              "name": "create environment",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "",
                      "environmentName = 'environment-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"environmentName\", environmentName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    var environmentId = pm.response.text();",
                      "    pm.collectionVariables.set(\"environmentId\", environmentId);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "value": "{{origin}}",
                    "type": "text"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction/cmd/addEnvironment?environmentName={{environmentName}}&pushType=pushToOne&whoCanUseSelect=e7d4e34e-5127-45fc-8123-d48b62d510e3&whoCanUse=e7d4e34e-5127-45fc-8123-d48b62d510e3",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction",
                    "cmd",
                    "addEnvironment"
                  ],
                  "query": [
                    {
                      "key": "environmentName",
                      "value": "{{environmentName}}"
                    },
                    {
                      "key": "pushType",
                      "value": "pushToOne"
                    },
                    {
                      "key": "whoCanUseSelect",
                      "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                    },
                    {
                      "key": "whoCanUse",
                      "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "create end point",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "endpointName = 'endpoint-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"endpointName\", endpointName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction/cmd/addEndpoint?sending=false&serverName={{endpointName}}&environmentId={{environmentId}}&protocol=http&address=localhost&port=8080&authKey=123&enabled=on",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction",
                    "cmd",
                    "addEndpoint"
                  ],
                  "query": [
                    {
                      "key": "sending",
                      "value": "false"
                    },
                    {
                      "key": "serverName",
                      "value": "{{endpointName}}"
                    },
                    {
                      "key": "environmentId",
                      "value": "{{environmentId}}"
                    },
                    {
                      "key": "protocol",
                      "value": "http"
                    },
                    {
                      "key": "address",
                      "value": "localhost"
                    },
                    {
                      "key": "port",
                      "value": "8080"
                    },
                    {
                      "key": "authKey",
                      "value": "123"
                    },
                    {
                      "key": "enabled",
                      "value": "on"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "create receiver",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "receiverName = 'receiverName-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"receiverName\", receiverName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction/cmd/addEndpoint?sending=true&serverName={{receiverName}}&environmentId={{environmentId}}&address=localhost&authKey=123&enabled=on",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction",
                    "cmd",
                    "addEndpoint"
                  ],
                  "query": [
                    {
                      "key": "sending",
                      "value": "true"
                    },
                    {
                      "key": "serverName",
                      "value": "{{receiverName}}"
                    },
                    {
                      "key": "environmentId",
                      "value": "{{environmentId}}"
                    },
                    {
                      "key": "address",
                      "value": "localhost"
                    },
                    {
                      "key": "authKey",
                      "value": "123"
                    },
                    {
                      "key": "enabled",
                      "value": "on"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "create content type and content",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    },
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "type": "text",
                    "value": "application/octet-stream"
                  },
                  {
                    "key": "Content-Disposition",
                    "type": "text",
                    "value": "attachment"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": [
                    {
                      "key": "file",
                      "contentType": "application/tar+gzip ",
                      "type": "file",
                      "src": "resources/Push_publish/content_type_and_content_demo.tar.gz"
                    }
                  ]
                },
                "url": {
                  "raw": "{{serverURL}}/api/bundle/sync",
                  "host": ["{{serverURL}}"],
                  "path": ["api", "bundle", "sync"]
                },
                "description": "Imports a Bundle that includes:\n*  A piece of content of type \"Rich text\" with \"test Content\" as title and body"
              },
              "response": []
            },
            {
              "name": "Add bundle",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [
                      "bundleName = 'bundleName-' + new Date().getMilliseconds();",
                      "pm.collectionVariables.set(\"bundleName\", bundleName);",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    var jsonData = pm.response.json();",
                      "    pm.collectionVariables.set(\"bundleId\", jsonData[\"bundleId\"]);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.ajax.RemotePublishAjaxAction/cmd/addToBundle?assetIdentifier=ea533f67-4883-42bb-9701-83293e7313e5&bundleName={{bundleName}}",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.ajax.RemotePublishAjaxAction",
                    "cmd",
                    "addToBundle"
                  ],
                  "query": [
                    {
                      "key": "assetIdentifier",
                      "value": "ea533f67-4883-42bb-9701-83293e7313e5"
                    },
                    {
                      "key": "bundleName",
                      "value": "{{bundleName}}"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "Push publish",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": [""],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.ajax.RemotePublishAjaxAction/cmd/pushBundle?assetIdentifier={{bundleId}}&iWantTo=publish&whoToSend={{environmentId}}&remotePublishDate=2020-09-10&remotePublishTime=17-14",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "DotAjaxDirector",
                    "com.dotcms.publisher.ajax.RemotePublishAjaxAction",
                    "cmd",
                    "pushBundle"
                  ],
                  "query": [
                    {
                      "key": "assetIdentifier",
                      "value": "{{bundleId}}"
                    },
                    {
                      "key": "iWantTo",
                      "value": "publish"
                    },
                    {
                      "key": "whoToSend",
                      "value": "{{environmentId}}"
                    },
                    {
                      "key": "remotePublishDate",
                      "value": "2020-09-10"
                    },
                    {
                      "key": "remotePublishTime",
                      "value": "17-14"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "check success status",
              "event": [
                {
                  "listen": "prerequest",
                  "script": {
                    "exec": ["", ""],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "test",
                  "script": {
                    "exec": [
                      "pm.test(\"Bundle uploaded sucessfully\", function () {",
                      "",
                      "    checkBundleStatus = eval(pm.collectionVariables.get(\"checkBundleStatus\", checkBundleStatus.toString()));",
                      "",
                      "    pm.response.to.have.status(200);",
                      "",
                      "    checkBundleStatus(pm.response.text(), [\"endpointSuccess\"], \"check success status\");",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "request": {
                "auth": {
                  "type": "basic",
                  "basic": [
                    {
                      "key": "password",
                      "value": "admin",
                      "type": "string"
                    },
                    {
                      "key": "username",
                      "value": "admin@dotcms.com",
                      "type": "string"
                    }
                  ]
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Origin",
                    "type": "text",
                    "value": "{{origin}}"
                  }
                ],
                "body": {
                  "mode": "formdata",
                  "formdata": []
                },
                "url": {
                  "raw": "{{serverURL}}/html/portlet/ext/contentlet/publishing/view_publish_audit_detail.jsp?bundle={{bundleId}}",
                  "host": ["{{serverURL}}"],
                  "path": [
                    "html",
                    "portlet",
                    "ext",
                    "contentlet",
                    "publishing",
                    "view_publish_audit_detail.jsp"
                  ],
                  "query": [
                    {
                      "key": "bundle",
                      "value": "{{bundleId}}"
                    }
                  ]
                }
              },
              "response": []
            }
          ]
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "checkBundleStatus = (responseBody, casesToTest, requestToRepeat) => {",
          "    console.log(responseBody.trim().length, responseBody.trim().length === 0);",
          "    if (responseBody.trim().length === 0){",
          "        console.log('AGAIN 1');",
          "        postman.setNextRequest(requestToRepeat);",
          "    } else {",
          "",
          "        const $ = cheerio.load(responseBody);",
          "",
          "        bundleWaitingPublish = pm.collectionVariables.get(\"bundleWaitingPublish\");",
          "        pendingStatus = pm.collectionVariables.get(\"pendingStatus\");",
          "        bundlingStatus = pm.collectionVariables.get(\"bundlingStatus\");",
          "        noResultFound = pm.collectionVariables.get(\"noResultFound\");",
          "        publishingBundle = pm.collectionVariables.get(\"publishingBundle\");",
          "        bundleReceived = pm.collectionVariables.get(\"bundleReceived\");",
          "        bundleRetry = pm.collectionVariables.get(\"bundleRetry\");",  
          "",
          "        htmlWithoutSpace = $.html().replace(/(\\r\\n|\\n|\\r)/gm, \"\");",
          "",
          "        if (htmlWithoutSpace.includes(bundleWaitingPublish) || htmlWithoutSpace.includes(pendingStatus) || htmlWithoutSpace.includes(bundlingStatus) || htmlWithoutSpace.includes(noResultFound) || htmlWithoutSpace.includes(publishingBundle) || htmlWithoutSpace.includes(bundleReceived) || htmlWithoutSpace.includes('No bundle found with the given ID.')) {",
          "            console.log('No bundle found with the given ID.');",
          "            if (bundleRetry <= 2){",
          "                postman.setNextRequest(\"check success status\");",
          "            }",
          "            pm.collectionVariables.set(\"bundleRetry\", bundleRetry + 1);",
          "        } else {",
          "            casesToTest.forEach((caseToTest) => {",
          "                expectedInclude = pm.collectionVariables.get(caseToTest);",
          "                pm.expect(htmlWithoutSpace).to.contain(expectedInclude);",
          "            });",
          "",
          "        }",
          "    }",
          "};",
          "",
          "serverURL = pm.environment.get(\"serverURL\");",
          "",
          "console.log('hostName', serverURL);",
          "pm.collectionVariables.set(\"origin\", serverURL);",
          "",
          "pm.collectionVariables.set(\"checkBundleStatus\", checkBundleStatus.toString());",
          "",
          "wait = (ms) => {",
          "   var start = new Date().getTime();",
          "   var end = start;",
          "   while(end < start + ms) {",
          "     end = new Date().getTime();",
          "  }",
          "};",
          "",
          "pm.collectionVariables.set(\"bundleRetry\", 0);",
          "",
          "pm.collectionVariables.set(\"wait\", wait.toString());",
          "",
          "bundleSuccess = \"<th>Status:</th>        <td> Success</td>    </tr>\";",
          "pm.collectionVariables.set(\"bundleSuccess\", bundleSuccess);",
          "",
          "endpointSuccess = 'Everything ok';",
          "pm.collectionVariables.set(\"endpointSuccess\", endpointSuccess);",
          "",
          "bundleFailed = \" <th>Status:</th>        <td> Failed to send to all environments</td>\";",
          "pm.collectionVariables.set(\"bundleFailed\", bundleFailed);",
          "",
          "endpointInvalidtoken = '<td valign=\"top\">Authentication error</td>\t\t\t\t        <td valign=\"top\">Invalid token</td>\t';",
          "pm.collectionVariables.set(\"endpointInvalidtoken\", endpointInvalidtoken);",
          "",
          "bundleWaitingPublish = \"<th>Status:</th>        <td> Waiting for Publishing</td>    </tr>\";",
          "pm.collectionVariables.set(\"bundleWaitingPublish\", bundleWaitingPublish);",
          "",
          "pendingStatus = \"th>Status:</th>        <td> Pending</td\";",
          "pm.collectionVariables.set(\"pendingStatus\", pendingStatus);",
          "",
          "",
          "bundlingStatus = \"th>Status:</th>        <td> Bundling</td\";",
          "pm.collectionVariables.set(\"bundlingStatus\", bundlingStatus);",
          "",
          "noResultFound = \"No results found\";",
          "",
          "pm.collectionVariables.set(\"noResultFound\", noResultFound);",
          "",
          "publishingBundle = \"Publishing bundle\";",
          "pm.collectionVariables.set(\"publishingBundle\", publishingBundle);",
          "",
          "bundleReceived = \"Bundle Received\";",
          "pm.collectionVariables.set(\"bundleReceived\", bundleReceived);",
          "",
          "",
          ""
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [""]
      }
    }
  ],
  "variable": [
    {
      "key": "origin",
      "value": "http://localhost:8080"
    },
    {
      "key": "environmentName",
      "value": "environment-553"
    },
    {
      "key": "endpointName",
      "value": "endpoint-90"
    },
    {
      "key": "environmentId",
      "value": "8c65af5b-902f-4097-8538-f30b2b2c8fad"
    },
    {
      "key": "receiverName",
      "value": "receiverName-976"
    },
    {
      "key": "bundleName",
      "value": "bundleName-289"
    },
    {
      "key": "bundleID",
      "value": null
    },
    {
      "key": "bundleId",
      "value": "01FBJV0N46Q1KC0F1JMTQ3MWQ6"
    },
    {
      "key": "token",
      "value": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhcGk5MGY5MzgwZS03MGE0LTRlYmMtOGQ1Yy1hYjY2ZTc2NjI2NjkiLCJ4bW9kIjoxNjAwODk1ODY1MDAwLCJuYmYiOjE2MDA4OTU4NjUsImlzcyI6Ijc1MzI4OGMwODYiLCJsYWJlbCI6InRlc3RpbmciLCJleHAiOjE2OTU0NjcyMzAsImlhdCI6MTYwMDg5NTg2NSwianRpIjoiNmNjOTUxYzctMTIyNi00NzkxLTk4NzMtNDA1OTdjMWNhM2VmIn0.DNcI9_MIorM1HVWN3dERS5TAfjY72DfxQlhZ7s6lcik"
    },
    {
      "key": "bundleSuccessExpected",
      "value": "<tr>        <th>Title</th>        <td>                            <b><span>ea533f67-4883-42bb-9701-83293e7313e5</span></b> (contentlet)                                </td>    </tr>    <tr>        <th>Status:</th>        <td> Success</td>    </tr>"
    },
    {
      "key": "bundleFailedExpected",
      "value": " <th>Status:</th>        <td> Failed to send to all environments</td>"
    },
    {
      "key": "endpointInvalidtoken",
      "value": "<td valign=\"top\">Authentication error</td>\t\t\t\t        <td valign=\"top\">Invalid token</td>\t"
    },
    {
      "key": "endpointSuccess",
      "value": "Everything ok"
    },
    {
      "key": "bundleFailed",
      "value": " <th>Status:</th>        <td> Failed to send to all environments</td>"
    },
    {
      "key": "bundleSuccess",
      "value": "<th>Status:</th>        <td> Success</td>    </tr>"
    },
    {
      "key": "bundleWaitingPublish",
      "value": "<th>Status:</th>        <td> Waiting for Publishing</td>    </tr>"
    },
    {
      "key": "checkBundleStatus",
      "value": "(responseBody, casesToTest, requestToRepeat) => {\n    console.log(responseBody.trim().length, responseBody.trim().length === 0);\n    if (responseBody.trim().length === 0){\n        console.log('AGAIN 1');\n        postman.setNextRequest(requestToRepeat);\n    } else {\n\n        const $ = cheerio.load(responseBody);\n\n        bundleWaitingPublish = pm.collectionVariables.get(\"bundleWaitingPublish\");\n        pendingStatus = pm.collectionVariables.get(\"pendingStatus\");\n        bundlingStatus = pm.collectionVariables.get(\"bundlingStatus\");\n        noResultFound = pm.collectionVariables.get(\"noResultFound\");\n        publishingBundle = pm.collectionVariables.get(\"publishingBundle\");\n        bundleReceived = pm.collectionVariables.get(\"bundleReceived\");\n\n        htmlWithoutSpace = $.html().replace(/(\\r\\n|\\n|\\r)/gm, \"\");\n\n        if (htmlWithoutSpace.includes(bundleWaitingPublish) || htmlWithoutSpace.includes(pendingStatus) || htmlWithoutSpace.includes(bundlingStatus) || htmlWithoutSpace.includes(noResultFound) || htmlWithoutSpace.includes(publishingBundle) || htmlWithoutSpace.includes(bundleReceived) || htmlWithoutSpace.includes(bundleReceived)) {\n            console.log('No bundle found with the given ID.');\n            postman.setNextRequest(\"check success status\");\n        } else {\n            casesToTest.forEach((caseToTest) => {\n                expectedInclude = pm.collectionVariables.get(caseToTest);\n                pm.expect(htmlWithoutSpace).to.contain(expectedInclude);\n            });\n\n        }\n    }\n}"
    },
    {
      "key": "wait",
      "value": "(ms) => {\n   var start = new Date().getTime();\n   var end = start;\n   while(end < start + ms) {\n     end = new Date().getTime();\n  }\n}"
    },
    {
      "key": "bundleReceived",
      "value": "Bundle Received"
    },
    {
      "key": "bundlingStatus",
      "value": "th>Status:</th>        <td> Bundling</td"
    },
    {
      "key": "noResultFound",
      "value": "No results found"
    },
    {
      "key": "pendingStatus",
      "value": "th>Status:</th>        <td> Pending</td"
    },
    {
      "key": "publishingBundle",
      "value": "Publishing bundle"
    }
  ]
}
