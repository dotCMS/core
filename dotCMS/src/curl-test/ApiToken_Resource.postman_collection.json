{
	"info": {
		"_postman_id": "e676824d-6e3f-469b-a94c-cd6b7df0e131",
		"name": "ApiToken Resource",
		"description": "Tests for the api token",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "29183826"
	},
	"item": [
		{
			"name": "remote",
			"item": [
				{
					"name": "set ENABLE_PROXY_TOKEN_REQUESTS to false",
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "username",
									"value": "admin@dotcms.com",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"ENABLE_PROXY_TOKEN_REQUESTS\": false\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{serverURL}}/api/v1/configuration",
							"host": [
								"{{serverURL}}"
							],
							"path": [
								"api",
								"v1",
								"configuration"
							]
						}
					},
					"response": []
				},
				{
					"name": "createToken remote (disabled)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code should be 403\", function () {",
									"    pm.response.to.have.status(403);",
									"});",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "username",
									"value": "admin@dotcms.com",
									"type": "string"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"auth\": {\n        \"login\": \"admin@dotcms.com\", \n        \"password\": \"YWRtaW4=\"\n    },\n    \"remote\": {\n        \"host\": \"{{remoteTokenHost}}\", \n        \"port\": \"{{remoteTokenPort}}\", \n        \"protocol\": \"http\"\n    },\n    \"token\": {\n        \"expirationSeconds\": 94575023, \n        \"network\": \"0.0.0.0/0\", \n        \"userId\": \"dotcms.org.1\",\n        \"claims\": {\n            \"label\": \"Push Publish\"            \n        }\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{serverURL}}/api/v1/apitoken/remote",
							"host": [
								"{{serverURL}}"
							],
							"path": [
								"api",
								"v1",
								"apitoken",
								"remote"
							]
						},
						"description": "Create a new remote token should response 403 when ENABLE_PROXY_TOKEN_REQUESTS is set to false"
					},
					"response": []
				},
				{
					"name": "set ENABLE_PROXY_TOKEN_REQUESTS to true",
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "username",
									"value": "admin@dotcms.com",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"ENABLE_PROXY_TOKEN_REQUESTS\": true\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{serverURL}}/api/v1/configuration",
							"host": [
								"{{serverURL}}"
							],
							"path": [
								"api",
								"v1",
								"configuration"
							]
						}
					},
					"response": []
				},
				{
					"name": "createToken remote",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code should be 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"",
									"pm.test(\"User Id should be dotcms.org.1\", function () {",
									"    pm.expect(jsonData.entity.token.userId).to.eql('dotcms.org.1');",
									"});",
									"",
									"pm.collectionVariables.set(\"tokenid\", jsonData.entity.token.id);"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "username",
									"value": "admin@dotcms.com",
									"type": "string"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"auth\": {\n        \"login\": \"admin@dotcms.com\", \n        \"password\": \"YWRtaW4=\"\n    },\n    \"remote\": {\n        \"host\": \"{{remoteTokenHost}}\", \n        \"port\": \"{{remoteTokenPort}}\", \n        \"protocol\": \"http\"\n    },\n    \"token\": {\n        \"expirationSeconds\": 94575023, \n        \"network\": \"0.0.0.0/0\", \n        \"userId\": \"dotcms.org.1\",\n        \"claims\": {\n            \"label\": \"Push Publish\"            \n        }\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{serverURL}}/api/v1/apitoken/remote",
							"host": [
								"{{serverURL}}"
							],
							"path": [
								"api",
								"v1",
								"apitoken",
								"remote"
							]
						},
						"description": "Create a new remote token"
					},
					"response": []
				},
				{
					"name": "logout",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{serverURL}}/api/v1/logout",
							"host": [
								"{{serverURL}}"
							],
							"path": [
								"api",
								"v1",
								"logout"
							]
						},
						"description": "Logout before try with invalid user"
					},
					"response": []
				},
				{
					"name": "createToken remote with invalid local user",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code should be 401\", function () {",
									"    pm.response.to.have.status(401);",
									"});",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "username",
									"value": "invalid_user",
									"type": "string"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"auth\": {\n        \"login\": \"admin@dotcms.com\", \n        \"password\": \"YWRtaW4=\"\n    },\n    \"remote\": {\n        \"host\": \"{{remoteTokenHost}}\", \n        \"port\": \"{{remoteTokenPort}}\", \n        \"protocol\": \"http\"\n    },\n    \"token\": {\n        \"expirationSeconds\": 94575023, \n        \"network\": \"0.0.0.0/0\", \n        \"userId\": \"dotcms.org.1\",\n        \"claims\": {\n            \"label\": \"Push Publish\"            \n        }\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{serverURL}}/api/v1/apitoken/remote",
							"host": [
								"{{serverURL}}"
							],
							"path": [
								"api",
								"v1",
								"apitoken",
								"remote"
							]
						},
						"description": "Try to create a new remote token with a invalid local user, it mean send a invalid_user in the auth header"
					},
					"response": []
				},
				{
					"name": "createToken remote with invalid remote host",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code should be 404\", function () {",
									"    pm.response.to.have.status(404);",
									"});",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "username",
									"value": "admin@dotcms.com",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"auth\": {\n        \"login\": \"admin@dotcms.com\", \n        \"password\": \"YWRtaW4=\"\n    },\n    \"remote\": {\n        \"host\": \"not_exists\", \n        \"port\": \"{{remoteTokenPort}}\", \n        \"protocol\": \"http\"\n    },\n    \"token\": {\n        \"expirationSeconds\": 94575023, \n        \"network\": \"0.0.0.0/0\", \n        \"userId\": \"dotcms.org.1\",\n        \"claims\": {\n            \"label\": \"Push Publish\"            \n        }\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{serverURL}}/api/v1/apitoken/remote",
							"host": [
								"{{serverURL}}"
							],
							"path": [
								"api",
								"v1",
								"apitoken",
								"remote"
							]
						},
						"description": "Try to create a new remote token with a invalid local user, it mean send a invalid_user in the auth header"
					},
					"response": []
				},
				{
					"name": "createToken remote with invalid remote host witn numbers",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code should be 404\", function () {",
									"    pm.response.to.have.status(404);",
									"});",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								},
								{
									"key": "username",
									"value": "admin@dotcms.com",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"auth\": {\n        \"login\": \"admin@dotcms.com\", \n        \"password\": \"YWRtaW4=\"\n    },\n    \"remote\": {\n        \"host\": \"123\",  \n        \"port\": \"{{remoteTokenPort}}\", \n        \"protocol\": \"http\"\n    },\n    \"token\": {\n        \"expirationSeconds\": 94575023, \n        \"network\": \"0.0.0.0/0\", \n        \"userId\": \"dotcms.org.1\",\n        \"claims\": {\n            \"label\": \"Push Publish\"            \n        }\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{serverURL}}/api/v1/apitoken/remote",
							"host": [
								"{{serverURL}}"
							],
							"path": [
								"api",
								"v1",
								"apitoken",
								"remote"
							]
						},
						"description": "Try to create a new remote token with a invalid local user, it mean send a invalid_user in the auth header"
					},
					"response": []
				},
				{
					"name": "createToken remote with invalid remote user",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code should be 401\", function () {",
									"    pm.response.to.have.status(401);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "username",
									"value": "admin@dotcms.com",
									"type": "string"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"auth\": {\n        \"login\": \"invalid_user\", \n        \"password\": \"YWRtaW4=\"\n    },\n    \"remote\": {\n        \"host\": \"{{remoteTokenHost}}\", \n        \"port\": \"{{remoteTokenPort}}\", \n        \"protocol\": \"http\"\n    },\n    \"token\": {\n        \"expirationSeconds\": 94575023, \n        \"network\": \"0.0.0.0/0\", \n        \"userId\": \"dotcms.org.1\",\n        \"claims\": {\n            \"label\": \"Push Publish\"            \n        }\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{serverURL}}/api/v1/apitoken/remote",
							"host": [
								"{{serverURL}}"
							],
							"path": [
								"api",
								"v1",
								"apitoken",
								"remote"
							]
						},
						"description": "Try to create a new remote token with a remote user, it mean send a inavlid user in the body request auth section"
					},
					"response": []
				},
				{
					"name": "createToken remote with empty remote user",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code should be 400\", function () {",
									"    pm.response.to.have.status(400);",
									"});",
									""
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "basic",
							"basic": [
								{
									"key": "username",
									"value": "admin@dotcms.com",
									"type": "string"
								},
								{
									"key": "password",
									"value": "admin",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"type": "text",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"auth\": {\n        \"login\": \"\", \n        \"password\": \"\"\n    },\n    \"remote\": {\n        \"host\": \"{{remoteTokenHost}}\", \n        \"port\": \"{{remoteTokenPort}}\", \n        \"protocol\": \"http\"\n    },\n    \"token\": {\n        \"expirationSeconds\": 94575023, \n        \"network\": \"0.0.0.0/0\", \n        \"userId\": \"dotcms.org.1\",\n        \"claims\": {\n            \"label\": \"Push Publish\"            \n        }\n    }\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{serverURL}}/api/v1/apitoken/remote",
							"host": [
								"{{serverURL}}"
							],
							"path": [
								"api",
								"v1",
								"apitoken",
								"remote"
							]
						},
						"description": "Create a new remote token should response 403 when ENABLE_PROXY_TOKEN_REQUESTS is set to false"
					},
					"response": []
				}
			],
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"type": "text/javascript",
						"exec": [
							"serverURL = pm.environment.get(\"serverURL\");",
							"console.log('serverURL', serverURL);",
							"",
							"endProtocol = serverURL.indexOf(\"://\");",
							"console.log('endProtocol', endProtocol);",
							"startPort = serverURL.indexOf(\":\", endProtocol + 3);",
							"console.log('startPort', startPort);",
							"",
							"serverName = serverURL.substring(endProtocol + 3, startPort);",
							"console.log('serverName', serverName);",
							"",
							"endPort = serverURL.indexOf(\"/\", startPort);",
							"console.log('endPort', endPort);",
							"",
							"if (endPort == -1) {",
							"    endPort = serverURL.length;",
							"}",
							"",
							"port = serverURL.substring(startPort + 1, endPort);",
							"console.log('port', port);",
							"",
							"pm.collectionVariables.set(\"remoteTokenPort\", port);",
							"pm.collectionVariables.set(\"remoteTokenHost\", serverName);"
						]
					}
				},
				{
					"listen": "test",
					"script": {
						"type": "text/javascript",
						"exec": [
							""
						]
					}
				}
			]
		},
		{
			"name": "createToken",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code should be 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"var jsonData = pm.response.json();",
							"",
							"pm.test(\"User Id should be dotcms.org.1\", function () {",
							"    pm.expect(jsonData.entity.token.userId).to.eql('dotcms.org.1');",
							"});",
							"",
							"pm.collectionVariables.set(\"tokenid\", jsonData.entity.token.id);",
							"",
							"pm.test(\"Token should expire after certain duration\", function () {",
							"    const currentTimestamp = Math.floor(Date.now() / 1000);",
							"    const expirationTime = jsonData.entity.token.expiresDate;",
							"    pm.expect(expirationTime).to.be.above(currentTimestamp);",
							"});",
							"",
							"pm.test(\"Token ID should be unique\", function () {",
							"    const tokenID = jsonData.entity.token.id;",
							"    pm.collectionVariables.get(\"tokenIDs\") || pm.collectionVariables.set(\"tokenIDs\", []);",
							"    const tokenIDs = pm.collectionVariables.get(\"tokenIDs\");",
							"    pm.expect(tokenIDs).to.not.include(tokenID);",
							"    tokenIDs.push(tokenID);",
							"    pm.collectionVariables.set(\"tokenIDs\", tokenIDs);",
							"});",
							"",
							"pm.test(\"Token should be securely generated\", function () {",
							"    const jwtToken = jsonData.entity.jwt;",
							"    // Add your custom logic to check the security of the JWT token",
							"    pm.expect(jwtToken.length).to.be.above(50);  // Example: Check for a minimum length",
							"    pm.expect(jwtToken).to.match(/^[A-Za-z0-9-_=]+\\.[A-Za-z0-9-_=]+\\.[A-Za-z0-9-_.+/=]+$/);  // Example: Check for a typical JWT format",
							"});",
							"",
							"pm.test(\"Rate-limit shouldn't exceed\", function () {",
							"    // Adjust the expected status code and message based on your API's rate limiting response",
							"    const expectedRateLimitStatusCode = 429; // HTTP status code for Too Many Requests",
							"    const expectedRateLimitMessage = \"Rate Limit Exceeded\"; // Message indicating rate limit exceeded",
							"",
							"    if (pm.response.code === expectedRateLimitStatusCode) {",
							"        // Rate limit exceeded, which is expected behavior",
							"        pm.expect(pm.response.text()).to.include(expectedRateLimitMessage);",
							"    } else {",
							"        ",
							"        pm.expect(pm.response.code).to.eql(200);",
							"    }",
							"});",
							"",
							""
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "username",
							"value": "admin@dotcms.com",
							"type": "string"
						},
						{
							"key": "password",
							"value": "admin",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"userId\":\"dotcms.org.1\",\n\t\"tokenId\":\"123\",\n\t\"expirationSeconds\":\"100000\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{serverURL}}/api/v1/apitoken",
					"host": [
						"{{serverURL}}"
					],
					"path": [
						"api",
						"v1",
						"apitoken"
					]
				}
			},
			"response": [
				{
					"name": "createToken",
					"originalRequest": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"name": "Content-Type",
								"value": "application/json",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n\t\"userId\":\"dotcms.org.1\",\n\t\"tokenId\":\"123\",\n\t\"expirationSeconds\":\"100000\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "localhost:8082/api/v1/apitoken",
							"host": [
								"localhost"
							],
							"port": "8082",
							"path": [
								"api",
								"v1",
								"apitoken"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Strict-Transport-Security",
							"value": "max-age=3600;includeSubDomains"
						},
						{
							"key": "X-Frame-Options",
							"value": "SAMEORIGIN"
						},
						{
							"key": "X-Content-Type-Options",
							"value": "nosniff"
						},
						{
							"key": "X-XSS-Protection",
							"value": "1; mode=block"
						},
						{
							"key": "x-dot-server",
							"value": "unknown|71e4da58e2"
						},
						{
							"key": "Access-Control-Allow-Origin",
							"value": "*"
						},
						{
							"key": "Access-Control-Allow-Methods",
							"value": "GET,PUT,POST,DELETE,HEAD,OPTIONS,PATCH"
						},
						{
							"key": "Access-Control-Allow-Credentials",
							"value": "true"
						},
						{
							"key": "Access-Control-Allow-Headers",
							"value": "*"
						},
						{
							"key": "Access-Control-Expose-Headers",
							"value": "*"
						},
						{
							"key": "Cache-Control",
							"value": "no-cache, no-store, must-revalidate"
						},
						{
							"key": "Pragma",
							"value": "no-cache"
						},
						{
							"key": "Expires",
							"value": "Mon, 26 Jul 1997 05:00:00 GMT"
						},
						{
							"key": "vary",
							"value": "accept-encoding"
						},
						{
							"key": "Content-Encoding",
							"value": "gzip"
						},
						{
							"key": "Content-Type",
							"value": "application/json"
						},
						{
							"key": "Transfer-Encoding",
							"value": "chunked"
						},
						{
							"key": "Date",
							"value": "Tue, 21 Nov 2023 09:03:27 GMT"
						},
						{
							"key": "Keep-Alive",
							"value": "timeout=3"
						},
						{
							"key": "Connection",
							"value": "keep-alive"
						}
					],
					"cookie": [],
					"body": "{\n    \"entity\": {\n        \"jwt\": \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhcGlmMzQ4YTUyYS03OWRhLTRiMDEtYTg1NC1hNGI1MjE4NjczYWEiLCJ4bW9kIjoxNzAwNTU3NDA3MDAwLCJuYmYiOjE3MDA1NTc0MDcsImlzcyI6ImRvdGNtcy1wcm9kdWN0aW9uIiwiZXhwIjoxNzAwNjU3NDA3LCJpYXQiOjE3MDA1NTc0MDcsImp0aSI6ImM2MjZjYjkwLWU3MTgtNDQ5My05NTEwLTE4MDEwZjMxNzYwOSJ9.JhNzrTCjG4utteoSGG9ansOVCK_KMXIeVAODurwbOXA\",\n        \"token\": {\n            \"allowNetwork\": null,\n            \"claims\": {},\n            \"expired\": false,\n            \"expiresDate\": 1700657407000,\n            \"id\": \"apif348a52a-79da-4b01-a854-a4b5218673aa\",\n            \"issueDate\": 1700557407000,\n            \"issuer\": \"dotcms-production\",\n            \"modificationDate\": 1700557407000,\n            \"notBeforeDate\": false,\n            \"requestingIp\": \"172.19.0.1\",\n            \"requestingUserId\": \"dotcms.org.1\",\n            \"revoked\": false,\n            \"revokedDate\": null,\n            \"subject\": \"apif348a52a-79da-4b01-a854-a4b5218673aa\",\n            \"tokenType\": \"API_TOKEN\",\n            \"userId\": \"dotcms.org.1\",\n            \"valid\": true\n        }\n    },\n    \"errors\": [],\n    \"i18nMessagesMap\": {},\n    \"messages\": [],\n    \"pagination\": null,\n    \"permissions\": []\n}"
				}
			]
		},
		{
			"name": "createToken with userId equal to null",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code should be 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"var jsonData = pm.response.json();",
							"",
							"pm.test(\"User Id should be dotcms.org.1\", function () {",
							"    pm.expect(jsonData.entity.token.userId).to.eql('dotcms.org.1');",
							"});",
							"",
							"pm.collectionVariables.set(\"tokenid\", jsonData.entity.token.id);",
							"",
							"pm.test(\"Token should expire\", function () {",
							"    const currentTimestamp = Math.floor(Date.now() / 1000);",
							"    const expirationTime = jsonData.entity.token.expiresDate;",
							"    pm.expect(expirationTime).to.be.above(currentTimestamp);",
							"});",
							"",
							"pm.test(\"Token ID should be unique\", function () {",
							"    const tokenID = jsonData.entity.token.id;",
							"    pm.collectionVariables.get(\"tokenIDs\") || pm.collectionVariables.set(\"tokenIDs\", []);",
							"    const tokenIDs = pm.collectionVariables.get(\"tokenIDs\");",
							"    pm.expect(tokenIDs).to.not.include(tokenID);",
							"    tokenIDs.push(tokenID);",
							"    pm.collectionVariables.set(\"tokenIDs\", tokenIDs);",
							"});",
							"",
							"pm.test(\"Token should be securely generated\", function () {",
							"    const jwtToken = jsonData.entity.jwt;",
							"    // Add your custom logic to check the security of the JWT token",
							"    pm.expect(jwtToken.length).to.be.above(50);  // Example: Check for a minimum length",
							"    pm.expect(jwtToken).to.match(/^[A-Za-z0-9-_=]+\\.[A-Za-z0-9-_=]+\\.[A-Za-z0-9-_.+/=]+$/);  // Example: Check for a typical JWT format",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "username",
							"value": "admin@dotcms.com",
							"type": "string"
						},
						{
							"key": "password",
							"value": "admin",
							"type": "string"
						}
					]
				},
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"name": "Content-Type",
						"type": "text",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n\t\"tokenId\":\"123\",\n\t\"expirationSeconds\":\"100000\"\n}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{serverURL}}/api/v1/apitoken",
					"host": [
						"{{serverURL}}"
					],
					"path": [
						"api",
						"v1",
						"apitoken"
					]
				}
			},
			"response": []
		},
		{
			"name": "getApiTokens",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code should be 200\", function() {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"var jsonData = pm.response.json();",
							"",
							"pm.test(\"User Id should be dotcms.org.1\", function() {",
							"    pm.expect(jsonData.entity.tokens.length).to.be.above(0);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "admin",
							"type": "string"
						},
						{
							"key": "username",
							"value": "admin@dotcms.com",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{serverURL}}/api/v1/apitoken/dotcms.org.1/tokens",
					"host": [
						"{{serverURL}}"
					],
					"path": [
						"api",
						"v1",
						"apitoken",
						"dotcms.org.1",
						"tokens"
					]
				},
				"description": "Get tokens of admin user"
			},
			"response": []
		},
		{
			"name": "getJwtFromApiToken",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code should be 200\", function() {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has a valid JWT\", function () {",
							"    pm.expect(pm.response.json().entity.jwt).to.match(/^[A-Za-z0-9-_]+\\.[A-Za-z0-9-_]+\\.[A-Za-z0-9-_.+/=]*$/);",
							"});",
							"",
							"pm.test(\"Response contains appropriate error message\", function () {",
							"    pm.expect(pm.response.json().message).to.include(\"token id not found\");",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "admin",
							"type": "string"
						},
						{
							"key": "username",
							"value": "admin@dotcms.com",
							"type": "string"
						}
					]
				},
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{serverURL}}/api/v1/apitoken/api94c22c47-6668-4ed3-b901-520eb0aa159/jwt",
					"host": [
						"{{serverURL}}"
					],
					"path": [
						"api",
						"v1",
						"apitoken",
						"api94c22c47-6668-4ed3-b901-520eb0aa159",
						"jwt"
					]
				}
			},
			"response": []
		},
		{
			"name": "revokeApiToken",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code should be 200\", function() {",
							"    pm.response.to.have.status(200);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "admin",
							"type": "string"
						},
						{
							"key": "username",
							"value": "admin@dotcms.com",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [],
				"url": {
					"raw": "{{serverURL}}/api/v1/apitoken/{{tokenid}}/revoke",
					"host": [
						"{{serverURL}}"
					],
					"path": [
						"api",
						"v1",
						"apitoken",
						"{{tokenid}}",
						"revoke"
					]
				}
			},
			"response": []
		},
		{
			"name": "revokeApiToken Copy",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code should be 200\", function() {",
							"    pm.response.to.have.status(200);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "admin",
							"type": "string"
						},
						{
							"key": "username",
							"value": "admin@dotcms.com",
							"type": "string"
						}
					]
				},
				"method": "DELETE",
				"header": [],
				"url": {
					"raw": "{{serverURL}}/api/v1/apitoken/{{tokenid}}",
					"host": [
						"{{serverURL}}"
					],
					"path": [
						"api",
						"v1",
						"apitoken",
						"{{tokenid}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "revokeUserToken",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code should be 200\", function() {",
							"    pm.response.to.have.status(200);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "admin",
							"type": "string"
						},
						{
							"key": "username",
							"value": "admin@dotcms.com",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [],
				"url": {
					"raw": "{{serverURL}}/api/v1/apitoken/users/dotcms.org.1/revoke",
					"host": [
						"{{serverURL}}"
					],
					"path": [
						"api",
						"v1",
						"apitoken",
						"users",
						"dotcms.org.1",
						"revoke"
					]
				}
			},
			"response": []
		},
		{
			"name": "revokeUsersToken",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code should be 200\", function() {",
							"    pm.response.to.have.status(200);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"auth": {
					"type": "basic",
					"basic": [
						{
							"key": "password",
							"value": "admin",
							"type": "string"
						},
						{
							"key": "username",
							"value": "admin@dotcms.com",
							"type": "string"
						}
					]
				},
				"method": "PUT",
				"header": [],
				"url": {
					"raw": "{{serverURL}}/api/v1/apitoken/users/revoke",
					"host": [
						"{{serverURL}}"
					],
					"path": [
						"api",
						"v1",
						"apitoken",
						"users",
						"revoke"
					]
				}
			},
			"response": []
		}
	],
	"variable": [
		{
			"key": "tokenid",
			"value": "apiec1d0bc7-4122-499a-8b29-1006684c9059"
		},
		{
			"key": "remoteTokenHost",
			"value": "localhost"
		},
		{
			"key": "remoteTokenPort",
			"value": "8080"
		},
		{
			"key": "tokenIDs",
			"value": ""
		}
	]
}
