{
  "info": {
    "_postman_id": "315ce7e0-1672-4067-ba47-00fd1cea44a7",
    "name": "Integrity Checker From Sender",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_exporter_id": "5403727"
  },
  "item": [
    {
      "name": "Generate ",
      "item": [
        {
          "name": "old Way",
          "item": [
            {
              "name": "Happy path",
              "item": [
                {
                  "name": "set USE_JWT_TOKEN_IN_PUSH_PUBLISH to false",
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "PUT",
                    "header": [],
                    "body": {
                      "mode": "raw",
                      "raw": "{\n    \"USE_JWT_TOKEN_IN_PUSH_PUBLISH\": false\n}",
                      "options": {
                        "raw": {
                          "language": "json"
                        }
                      }
                    },
                    "url": {
                      "raw": "{{serverURL}}/api/v1/configuration",
                      "host": ["{{serverURL}}"],
                      "path": ["api", "v1", "configuration"]
                    }
                  },
                  "response": []
                },
                {
                  "name": "create environment",
                  "event": [
                    {
                      "listen": "prerequest",
                      "script": {
                        "exec": [
                          "",
                          "environmentName = 'environment-' + new Date().getMilliseconds();",
                          "pm.collectionVariables.set(\"environmentName\", environmentName);",
                          ""
                        ],
                        "type": "text/javascript"
                      }
                    },
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "",
                          "    var environmentId = pm.response.text();",
                          "    pm.collectionVariables.set(\"environmentId\", environmentId);",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "POST",
                    "header": [
                      {
                        "key": "Origin",
                        "value": "{{origin}}",
                        "type": "text"
                      }
                    ],
                    "body": {
                      "mode": "formdata",
                      "formdata": []
                    },
                    "url": {
                      "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction/cmd/addEnvironment?environmentName={{environmentName}}&pushType=pushToOne&whoCanUseSelect=e7d4e34e-5127-45fc-8123-d48b62d510e3&whoCanUse=e7d4e34e-5127-45fc-8123-d48b62d510e3",
                      "host": ["{{serverURL}}"],
                      "path": [
                        "DotAjaxDirector",
                        "com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction",
                        "cmd",
                        "addEnvironment"
                      ],
                      "query": [
                        {
                          "key": "environmentName",
                          "value": "{{environmentName}}"
                        },
                        {
                          "key": "pushType",
                          "value": "pushToOne"
                        },
                        {
                          "key": "whoCanUseSelect",
                          "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                        },
                        {
                          "key": "whoCanUse",
                          "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                        }
                      ]
                    }
                  },
                  "response": []
                },
                {
                  "name": "create end point",
                  "event": [
                    {
                      "listen": "prerequest",
                      "script": {
                        "exec": [
                          "endpointName = 'endpoint-' + new Date().getMilliseconds();",
                          "pm.collectionVariables.set(\"endpointName\", endpointName);",
                          ""
                        ],
                        "type": "text/javascript"
                      }
                    },
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "",
                          "    var environmentId = pm.response.text();",
                          "    pm.collectionVariables.set(\"endpintId\", environmentId);",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "POST",
                    "header": [
                      {
                        "key": "Origin",
                        "type": "text",
                        "value": "{{origin}}"
                      }
                    ],
                    "body": {
                      "mode": "formdata",
                      "formdata": []
                    },
                    "url": {
                      "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction/cmd/addEndpoint?sending=false&serverName={{endpointName}}&environmentId={{environmentId}}&protocol=http&address=localhost&port=8080&authKey=123&enabled=on",
                      "host": ["{{serverURL}}"],
                      "path": [
                        "DotAjaxDirector",
                        "com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction",
                        "cmd",
                        "addEndpoint"
                      ],
                      "query": [
                        {
                          "key": "sending",
                          "value": "false"
                        },
                        {
                          "key": "serverName",
                          "value": "{{endpointName}}"
                        },
                        {
                          "key": "environmentId",
                          "value": "{{environmentId}}"
                        },
                        {
                          "key": "protocol",
                          "value": "http"
                        },
                        {
                          "key": "address",
                          "value": "localhost"
                        },
                        {
                          "key": "port",
                          "value": "8080"
                        },
                        {
                          "key": "authKey",
                          "value": "123"
                        },
                        {
                          "key": "enabled",
                          "value": "on"
                        }
                      ]
                    }
                  },
                  "response": []
                },
                {
                  "name": "create receiver",
                  "event": [
                    {
                      "listen": "prerequest",
                      "script": {
                        "exec": [
                          "receiverName = 'receiverName-' + new Date().getMilliseconds();",
                          "pm.collectionVariables.set(\"receiverName\", receiverName);",
                          ""
                        ],
                        "type": "text/javascript"
                      }
                    },
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "POST",
                    "header": [
                      {
                        "key": "Origin",
                        "type": "text",
                        "value": "{{origin}}"
                      }
                    ],
                    "body": {
                      "mode": "formdata",
                      "formdata": []
                    },
                    "url": {
                      "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction/cmd/addEndpoint?sending=true&serverName={{receiverName}}&environmentId={{environmentId}}&address=localhost&authKey=123&enabled=on",
                      "host": ["{{serverURL}}"],
                      "path": [
                        "DotAjaxDirector",
                        "com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction",
                        "cmd",
                        "addEndpoint"
                      ],
                      "query": [
                        {
                          "key": "sending",
                          "value": "true"
                        },
                        {
                          "key": "serverName",
                          "value": "{{receiverName}}"
                        },
                        {
                          "key": "environmentId",
                          "value": "{{environmentId}}"
                        },
                        {
                          "key": "address",
                          "value": "localhost"
                        },
                        {
                          "key": "authKey",
                          "value": "123"
                        },
                        {
                          "key": "enabled",
                          "value": "on"
                        }
                      ]
                    }
                  },
                  "response": []
                },
                {
                  "name": "generate Integrity Checker",
                  "event": [
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "",
                          "    response = pm.response.json();",
                          "",
                          "    pm.expect(response['success']).to.equals(true, );",
                          "    pm.expect(response['message']).to.equals(\"Integrity Checking Initialized...\");",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "GET",
                    "header": [],
                    "url": {
                      "raw": "{{serverURL}}/api/integrity/checkintegrity/endpoint/{{endpintId}}",
                      "host": ["{{serverURL}}"],
                      "path": [
                        "api",
                        "integrity",
                        "checkintegrity",
                        "endpoint",
                        "{{endpintId}}"
                      ]
                    }
                  },
                  "response": []
                },
                {
                  "name": "set USE_JWT_TOKEN_IN_PUSH_PUBLISH to true",
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "PUT",
                    "header": [],
                    "body": {
                      "mode": "raw",
                      "raw": "{\n    \"USE_JWT_TOKEN_IN_PUSH_PUBLISH\": true\n}",
                      "options": {
                        "raw": {
                          "language": "json"
                        }
                      }
                    },
                    "url": {
                      "raw": "{{serverURL}}/api/v1/configuration",
                      "host": ["{{serverURL}}"],
                      "path": ["api", "v1", "configuration"]
                    }
                  },
                  "response": []
                },
                {
                  "name": "{{serverURL}}/api/v1/apitoken",
                  "event": [
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "",
                          "    var jsonData = pm.response.json();",
                          "    pm.expect(jsonData.errors.length).to.eql(0);",
                          "    pm.expect(jsonData.entity).to.not.eq(undefined);",
                          "    pm.expect(jsonData.entity.jwt).to.not.eq(undefined);",
                          "    pm.collectionVariables.set(\"token\", jsonData.entity.jwt);",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "POST",
                    "header": [],
                    "body": {
                      "mode": "raw",
                      "raw": "{\n    \"claims\": {\n        \"label\": \"testing\"\n    },\n    \"expirationSeconds\": 1,\n    \"network\": \"0.0.0.0/0\",\n    \"userId\": \"dotcms.org.1\"\n}",
                      "options": {
                        "raw": {
                          "language": "json"
                        }
                      }
                    },
                    "url": {
                      "raw": "{{serverURL}}/api/v1/apitoken",
                      "host": ["{{serverURL}}"],
                      "path": ["api", "v1", "apitoken"]
                    }
                  },
                  "response": []
                }
              ]
            },
            {
              "name": "invalid token",
              "item": [
                {
                  "name": "set USE_JWT_TOKEN_IN_PUSH_PUBLISH to false",
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "PUT",
                    "header": [],
                    "body": {
                      "mode": "raw",
                      "raw": "{\n    \"USE_JWT_TOKEN_IN_PUSH_PUBLISH\": false\n}",
                      "options": {
                        "raw": {
                          "language": "json"
                        }
                      }
                    },
                    "url": {
                      "raw": "{{serverURL}}/api/v1/configuration",
                      "host": ["{{serverURL}}"],
                      "path": ["api", "v1", "configuration"]
                    }
                  },
                  "response": []
                },
                {
                  "name": "create environment",
                  "event": [
                    {
                      "listen": "prerequest",
                      "script": {
                        "exec": [
                          "",
                          "environmentName = 'environment-' + new Date().getMilliseconds();",
                          "pm.collectionVariables.set(\"environmentName\", environmentName);",
                          ""
                        ],
                        "type": "text/javascript"
                      }
                    },
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "",
                          "    var environmentId = pm.response.text();",
                          "    pm.collectionVariables.set(\"environmentId\", environmentId);",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "POST",
                    "header": [
                      {
                        "key": "Origin",
                        "value": "{{origin}}",
                        "type": "text"
                      }
                    ],
                    "body": {
                      "mode": "formdata",
                      "formdata": []
                    },
                    "url": {
                      "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction/cmd/addEnvironment?environmentName={{environmentName}}&pushType=pushToOne&whoCanUseSelect=e7d4e34e-5127-45fc-8123-d48b62d510e3&whoCanUse=e7d4e34e-5127-45fc-8123-d48b62d510e3",
                      "host": ["{{serverURL}}"],
                      "path": [
                        "DotAjaxDirector",
                        "com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction",
                        "cmd",
                        "addEnvironment"
                      ],
                      "query": [
                        {
                          "key": "environmentName",
                          "value": "{{environmentName}}"
                        },
                        {
                          "key": "pushType",
                          "value": "pushToOne"
                        },
                        {
                          "key": "whoCanUseSelect",
                          "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                        },
                        {
                          "key": "whoCanUse",
                          "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                        }
                      ]
                    }
                  },
                  "response": []
                },
                {
                  "name": "create end point",
                  "event": [
                    {
                      "listen": "prerequest",
                      "script": {
                        "exec": [
                          "endpointName = 'endpoint-' + new Date().getMilliseconds();",
                          "pm.collectionVariables.set(\"endpointName\", endpointName);",
                          ""
                        ],
                        "type": "text/javascript"
                      }
                    },
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "",
                          "    var environmentId = pm.response.text();",
                          "    pm.collectionVariables.set(\"endpintId\", environmentId);",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "POST",
                    "header": [
                      {
                        "key": "Origin",
                        "type": "text",
                        "value": "{{origin}}"
                      }
                    ],
                    "body": {
                      "mode": "formdata",
                      "formdata": []
                    },
                    "url": {
                      "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction/cmd/addEndpoint?sending=false&serverName={{endpointName}}&environmentId={{environmentId}}&protocol=http&address=localhost&port=8080&authKey=invalid&enabled=on",
                      "host": ["{{serverURL}}"],
                      "path": [
                        "DotAjaxDirector",
                        "com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction",
                        "cmd",
                        "addEndpoint"
                      ],
                      "query": [
                        {
                          "key": "sending",
                          "value": "false"
                        },
                        {
                          "key": "serverName",
                          "value": "{{endpointName}}"
                        },
                        {
                          "key": "environmentId",
                          "value": "{{environmentId}}"
                        },
                        {
                          "key": "protocol",
                          "value": "http"
                        },
                        {
                          "key": "address",
                          "value": "localhost"
                        },
                        {
                          "key": "port",
                          "value": "8080"
                        },
                        {
                          "key": "authKey",
                          "value": "invalid"
                        },
                        {
                          "key": "enabled",
                          "value": "on"
                        }
                      ]
                    }
                  },
                  "response": []
                },
                {
                  "name": "generate Integrity Checker",
                  "event": [
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(401);",
                          "    endPoint = pm.collectionVariables.get(\"endpintId\");",
                          "    pm.expect(pm.response.text()).to.equals(\"Invalid token Response indicating Not Authorized received from Endpoint. Please check Auth Token. Endpoint Id: \" + endPoint);",
                          "",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "GET",
                    "header": [],
                    "url": {
                      "raw": "{{serverURL}}/api/integrity/checkintegrity/endpoint/{{endpintId}}",
                      "host": ["{{serverURL}}"],
                      "path": [
                        "api",
                        "integrity",
                        "checkintegrity",
                        "endpoint",
                        "{{endpintId}}"
                      ]
                    }
                  },
                  "response": []
                },
                {
                  "name": "set USE_JWT_TOKEN_IN_PUSH_PUBLISH to true",
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "PUT",
                    "header": [],
                    "body": {
                      "mode": "raw",
                      "raw": "{\n    \"USE_JWT_TOKEN_IN_PUSH_PUBLISH\": true\n}",
                      "options": {
                        "raw": {
                          "language": "json"
                        }
                      }
                    },
                    "url": {
                      "raw": "{{serverURL}}/api/v1/configuration",
                      "host": ["{{serverURL}}"],
                      "path": ["api", "v1", "configuration"]
                    }
                  },
                  "response": []
                }
              ]
            }
          ]
        },
        {
          "name": "using JWT",
          "item": [
            {
              "name": "Happy path",
              "item": [
                {
                  "name": "request_token",
                  "event": [
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "",
                          "    var jsonData = pm.response.json();",
                          "    pm.expect(jsonData.errors.length).to.eql(0);",
                          "    pm.expect(jsonData.entity).to.not.eq(undefined);",
                          "    pm.expect(jsonData.entity.jwt).to.not.eq(undefined);",
                          "    pm.collectionVariables.set(\"token\", jsonData.entity.jwt);",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "POST",
                    "header": [],
                    "body": {
                      "mode": "raw",
                      "raw": "{\n    \"claims\": {\n        \"label\": \"testing\"\n    },\n    \"expirationSeconds\": 94571365,\n    \"network\": \"0.0.0.0/0\",\n    \"userId\": \"dotcms.org.1\"\n}",
                      "options": {
                        "raw": {
                          "language": "json"
                        }
                      }
                    },
                    "url": {
                      "raw": "{{serverURL}}/api/v1/apitoken",
                      "host": ["{{serverURL}}"],
                      "path": ["api", "v1", "apitoken"]
                    }
                  },
                  "response": []
                },
                {
                  "name": "create environment",
                  "event": [
                    {
                      "listen": "prerequest",
                      "script": {
                        "exec": [
                          "",
                          "environmentName = 'environment-' + new Date().getMilliseconds();",
                          "pm.collectionVariables.set(\"environmentName\", environmentName);",
                          ""
                        ],
                        "type": "text/javascript"
                      }
                    },
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "",
                          "    var environmentId = pm.response.text();",
                          "    pm.collectionVariables.set(\"environmentId\", environmentId);",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "POST",
                    "header": [
                      {
                        "key": "Origin",
                        "value": "{{origin}}",
                        "type": "text"
                      }
                    ],
                    "body": {
                      "mode": "formdata",
                      "formdata": []
                    },
                    "url": {
                      "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction/cmd/addEnvironment?environmentName={{environmentName}}&pushType=pushToOne&whoCanUseSelect=e7d4e34e-5127-45fc-8123-d48b62d510e3&whoCanUse=e7d4e34e-5127-45fc-8123-d48b62d510e3",
                      "host": ["{{serverURL}}"],
                      "path": [
                        "DotAjaxDirector",
                        "com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction",
                        "cmd",
                        "addEnvironment"
                      ],
                      "query": [
                        {
                          "key": "environmentName",
                          "value": "{{environmentName}}"
                        },
                        {
                          "key": "pushType",
                          "value": "pushToOne"
                        },
                        {
                          "key": "whoCanUseSelect",
                          "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                        },
                        {
                          "key": "whoCanUse",
                          "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                        }
                      ]
                    }
                  },
                  "response": []
                },
                {
                  "name": "create end point",
                  "event": [
                    {
                      "listen": "prerequest",
                      "script": {
                        "exec": [
                          "endpointName = 'endpoint-' + new Date().getMilliseconds();",
                          "pm.collectionVariables.set(\"endpointName\", endpointName);",
                          ""
                        ],
                        "type": "text/javascript"
                      }
                    },
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "",
                          "    var environmentId = pm.response.text();",
                          "    pm.collectionVariables.set(\"endpintId\", environmentId);",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "POST",
                    "header": [
                      {
                        "key": "Origin",
                        "type": "text",
                        "value": "{{origin}}"
                      }
                    ],
                    "body": {
                      "mode": "formdata",
                      "formdata": []
                    },
                    "url": {
                      "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction/cmd/addEndpoint?sending=false&serverName={{endpointName}}&environmentId={{environmentId}}&protocol=http&address=localhost&port=8080&authKey={{token}}&enabled=on",
                      "host": ["{{serverURL}}"],
                      "path": [
                        "DotAjaxDirector",
                        "com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction",
                        "cmd",
                        "addEndpoint"
                      ],
                      "query": [
                        {
                          "key": "sending",
                          "value": "false"
                        },
                        {
                          "key": "serverName",
                          "value": "{{endpointName}}"
                        },
                        {
                          "key": "environmentId",
                          "value": "{{environmentId}}"
                        },
                        {
                          "key": "protocol",
                          "value": "http"
                        },
                        {
                          "key": "address",
                          "value": "localhost"
                        },
                        {
                          "key": "port",
                          "value": "8080"
                        },
                        {
                          "key": "authKey",
                          "value": "{{token}}"
                        },
                        {
                          "key": "enabled",
                          "value": "on"
                        }
                      ]
                    }
                  },
                  "response": []
                },
                {
                  "name": "generate Integrity Checker",
                  "event": [
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "",
                          "    response = pm.response.json();",
                          "",
                          "    pm.expect(response['success']).to.equals(true, );",
                          "    pm.expect(response['message']).to.equals(\"Integrity Checking Initialized...\");",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "bearer",
                      "bearer": [
                        {
                          "key": "token",
                          "value": "{{token}}",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "GET",
                    "header": [],
                    "url": {
                      "raw": "{{serverURL}}/api/integrity/checkintegrity/endpoint/{{endpintId}}",
                      "host": ["{{serverURL}}"],
                      "path": [
                        "api",
                        "integrity",
                        "checkintegrity",
                        "endpoint",
                        "{{endpintId}}"
                      ]
                    }
                  },
                  "response": []
                }
              ]
            },
            {
              "name": "Expired Token",
              "item": [
                {
                  "name": "request_token",
                  "event": [
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "",
                          "    var jsonData = pm.response.json();",
                          "    pm.expect(jsonData.errors.length).to.eql(0);",
                          "    pm.expect(jsonData.entity).to.not.eq(undefined);",
                          "    pm.expect(jsonData.entity.jwt).to.not.eq(undefined);",
                          "    pm.collectionVariables.set(\"token\", jsonData.entity.jwt);",
                          "",
                          "    console.log('token', jsonData.entity.jwt);",
                          "    eval(pm.collectionVariables.get(\"wait\"))(2);",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "POST",
                    "header": [],
                    "body": {
                      "mode": "raw",
                      "raw": "{\n    \"claims\": {\n        \"label\": \"testing\"\n    },\n    \"expirationSeconds\": 1,\n    \"network\": \"0.0.0.0/0\",\n    \"userId\": \"dotcms.org.1\"\n}",
                      "options": {
                        "raw": {
                          "language": "json"
                        }
                      }
                    },
                    "url": {
                      "raw": "{{serverURL}}/api/v1/apitoken",
                      "host": ["{{serverURL}}"],
                      "path": ["api", "v1", "apitoken"]
                    }
                  },
                  "response": []
                },
                {
                  "name": "create environment Copy",
                  "event": [
                    {
                      "listen": "prerequest",
                      "script": {
                        "exec": [
                          "",
                          "environmentName = 'environment-' + new Date().getMilliseconds();",
                          "pm.collectionVariables.set(\"environmentName\", environmentName);",
                          ""
                        ],
                        "type": "text/javascript"
                      }
                    },
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "",
                          "    var environmentId = pm.response.text();",
                          "    pm.collectionVariables.set(\"environmentId\", environmentId);",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "POST",
                    "header": [
                      {
                        "key": "Origin",
                        "value": "{{origin}}",
                        "type": "text"
                      }
                    ],
                    "body": {
                      "mode": "formdata",
                      "formdata": []
                    },
                    "url": {
                      "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction/cmd/addEnvironment?environmentName={{environmentName}}&pushType=pushToOne&whoCanUseSelect=e7d4e34e-5127-45fc-8123-d48b62d510e3&whoCanUse=e7d4e34e-5127-45fc-8123-d48b62d510e3",
                      "host": ["{{serverURL}}"],
                      "path": [
                        "DotAjaxDirector",
                        "com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction",
                        "cmd",
                        "addEnvironment"
                      ],
                      "query": [
                        {
                          "key": "environmentName",
                          "value": "{{environmentName}}"
                        },
                        {
                          "key": "pushType",
                          "value": "pushToOne"
                        },
                        {
                          "key": "whoCanUseSelect",
                          "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                        },
                        {
                          "key": "whoCanUse",
                          "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                        }
                      ]
                    }
                  },
                  "response": []
                },
                {
                  "name": "create end point",
                  "event": [
                    {
                      "listen": "prerequest",
                      "script": {
                        "exec": [
                          "endpointName = 'endpoint-' + new Date().getMilliseconds();",
                          "pm.collectionVariables.set(\"endpointName\", endpointName);",
                          ""
                        ],
                        "type": "text/javascript"
                      }
                    },
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "",
                          "    var environmentId = pm.response.text();",
                          "    pm.collectionVariables.set(\"endpintId\", environmentId);",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "POST",
                    "header": [
                      {
                        "key": "Origin",
                        "type": "text",
                        "value": "{{origin}}"
                      }
                    ],
                    "body": {
                      "mode": "formdata",
                      "formdata": []
                    },
                    "url": {
                      "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction/cmd/addEndpoint?sending=false&serverName={{endpointName}}&environmentId={{environmentId}}&protocol=http&address=localhost&port=8080&authKey={{token}}&enabled=on",
                      "host": ["{{serverURL}}"],
                      "path": [
                        "DotAjaxDirector",
                        "com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction",
                        "cmd",
                        "addEndpoint"
                      ],
                      "query": [
                        {
                          "key": "sending",
                          "value": "false"
                        },
                        {
                          "key": "serverName",
                          "value": "{{endpointName}}"
                        },
                        {
                          "key": "environmentId",
                          "value": "{{environmentId}}"
                        },
                        {
                          "key": "protocol",
                          "value": "http"
                        },
                        {
                          "key": "address",
                          "value": "localhost"
                        },
                        {
                          "key": "port",
                          "value": "8080"
                        },
                        {
                          "key": "authKey",
                          "value": "{{token}}"
                        },
                        {
                          "key": "enabled",
                          "value": "on"
                        }
                      ]
                    }
                  },
                  "response": []
                },
                {
                  "name": "Shoyld response with 401",
                  "event": [
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(401);",
                          "",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    },
                    {
                      "listen": "prerequest",
                      "script": {
                        "exec": ["setTimeout(function(){}, 1500); "],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "bearer",
                      "bearer": [
                        {
                          "key": "token",
                          "value": "{{token}}",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "GET",
                    "header": [],
                    "url": {
                      "raw": "{{serverURL}}/api/integrity/checkintegrity/endpoint/{{endpintId}}",
                      "host": ["{{serverURL}}"],
                      "path": [
                        "api",
                        "integrity",
                        "checkintegrity",
                        "endpoint",
                        "{{endpintId}}"
                      ]
                    }
                  },
                  "response": []
                }
              ]
            },
            {
              "name": "Invalid Token",
              "item": [
                {
                  "name": "create environment",
                  "event": [
                    {
                      "listen": "prerequest",
                      "script": {
                        "exec": [
                          "",
                          "environmentName = 'environment-' + new Date().getMilliseconds();",
                          "pm.collectionVariables.set(\"environmentName\", environmentName);",
                          ""
                        ],
                        "type": "text/javascript"
                      }
                    },
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "",
                          "    var environmentId = pm.response.text();",
                          "    pm.collectionVariables.set(\"environmentId\", environmentId);",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "POST",
                    "header": [
                      {
                        "key": "Origin",
                        "value": "{{origin}}",
                        "type": "text"
                      }
                    ],
                    "body": {
                      "mode": "formdata",
                      "formdata": []
                    },
                    "url": {
                      "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction/cmd/addEnvironment?environmentName={{environmentName}}&pushType=pushToOne&whoCanUseSelect=e7d4e34e-5127-45fc-8123-d48b62d510e3&whoCanUse=e7d4e34e-5127-45fc-8123-d48b62d510e3",
                      "host": ["{{serverURL}}"],
                      "path": [
                        "DotAjaxDirector",
                        "com.dotcms.publisher.environment.ajax.EnvironmentAjaxAction",
                        "cmd",
                        "addEnvironment"
                      ],
                      "query": [
                        {
                          "key": "environmentName",
                          "value": "{{environmentName}}"
                        },
                        {
                          "key": "pushType",
                          "value": "pushToOne"
                        },
                        {
                          "key": "whoCanUseSelect",
                          "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                        },
                        {
                          "key": "whoCanUse",
                          "value": "e7d4e34e-5127-45fc-8123-d48b62d510e3"
                        }
                      ]
                    }
                  },
                  "response": []
                },
                {
                  "name": "create end point",
                  "event": [
                    {
                      "listen": "prerequest",
                      "script": {
                        "exec": [
                          "endpointName = 'endpoint-' + new Date().getMilliseconds();",
                          "pm.collectionVariables.set(\"endpointName\", endpointName);",
                          ""
                        ],
                        "type": "text/javascript"
                      }
                    },
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "",
                          "    var environmentId = pm.response.text();",
                          "    pm.collectionVariables.set(\"endpintId\", environmentId);",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "basic",
                      "basic": [
                        {
                          "key": "password",
                          "value": "admin",
                          "type": "string"
                        },
                        {
                          "key": "username",
                          "value": "admin@dotcms.com",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "POST",
                    "header": [
                      {
                        "key": "Origin",
                        "type": "text",
                        "value": "{{origin}}"
                      }
                    ],
                    "body": {
                      "mode": "formdata",
                      "formdata": []
                    },
                    "url": {
                      "raw": "{{serverURL}}/DotAjaxDirector/com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction/cmd/addEndpoint?sending=false&serverName={{endpointName}}&environmentId={{environmentId}}&protocol=http&address=localhost&port=8080&authKey=123&enabled=on",
                      "host": ["{{serverURL}}"],
                      "path": [
                        "DotAjaxDirector",
                        "com.dotcms.publisher.endpoint.ajax.PublishingEndpointAjaxAction",
                        "cmd",
                        "addEndpoint"
                      ],
                      "query": [
                        {
                          "key": "sending",
                          "value": "false"
                        },
                        {
                          "key": "serverName",
                          "value": "{{endpointName}}"
                        },
                        {
                          "key": "environmentId",
                          "value": "{{environmentId}}"
                        },
                        {
                          "key": "protocol",
                          "value": "http"
                        },
                        {
                          "key": "address",
                          "value": "localhost"
                        },
                        {
                          "key": "port",
                          "value": "8080"
                        },
                        {
                          "key": "authKey",
                          "value": "123"
                        },
                        {
                          "key": "enabled",
                          "value": "on"
                        }
                      ]
                    }
                  },
                  "response": []
                },
                {
                  "name": "logout",
                  "event": [
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(200);",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "method": "GET",
                    "header": [],
                    "url": {
                      "raw": "{{serverURL}}/api/v1/logout",
                      "host": ["{{serverURL}}"],
                      "path": ["api", "v1", "logout"]
                    }
                  },
                  "response": []
                },
                {
                  "name": "Shoyld response with 401",
                  "event": [
                    {
                      "listen": "test",
                      "script": {
                        "exec": [
                          "pm.test(\"Status code is 200\", function () {",
                          "    pm.response.to.have.status(401);",
                          "",
                          "});"
                        ],
                        "type": "text/javascript"
                      }
                    }
                  ],
                  "request": {
                    "auth": {
                      "type": "bearer",
                      "bearer": [
                        {
                          "key": "token",
                          "value": "invalid_token",
                          "type": "string"
                        }
                      ]
                    },
                    "method": "GET",
                    "header": [],
                    "url": {
                      "raw": "{{serverURL}}/api/integrity/checkintegrity/endpoint/{{endpintId}}",
                      "host": ["{{serverURL}}"],
                      "path": [
                        "api",
                        "integrity",
                        "checkintegrity",
                        "endpoint",
                        "{{endpintId}}"
                      ]
                    }
                  },
                  "response": []
                }
              ]
            }
          ]
        }
      ]
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "wait = (ms) => {",
          "   var start = new Date().getTime();",
          "   var end = start;",
          "   while(end < start + ms) {",
          "     end = new Date().getTime();",
          "  }",
          "};",
          "",
          "pm.collectionVariables.set(\"wait\", wait.toString());",
          "",
          "serverURL = pm.environment.get(\"serverURL\");",
          "",
          "console.log('hostName', serverURL);",
          "pm.collectionVariables.set(\"origin\", serverURL);"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [""]
      }
    }
  ],
  "variable": [
    {
      "key": "endpointName",
      "value": "endpoint-522"
    },
    {
      "key": "environmentName",
      "value": "environment-825"
    },
    {
      "key": "origin",
      "value": "http://localhost:8080"
    },
    {
      "key": "environmentId",
      "value": "e6ab2470-3026-4dac-98ee-29657a7e1b12"
    },
    {
      "key": "endpintId",
      "value": "22b998af-f1cd-4473-85cd-dbfa251c3525"
    },
    {
      "key": "receiverName",
      "value": "receiverName-443"
    },
    {
      "key": "token",
      "value": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJhcGk4NDQxNGYwNi0xM2U5LTQ3MzMtOTE1NC05MTUwNGJiOGU0NTIiLCJ4bW9kIjoxNjAzMTM4MDE2MDAwLCJuYmYiOjE2MDMxMzgwMTYsImlzcyI6ImUxYjUwYzhmMDQiLCJsYWJlbCI6InRlc3RpbmciLCJleHAiOjE2MDMxMzgwMTcsImlhdCI6MTYwMzEzODAxNiwianRpIjoiMmNiZGYxMzEtMzBmMS00Mjk2LTlhYWYtYTkxZmM5MTg3ZDgwIn0.yXVh1ThaFnRu4U5Qo2A5BN8dGc6-uDNN01sLjSQ68_Y"
    },
    {
      "key": "wait",
      "value": "(ms) => {\n   var start = new Date().getTime();\n   var end = start;\n   while(end < start + ms) {\n     end = new Date().getTime();\n  }\n}"
    }
  ]
}
