var __awaiter=this&&this.__awaiter||function(t,e,r,s){function a(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,n){function o(t){try{u(s.next(t))}catch(e){n(e)}}function i(t){try{u(s["throw"](t))}catch(e){n(e)}}function u(t){t.done?r(t.value):a(t.value).then(o,i)}u((s=s.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var r={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},s,a,n,o;return o={next:i(0),throw:i(1),return:i(2)},typeof Symbol==="function"&&(o[Symbol.iterator]=function(){return this}),o;function i(t){return function(e){return u([t,e])}}function u(o){if(s)throw new TypeError("Generator is already executing.");while(r)try{if(s=1,a&&(n=o[0]&2?a["return"]:o[0]?a["throw"]||((n=a["return"])&&n.call(a),0):a.next)&&!(n=n.call(a,o[1])).done)return n;if(a=0,n)o=[o[0]&2,n.value];switch(o[0]){case 0:case 1:n=o;break;case 4:r.label++;return{value:o[1],done:false};case 5:r.label++;a=o[1];o=[0];continue;case 7:o=r.ops.pop();r.trys.pop();continue;default:if(!(n=r.trys,n=n.length>0&&n[n.length-1])&&(o[0]===6||o[0]===2)){r=0;continue}if(o[0]===3&&(!n||o[1]>n[0]&&o[1]<n[3])){r.label=o[1];break}if(o[0]===6&&r.label<n[1]){r.label=n[1];n=o;break}if(n&&r.label<n[2]){r.label=n[2];r.ops.push(o);break}if(n[2])r.ops.pop();r.trys.pop();continue}o=e.call(t,r)}catch(i){o=[6,i];a=0}finally{s=n=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:true}}};var __spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var s=Array(t),a=0,e=0;e<r;e++)for(var n=arguments[e],o=0,i=n.length;o<i;o++,a++)s[a]=n[o];return s};System.register(["./p-aa15c74d.system.js","./p-835fa369.system.js","./p-495705cb.system.js"],(function(exports){"use strict";var registerInstance,h,Host,getElement,getOriginalStatus,updateStatus,getClassNames,getErrorMessage,getFieldsFromLayout,fieldCustomProcess;return{setters:[function(t){registerInstance=t.r;h=t.h;Host=t.H;getElement=t.g},function(t){getOriginalStatus=t.h;updateStatus=t.u;getClassNames=t.a},function(t){getErrorMessage=t.a;getFieldsFromLayout=t.b;fieldCustomProcess=t.f}],execute:function(){var DotUploadService=function(){function t(){}t.prototype.uploadFile=function(t,e){if(typeof t==="string"){return this.uploadFileByURL(t)}else{return this.uploadBinaryFile(t,e)}};t.prototype.uploadFileByURL=function(t){var e=this;var r="/api/v1/temp/byUrl";return fetch(r,{method:"POST",headers:{"Content-Type":"application/json",Origin:window.location.hostname},body:JSON.stringify({remoteUrl:t})}).then((function(t){return __awaiter(e,void 0,void 0,(function(){var e,r;return __generator(this,(function(s){switch(s.label){case 0:if(!(t.status===200))return[3,2];return[4,t.json()];case 1:return[2,s.sent().tempFiles[0]];case 2:r={};return[4,t.json()];case 3:e=(r.message=s.sent().message,r.status=t.status,r);throw e}}))}))}))};t.prototype.uploadBinaryFile=function(t,e){var r=this;var s="/api/v1/temp";s+=e?"?maxFileLength="+e:"";var a=new FormData;a.append("file",t);return fetch(s,{method:"POST",headers:{Origin:window.location.hostname},body:a}).then((function(t){return __awaiter(r,void 0,void 0,(function(){var e,r;return __generator(this,(function(s){switch(s.label){case 0:if(!(t.status===200))return[3,2];return[4,t.json()];case 1:return[2,s.sent().tempFiles[0]];case 2:r={};return[4,t.json()];case 3:e=(r.message=s.sent().message,r.status=t.status,r);throw e}}))}))}))};return t}();var SUBMIT_FORM_API_URL="/api/v1/workflow/actions/default/fire/NEW";var fallbackErrorMessages={500:"500 Internal Server Error",400:"400 Bad Request",401:"401 Unauthorized Error"};var DotFormComponent=exports("dot_form",function(){function class_1(t){registerInstance(this,t);this.resetLabel="Reset";this.submitLabel="Submit";this.layout=[];this.variable="";this.status=getOriginalStatus();this.errorMessage="";this.uploadFileInProgress=false;this.fieldsStatus={};this.value={}}class_1.prototype.onValueChange=function(t){var e=this;var r=t.target.tagName;var s=t.detail,a=s.name,n=s.value;var o=fieldCustomProcess[r];if(r==="DOT-BINARY-FILE"&&n){this.uploadFile(t).then((function(t){e.value[a]=t&&t.id}))}else{this.value[a]=o?o(n):n}};class_1.prototype.onStatusChange=function(t){var e=t.detail;this.fieldsStatus[e.name]=e.status;this.status=updateStatus(this.status,{dotTouched:this.getTouched(),dotPristine:this.getStatusValueByName("dotPristine"),dotValid:this.getStatusValueByName("dotValid")})};class_1.prototype.layoutWatch=function(){this.value=this.getUpdateValue()};class_1.prototype.fieldsToShowWatch=function(){this.value=this.getUpdateValue()};class_1.prototype.componentWillLoad=function(){this.value=this.getUpdateValue()};class_1.prototype.render=function(){var t=this;var e=getClassNames(this.status,this.status.dotValid);return h(Host,{class:Object.assign({},e)},h("form",{onSubmit:this.handleSubmit.bind(this)},this.layout.map((function(e){return h("dot-form-row",{row:e,"fields-to-show":t.fieldsToShow})})),h("div",{class:"dot-form__buttons"},h("button",{type:"reset",onClick:function(){return t.resetForm()}},this.resetLabel),h("button",{type:"submit",disabled:!this.status.dotValid||this.uploadFileInProgress},this.submitLabel))),h("dot-error-message",null,this.errorMessage))};class_1.prototype.getStatusValueByName=function(t){return Object.values(this.fieldsStatus).map((function(e){return e[t]})).every((function(t){return t===true}))};class_1.prototype.getTouched=function(){return Object.values(this.fieldsStatus).map((function(t){return t.dotTouched})).includes(true)};class_1.prototype.handleSubmit=function(t){var e=this;t.preventDefault();fetch(SUBMIT_FORM_API_URL,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({contentlet:Object.assign({contentType:this.variable},this.value)})}).then((function(t){return __awaiter(e,void 0,void 0,(function(){var e,r;return __generator(this,(function(s){switch(s.label){case 0:if(!(t.status!==200))return[3,2];r={};return[4,t.text()];case 1:e=(r.message=s.sent(),r.status=t.status,r);throw e;case 2:return[2,t.json()]}}))}))})).then((function(t){var r=t.entity;e.runSuccessCallback(r)})).catch((function(t){var r=t.message,s=t.status;e.errorMessage=getErrorMessage(r)||fallbackErrorMessages[s]}))};class_1.prototype.runSuccessCallback=function(contentlet){var successCallback=this.getSuccessCallback();if(successCallback){return function(){return eval(successCallback)}.call({contentlet:contentlet})}};class_1.prototype.getSuccessCallback=function(){var t=getFieldsFromLayout(this.layout).filter((function(t){return t.variable==="formSuccessCallback"}))[0];return t.values};class_1.prototype.resetForm=function(){var t=this;var e=Array.from(this.el.querySelectorAll("form dot-form-column > *"));e.forEach((function(e){return __awaiter(t,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,e.reset()];case 1:r.sent();return[3,3];case 2:t=r.sent();console.warn(""+e.tagName,t);return[3,3];case 3:return[2]}}))}))}))};class_1.prototype.getUpdateValue=function(){return getFieldsFromLayout(this.layout).filter((function(t){return t.fixed===false})).reduce((function(t,e){var r;var s=e.variable,a=e.defaultValue,n=e.dataType,o=e.values;return Object.assign(Object.assign({},t),(r={},r[s]=a||(n!=="TEXT"?o:null),r))}),{})};class_1.prototype.getMaxSize=function(t){var e=__spreadArrays(t.target.attributes);var r=e.filter((function(t){return t.name==="max-file-length"}))[0];return r&&r.value};class_1.prototype.uploadFile=function(t){var e=this;var r=new DotUploadService;var s=t.detail.value;var a=this.getMaxSize(t);var n=t.target;if(!a||s.size<=a){this.uploadFileInProgress=true;n.errorMessage="";return r.uploadFile(s,a).then((function(t){e.errorMessage="";n.previewImageUrl=t.thumbnailUrl;n.previewImageName=t.fileName;e.uploadFileInProgress=false;return t})).catch((function(t){var r=t.message,s=t.status;n.clearValue();e.uploadFileInProgress=false;e.errorMessage=getErrorMessage(r)||fallbackErrorMessages[s];return null}))}else{n.reset();n.errorMessage="File size larger than allowed "+a+" bytes";return Promise.resolve(null)}};Object.defineProperty(class_1.prototype,"el",{get:function(){return getElement(this)},enumerable:true,configurable:true});Object.defineProperty(class_1,"watchers",{get:function(){return{layout:["layoutWatch"],fieldsToShow:["fieldsToShowWatch"]}},enumerable:true,configurable:true});Object.defineProperty(class_1,"style",{get:function(){return"dot-form{display:block}dot-form>form label{margin:0;padding:0}dot-form>form dot-form-column>*{display:block;margin:2rem 0}dot-form>form dot-form-column>:first-child{margin-top:0}dot-form>form dot-form-column>:last-child{margin-bottom:0}dot-form>form .dot-form__buttons{display:-ms-flexbox;display:flex;-ms-flex-direction:row;flex-direction:row;-ms-flex-pack:end;justify-content:flex-end}dot-form>form .dot-form__buttons button:last-child{margin-left:1rem}"},enumerable:true,configurable:true});return class_1}())}}}));