dojo.require("dotcms.dijit.image.ImageEditor");
tinymce.PluginManager.add("doteditimage", function (editor) {
	const lastSelectedImage = undefined;
	function addButton() {
		editor.addButton("editimage", {
			title: "Edit Image",
			onclick: function () {
				console.log(dotcms.dijit.image.ImageEditor);
				editor.insertContent("Hello world!!");
			},
		});
	}
	function addEvents() {
		editor.on("click", function (e) {
			if (lastSelectedImage && lastSelectedImage.src != e.element.src) {
				lastSelectedImage = undefined;
			}
			if (isEditableImage(e.element)) {
				lastSelectedImage = e.element;
			}
		});
	}
	function isEditableImage(img) {
		const selectorMatched = editor.dom.is(
			img,
			"img:not([data-mce-object],[data-mce-placeholder])"
		);
		return selectorMatched;
	}
	function addToolbars() {
		const toolbarItems = "alignleft aligncenter alignright | editimage";
		editor.addContextToolbar(isEditableImage, toolbarItems);
	}
	addToolbars();
	addEvents();
	addButton();
});
