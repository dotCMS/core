const e=window.dotcmsFields.h;import{a as t}from"./chunk-1d89c98b.js";import{a as i,b as a,c as s,d as r,e as l,f as n,g as o,h,i as d,j as u,k as c}from"./chunk-62cd3eff.js";import{a as p,b as m}from"./chunk-4205a04e.js";var g;!function(e){e[e.REQUIRED=0]="REQUIRED",e[e.INVALID=1]="INVALID",e[e.URLINVALID=2]="URLINVALID"}(g||(g={}));class b{constructor(){this.name="",this.label="",this.placeholder="Drop or paste a file or url",this.hint="",this.required=!1,this.requiredMessage="This field is required",this.validationMessage="The field doesn't comply with the specified format",this.URLValidationMessage="The specified URL is not valid",this.disabled=!1,this.accept="",this.maxFileLength="",this.buttonLabel="Browse",this.errorMessage="",this.previewImageName="",this.previewImageUrl="",this.file=null,this.allowedFileTypes=[],this.errorMessageMap=new Map}reset(){this.file="",this.binaryTextField.value="",this.errorMessage="",this.clearPreviewData(),this.status=i(this.isValid()),this.emitStatusChange(),this.emitValueChange()}clearValue(){this.binaryTextField.value="",this.errorType=this.required?g.REQUIRED:null,this.setValue(""),this.clearPreviewData()}componentWillLoad(){this.setErrorMessageMap(),this.validateProps(),this.status=i(this.isValid()),this.emitStatusChange()}componentDidLoad(){this.binaryTextField=this.el.querySelector("dot-binary-text-field");const e=["dottype"],t=this.el.querySelector('input[type="file"]');setTimeout(()=>{const i=p(Array.from(this.el.attributes),e);m(t,i)},0)}requiredMessageWatch(){this.errorMessageMap.set(g.REQUIRED,this.requiredMessage)}validationMessageWatch(){this.errorMessageMap.set(g.INVALID,this.validationMessage)}URLValidationMessageWatch(){this.errorMessageMap.set(g.URLINVALID,this.URLValidationMessage)}optionsWatch(){this.accept=a(this,"accept"),this.allowedFileTypes=this.accept?this.accept.split(","):[],this.allowedFileTypes=this.allowedFileTypes.map(e=>e.trim())}fileChangeHandler(e){e.stopImmediatePropagation();const t=e.detail;this.errorType=t.errorType,this.setValue(t.file),this.isBinaryUploadButtonEvent(e.target)&&t.file&&(this.binaryTextField.value=t.file.name)}HandleDragover(e){e.preventDefault(),this.disabled||(this.el.classList.add("dot-dragover"),this.el.classList.remove("dot-dropped"))}HandleDragleave(e){e.preventDefault(),this.el.classList.remove("dot-dragover"),this.el.classList.remove("dot-dropped")}HandleDrop(e){e.preventDefault(),this.el.classList.remove("dot-dragover"),this.disabled||this.previewImageName||(this.el.classList.add("dot-dropped"),this.errorType=null,this.handleDroppedFile(e.dataTransfer.files[0]))}handleDelete(e){e.preventDefault(),this.setValue(""),this.clearPreviewData()}hostData(){return{class:s(this.status,this.isValid(),this.required)}}render(){return e(t,null,e("dot-label",{label:this.label,required:this.required,name:this.name,tabindex:"0"},this.previewImageName?e("dot-binary-file-preview",{onClick:e=>{e.preventDefault()},fileName:this.previewImageName,previewUrl:this.previewImageUrl}):e("div",{class:"dot-binary__container"},e("dot-binary-text-field",{placeholder:this.placeholder,required:this.required,disabled:this.disabled,accept:this.allowedFileTypes.join(","),hint:this.hint,onLostFocus:this.lostFocusEventHandler.bind(this)}),e("dot-binary-upload-button",{name:this.name,accept:this.allowedFileTypes.join(","),disabled:this.disabled,required:this.required,buttonLabel:this.buttonLabel}))),r(this.hint),l(this.shouldShowErrorMessage(),this.getErrorMessage()),e("dot-error-message",null,this.errorMessage))}lostFocusEventHandler(){this.status.dotTouched||(this.status=n(this.status,{dotTouched:!0}),this.emitStatusChange())}isBinaryUploadButtonEvent(e){return"dot-binary-upload-button"===e.localName}validateProps(){this.optionsWatch(),this.setPlaceHolder()}shouldShowErrorMessage(){return this.getErrorMessage()&&!this.status.dotPristine}getErrorMessage(){return this.errorMessageMap.get(this.errorType)}isValid(){return!(this.required&&!this.file)}setErrorMessageMap(){this.requiredMessageWatch(),this.validationMessageWatch(),this.URLValidationMessageWatch()}setValue(e){this.file=e,this.status=n(this.status,{dotTouched:!0,dotPristine:!1,dotValid:this.isValid()}),this.binaryTextField.value=null===e?"":this.binaryTextField.value,this.emitValueChange(),this.emitStatusChange()}emitStatusChange(){this.statusChange.emit({name:this.name,status:this.status})}emitValueChange(){this.valueChange.emit({name:this.name,value:this.file})}handleDroppedFile(e){o(e.name,this.allowedFileTypes.join(","))?(this.setValue(e),this.binaryTextField.value=e.name):(this.errorType=g.INVALID,this.setValue(null))}setPlaceHolder(){this.placeholder=this.isWindowsOS()?"Drop a file or url":this.placeholder}isWindowsOS(){return window.navigator.platform.includes("Win")}clearPreviewData(){this.previewImageUrl="",this.previewImageName=""}static get is(){return"dot-binary-file"}static get properties(){return{accept:{type:String,attr:"accept",reflectToAttr:!0,mutable:!0,watchCallbacks:["optionsWatch"]},buttonLabel:{type:String,attr:"button-label",reflectToAttr:!0},clearValue:{method:!0},disabled:{type:Boolean,attr:"disabled",reflectToAttr:!0},el:{elementRef:!0},errorMessage:{type:String,attr:"error-message",reflectToAttr:!0,mutable:!0},hint:{type:String,attr:"hint",reflectToAttr:!0},label:{type:String,attr:"label",reflectToAttr:!0},maxFileLength:{type:String,attr:"max-file-length",reflectToAttr:!0,mutable:!0},name:{type:String,attr:"name",reflectToAttr:!0},placeholder:{type:String,attr:"placeholder",reflectToAttr:!0,mutable:!0},previewImageName:{type:String,attr:"preview-image-name",reflectToAttr:!0,mutable:!0},previewImageUrl:{type:String,attr:"preview-image-url",reflectToAttr:!0,mutable:!0},required:{type:Boolean,attr:"required",reflectToAttr:!0},requiredMessage:{type:String,attr:"required-message",watchCallbacks:["requiredMessageWatch"]},reset:{method:!0},status:{state:!0},URLValidationMessage:{type:String,attr:"u-r-l-validation-message",watchCallbacks:["URLValidationMessageWatch"]},validationMessage:{type:String,attr:"validation-message",watchCallbacks:["validationMessageWatch"]}}}static get events(){return[{name:"valueChange",method:"valueChange",bubbles:!0,cancelable:!0,composed:!0},{name:"statusChange",method:"statusChange",bubbles:!0,cancelable:!0,composed:!0}]}static get listeners(){return[{name:"fileChange",method:"fileChangeHandler"},{name:"dragover",method:"HandleDragover"},{name:"dragleave",method:"HandleDragleave"},{name:"drop",method:"HandleDrop"},{name:"delete",method:"handleDelete"}]}static get style(){return"/**style-placeholder:dot-binary-file:**/"}}class f{constructor(){this.fileName="",this.previewUrl="",this.deleteLabel="Delete"}render(){return this.fileName?e(t,null,this.getPreviewElement(),e("div",{class:"dot-file-preview__info"},e("span",{class:"dot-file-preview__name"},this.fileName),e("button",{type:"button",onClick:()=>this.clearFile()},this.deleteLabel))):null}clearFile(){this.delete.emit(),this.fileName=null,this.previewUrl=null}getPreviewElement(){return this.previewUrl?e("img",{alt:this.fileName,src:this.previewUrl}):e("div",{class:"dot-file-preview__extension"},e("span",null,this.getExtention()))}getExtention(){return this.fileName.substr(this.fileName.lastIndexOf("."))}static get is(){return"dot-binary-file-preview"}static get properties(){return{deleteLabel:{type:String,attr:"delete-label",reflectToAttr:!0},el:{elementRef:!0},fileName:{type:String,attr:"file-name",reflectToAttr:!0,mutable:!0},previewUrl:{type:String,attr:"preview-url",reflectToAttr:!0,mutable:!0}}}static get events(){return[{name:"delete",method:"delete",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return"/**style-placeholder:dot-binary-file-preview:**/"}}class v{constructor(){this.value=null,this.hint="",this.placeholder="",this.required=!1,this.disabled=!1}render(){return e(t,null,e("input",{type:"text","aria-describedby":h(this.hint),class:d(this.isValid()),disabled:this.disabled,placeholder:this.placeholder,value:this.value,onBlur:()=>this.lostFocus.emit(),onKeyDown:e=>this.keyDownHandler(e),onPaste:e=>this.pasteHandler(e)}))}keyDownHandler(e){"Backspace"===e.key?this.handleBackspace():this.shouldPreventEvent(e)&&e.preventDefault()}shouldPreventEvent(e){return!(e.ctrlKey||e.metaKey)}handleBackspace(){this.value="",this.emitFile(null,this.required?g.REQUIRED:null)}pasteHandler(e){e.preventDefault(),this.value="";const t=e.clipboardData;t.items.length&&(this.isPastingFile(t)?this.handleFilePaste(t.items):this.handleURLPaste(t.items[0]))}handleFilePaste(e){const t=e[0],i=e[1].getAsFile();t.getAsString(e=>{o(e,this.accept)?(this.value=e,this.emitFile(i)):this.emitFile(null,g.INVALID)})}handleURLPaste(e){e.getAsString(e=>{u(e)?(this.value=e,this.emitFile(e)):this.emitFile(null,g.URLINVALID)})}isPastingFile(e){return!!e.files.length}isValid(){return!(this.required&&this.value)}emitFile(e,t){this.fileChange.emit({file:e,errorType:t})}static get is(){return"dot-binary-text-field"}static get properties(){return{accept:{type:String,attr:"accept",reflectToAttr:!0},disabled:{type:Boolean,attr:"disabled",reflectToAttr:!0},el:{elementRef:!0},hint:{type:String,attr:"hint",reflectToAttr:!0},placeholder:{type:String,attr:"placeholder",reflectToAttr:!0},required:{type:Boolean,attr:"required",reflectToAttr:!0},status:{state:!0},value:{type:"Any",attr:"value",reflectToAttr:!0,mutable:!0}}}static get events(){return[{name:"fileChange",method:"fileChange",bubbles:!0,cancelable:!0,composed:!0},{name:"lostFocus",method:"lostFocus",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return"/**style-placeholder:dot-binary-text-field:**/"}}class y{constructor(){this.name="",this.required=!1,this.disabled=!1,this.buttonLabel=""}componentDidLoad(){this.fileInput=this.el.querySelector("dot-label input")}render(){return e(t,null,e("input",{accept:this.accept,disabled:this.disabled,id:c(this.name),onChange:e=>this.fileChangeHandler(e),required:this.required||null,type:"file"}),e("button",{type:"button",disabled:this.disabled,onClick:()=>{this.fileInput.click()}},this.buttonLabel))}fileChangeHandler(e){const t=this.fileInput.files[0];o(t.name,this.accept)?this.emitFile(t):(e.preventDefault(),this.emitFile(null,g.INVALID))}emitFile(e,t){this.fileChange.emit({file:e,errorType:t})}static get is(){return"dot-binary-upload-button"}static get properties(){return{accept:{type:String,attr:"accept",reflectToAttr:!0},buttonLabel:{type:String,attr:"button-label",reflectToAttr:!0},disabled:{type:Boolean,attr:"disabled",reflectToAttr:!0},el:{elementRef:!0},name:{type:String,attr:"name",reflectToAttr:!0},required:{type:Boolean,attr:"required",reflectToAttr:!0}}}static get events(){return[{name:"fileChange",method:"fileChange",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return"/**style-placeholder:dot-binary-upload-button:**/"}}export{b as DotBinaryFile,f as DotBinaryFilePreview,v as DotBinaryTextField,y as DotBinaryUploadButton};