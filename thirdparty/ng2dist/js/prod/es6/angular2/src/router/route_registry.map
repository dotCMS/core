{"version":3,"sources":["route_registry.js"],"names":[],"mappings":"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","file":"angular2/src/router/route_registry.es6","sourcesContent":["import {RouteRecognizer} from './route_recognizer';\nimport {Instruction, noopInstruction} from './instruction';\nimport {List, ListWrapper, Map, MapWrapper, StringMap, StringMapWrapper} from 'angular2/src/facade/collection';\nimport {isPresent, isBlank, isType, StringWrapper, BaseException} from 'angular2/src/facade/lang';\nimport {RouteConfig} from './route_config';\nimport {reflector} from 'angular2/src/reflection/reflection';\n\nexport class RouteRegistry {\n  _rules:Map<any, RouteRecognizer>;\n\n  constructor() {\n    this._rules = MapWrapper.create();\n  }\n\n  config(parentComponent, config) {\n    if (!StringMapWrapper.contains(config, 'path')) {\n      throw new BaseException('Route config does not contain \"path\"');\n    }\n\n    if (!StringMapWrapper.contains(config, 'component') &&\n        !StringMapWrapper.contains(config, 'components') &&\n        !StringMapWrapper.contains(config, 'redirectTo')) {\n      throw new BaseException('Route config does not contain \"component,\" \"components,\" or \"redirectTo\"');\n    }\n\n    var recognizer:RouteRecognizer;\n    if (MapWrapper.contains(this._rules, parentComponent)) {\n      recognizer = MapWrapper.get(this._rules, parentComponent);\n    } else {\n      recognizer = new RouteRecognizer();\n      MapWrapper.set(this._rules, parentComponent, recognizer);\n    }\n\n    config = normalizeConfig(config);\n\n    if (StringMapWrapper.contains(config, 'redirectTo')) {\n      recognizer.addRedirect(StringMapWrapper.get(config, 'path'), StringMapWrapper.get(config, 'redirectTo'));\n      return;\n    }\n\n    var components = StringMapWrapper.get(config, 'components');\n    StringMapWrapper.forEach(components, (component, _) => {\n      this.configFromComponent(component);\n    });\n\n    recognizer.addConfig(config['path'], config, config['as']);\n  }\n\n  configFromComponent(component) {\n    if (!isType(component)) {\n      return;\n    }\n\n    // Don't read the annotations from a type more than once â€“\n    // this prevents an infinite loop if a component routes recursively.\n    if (MapWrapper.contains(this._rules, component)) {\n      return;\n    }\n    var annotations = reflector.annotations(component);\n    if (isPresent(annotations)) {\n      for (var i=0; i<annotations.length; i++) {\n        var annotation = annotations[i];\n\n        if (annotation instanceof RouteConfig) {\n          ListWrapper.forEach(annotation.configs, (config) => {\n            this.config(component, config);\n          })\n        }\n      }\n    }\n  }\n\n\n  recognize(url:string, parentComponent) {\n    var componentRecognizer = MapWrapper.get(this._rules, parentComponent);\n    if (isBlank(componentRecognizer)) {\n      return null;\n    }\n\n    var solutions = componentRecognizer.recognize(url);\n\n    for(var i = 0; i < solutions.length; i++) {\n      var candidate = solutions[i];\n      if (candidate['unmatchedUrl'].length == 0) {\n        return handlerToLeafInstructions(candidate, parentComponent);\n      }\n\n      var children = StringMapWrapper.create(),\n          allMapped = true;\n\n      StringMapWrapper.forEach(candidate['handler']['components'], (component, name) => {\n        if (!allMapped) {\n          return;\n        }\n        var childInstruction = this.recognize(candidate['unmatchedUrl'], component);\n        if (isPresent(childInstruction)) {\n          childInstruction.params = candidate['params'];\n          children[name] = childInstruction;\n        } else {\n          allMapped = false;\n        }\n      });\n\n      if (allMapped) {\n        return new Instruction({\n          component: parentComponent,\n          children: children,\n          matchedUrl: candidate['matchedUrl']\n        });\n      }\n    }\n\n    return null;\n  }\n\n  generate(name:string, params:any, hostComponent) {\n    //TODO: implement for hierarchical routes\n    var componentRecognizer = MapWrapper.get(this._rules, hostComponent);\n    if (isPresent(componentRecognizer)) {\n      return componentRecognizer.generate(name, params);\n    }\n  }\n}\n\nfunction handlerToLeafInstructions(context, parentComponent) {\n  var children = StringMapWrapper.create();\n  StringMapWrapper.forEach(context['handler']['components'], (component, outletName) => {\n    children[outletName] = new Instruction({\n      component: component,\n      params: context['params']\n    });\n  });\n  return new Instruction({\n    component: parentComponent,\n    children: children,\n    matchedUrl: context['matchedUrl']\n  });\n}\n\n// given:\n// { component: Foo }\n// mutates the config to:\n// { components: { default: Foo } }\nfunction normalizeConfig(config:StringMap) {\n  if (StringMapWrapper.contains(config, 'component')) {\n    var component = StringMapWrapper.get(config, 'component');\n    var components = StringMapWrapper.create();\n    StringMapWrapper.set(components, 'default', component);\n\n    var newConfig = StringMapWrapper.create();\n    StringMapWrapper.set(newConfig, 'components', components);\n\n    StringMapWrapper.forEach(config, (value, key) => {\n      if (!StringWrapper.equals(key, 'component') && !StringWrapper.equals(key, 'components')) {\n        StringMapWrapper.set(newConfig, key, value);\n      }\n    });\n\n    return newConfig;\n  }\n  return config;\n}\n"]}