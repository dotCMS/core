---
import Layout from "@components/Layout.astro";
import Error from "@components/Error.astro";
import { getDotCMSPage } from "@utils/client";
import { DotCMSPage } from "@react/DotCMSPage";

const params = Astro.params;

const pageResponse = await getDotCMSPage(
  params?.slug ?? "",
  Astro.url.searchParams,
);

const pageAsset = pageResponse?.pageAsset;
const errors = pageResponse?.errors;
const { vanityUrl } = pageAsset ?? {};

if (vanityUrl && (vanityUrl.temporaryRedirect || vanityUrl.permanentRedirect)) {
  return Astro.redirect(vanityUrl.forwardTo, vanityUrl.response);
}

const title = pageAsset ? pageAsset.page.title : "Error";
---
{
    (
      <Layout title={title}>
        {errors ? (
          <Error error={errors} />
        ) : (
          <DotCMSPage
            client:only="react"
            pageResponse={pageResponse}
          />
        )}
      </Layout>
    )
  }
  