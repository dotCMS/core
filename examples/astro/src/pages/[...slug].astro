---
import Layout from '../layouts/Layout.astro';
import Error from '../components/Error.astro';
import { getDotCMSPage } from '@utils/client';
import { MyPage } from '@react/myPage';

const params = Astro.params;

const { pageAsset, content, errors } = await getDotCMSPage(params?.slug ?? '', Astro.url.searchParams) ?? {};

console.log(errors);

const { vanityUrl } = pageAsset ?? {};

if (vanityUrl && (vanityUrl.temporaryRedirect || vanityUrl.permanentRedirect)) {
    return Astro.redirect(vanityUrl.forwardTo, vanityUrl.response);
}

const title = pageAsset ? pageAsset.page.title : 'Error';
---

{
    (
        <Layout title={title}>
            {errors ? (
                <Error error={errors} />
            ) : (
                <MyPage client:only="react" pageAsset={pageAsset} nav={content?.navigation?.children} />
            )}
        </Layout>
    )
}
