name: Add/Remove milestone based on label
on:
  issues:
    types: [labeled, unlabeled]
jobs:
  milestone-by-label:
    runs-on: ubuntu-latest
    name: Add milestone by label
    steps :
      -
        run: |
          echo "Github context"
        env:
          GITHUB_CONTEXT: ${{ toJson(github) }}
      -
        uses: actions/checkout@v3.6.0
        with:
          fetch-depth: 0
      -
        id: setVars
        run: |
          echo "dot_project_dir=${GITHUB_WORKSPACE}/dot-project" >> $GITHUB_OUTPUT
      -
        uses: actions/checkout@v3.6.0
        with:
          repository: dotCMS/dot-project
          ref: main
          token: ${{ secrets.PROJECT_GITHUB_TOKEN }}
          path: ${{ steps.setVars.outputs.dot_project_dir }}
          fetch-depth: 0
      -
        id: get-teams
        uses: ./.github/actions/dot-members
        with:
          conf_dir: ${{ steps.setVars.outputs.dot_project_dir }}
          get: TEAMS_BY_MEMBER
      -
        uses: ./.github/actions/milestone-issue
        with:
          conf_dir: ${{ steps.setVars.outputs.dot_project_dir }}
          teams: ${{ steps.get-teams.outputs.metadata }}
          field: LABEL
          event: ${{ toJson(github.event) }}
          token: ${{ secrets.PROJECT_GITHUB_TOKEN }}
