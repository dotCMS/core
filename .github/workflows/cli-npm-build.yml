#  This job publish the dotCLI NPM package: @dotcms/dotcli@rc
#  every night. The package is built from the master branch.

name: CLI NPM build
on:
  workflow_call:
    secrets:
      npm-token:
        description: 'NPM registry token'
        required: false

jobs:
  build-package:
    name: Build NPM Package
    uses: ./.github/workflows/cli-npm-package.yml
    with:
      ref: master
      npm-package-name: 'dotcli'
      npm-package-scope: '@dotcms'
    permissions:
      contents: read
      packages: write

  publish-package:
    name: Publish NPM Package
    needs: [ build-package ]
    if: success()
    uses: ./.github/workflows/cli-npm-publish.yml
    with:
      ref: master
      artifact-id: ${{ needs.build-package.outputs.artifact-id }}
      run-id: ${{ needs.build-package.outputs.run-id }}
      npm-package-version-tag: ${{ needs.build-package.outputs.npm-package-version-tag }}
    secrets:
      npm-token: ${{ secrets.npm-token }}
    permissions:
      contents: read
      packages: write