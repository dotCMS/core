# action.yml
name: 'Discover actions after issue edited'
on:
  workflow_call:
    outputs:
      actions:
        value: ${{ jobs.discover-actions.outputs.actions }}

env:
  GH_TOKEN: ${{ github.token }}

jobs:
  discover-actions:
    runs-on: ubuntu-20.04
    outputs:
      actions: ${{ steps.resolve-actions.outputs.actions }}
    steps:
      - run: echo 'GitHub context'
        env:
          GITHUB_CONTEXT: ${{ toJSON(github) }}

      - name: Resolve actions
        id: resolve-actions
        continue-on-error: true
        shell: bash
        run: |
          echo "$GITHUB_EVENT_PATH"
          
          actions=
          issue_number=$(cat $GITHUB_EVENT_PATH | jq '.issue.number')
          field_changed=$(cat $GITHUB_EVENT_PATH | jq '.changes.custom_fields.Technology.to')

          echo "field_changed=[${field_changed}]"
          if [[ -n "${issue_number}" && "${field_changed}" == 'Front-end' ]]; then
            [[ -n "${actions}" ]] && actions="${actions},"
            action="{\"action\":\"FRONTEND_TECHNOLOGY_NOTIFY\",\"issue_number\":${issue_number}}"
          fi
               
          actions="${actions}${action}"
          [[ -n "${actions}" ]] && actions="[${actions}]"
          
          echo "actions: ${actions}"
          echo "actions=${actions}" >> $GITHUB_OUTPUT
