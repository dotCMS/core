name: CLI tests
on:
  pull_request:
    paths:
      - 'tools/dotcms-cli/**'
  push:
    branches:
      - master
      - release-*
jobs:
  cli_tests:
    name: CLI tests
    runs-on: ubuntu-latest
#    outputs:
#      tests_results_status: ${{ steps.run-unit-tests.outputs.tests_results_status }}
#      tests_results_skip_report: ${{ steps.run-unit-tests.outputs.tests_results_skip_report }}
#      tests_results_report_url: ${{ steps.github-publish-unit-tests.outputs.tests_report_url }}
#      tests_results_log_url: ${{ steps.github-publish-unit-tests.outputs.test_logs_url }}
    steps:
      - name: Checkout core
        uses: actions/checkout@v3
      - name: Prepare license
        working-directory: ./tools/dotcms-cli/
        env:
          DOTCMS_LICENSE_KEY: ${{ secrets.DOTCMS_LICENSE }}
        run: |
          DOTCMS_LICENSE_PATH=${GITHUB_WORKSPACE}/tools/dotcms-cli/license
          mkdir -p ${DOTCMS_LICENSE_PATH}
          echo "${DOTCMS_LICENSE_KEY}" > ${DOTCMS_LICENSE_PATH}/license.dat
          echo "DOTCMS_LICENSE_FILE=${DOTCMS_LICENSE_PATH}/license.dat" >> "$GITHUB_ENV"
      - name: Run cli tests
        working-directory: ./tools/dotcms-cli/
        run: |
          env | grep DOTCMS_LICENSE
          ./mvnw clean verify

#      - name: Gather test results
#        uses: actions/upload-artifact@v2
#        with:
#          name: cli-test-results
#          path: ./tools/dotcms-cli/target/surefire-reports

#      - name: Github publish tests results
#        uses: ./.github/actions/publish-test-results
#        with:
#          build_id: ${{ env.BUILD_ID }}
#          build_hash: ${{ env.BUILD_HASH }}
#          test_type: integration
#          pull_request: ${{ github.event.number }}
#          pull_request: ${{ github.event.number }} # optional in case the tests are triggered by a PR
#          tests_results_status: PASSED|FAILED # tests results status, optional
#          tests_results_location: # tests results location, optional, most of the time this made up of a bunch of XML files, optional
#          tests_results_report_location: <path to results> # actual reports made from XML files, probably in HTML format
#          cicd_github_token: ${{ secrets.CICD_GITHUB_TOKEN }