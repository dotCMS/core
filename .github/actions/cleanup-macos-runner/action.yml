# action.yml
name: 'Cleanup macOS Runner'
description: 'Cleans up macos runner resources'
runs:
  using: 'composite'
  steps:
    - name: Show Disk Usage
      shell: bash
      run: |
        echo '# df -h'
        df -h
        
        echo "Runner OS: $RUNNER_OS"
        
        echo '# du -sh /Users/runner'
        sudo du -sh /Users/runner || true

    - name: Clean Homebrew cache
      shell: bash
      run: |
        echo 'Clean Homebrew cache'
        brew cleanup -s
        rm -rf "$(brew --cache)"

    - name: Check directory
      shell: bash
      run: |
        exists() {
          local file=$1
          [[ -e $file ]] && echo "$file exists" || echo "$file does not exist"
        }
        
        exists ${HOME}/.cache
        exists ${HOME}/Library/Logs
        exists ${HOME}/Library/Caches
        exists /usr/local/Caskroom/
        exists ${HOME}/Library/Android/sdk/tools
        exists ${HOME}/Library/Android/sdk/platform-tools
        
        exists ${HOME}/work/_temp
        exists ${HOME}/work/_tool
        exists ${HOME}/work/_config        
        
        which pipx
        which swift
        which dotnet
        which cargo
        which ghc
        which android
        which codeql
        which CodeQL
        
        ls -la $HOME
        ls -la ${HOME}/image-generation
        ls -la ${HOME}/hostedtoolcache
        ls -la ${HOME}/work

# [[ -e $file ]] && time sudo rm -rf $1 || true

#
#        removeIfExists /opt/hostedtoolcache/CodeQL
#        removeIfExists /imagegeneration/installers/go-*
#        removeIfExists /imagegeneration/installers/node-*
#        removeIfExists /imagegeneration/installers/python-*
#
#        removeIfExists /home/runner/work/_temp/*
#        removeIfExists /home/runner/work/_tool/*
#        removeIfExists /home/runner/work/_config/*
#
    - name: Show Disk Usage
      shell: bash
      run: |
        echo "# df -h"
        df -h

        echo '# du -sh /Users/runner'
        sudo du -sh /Users/runner || true
