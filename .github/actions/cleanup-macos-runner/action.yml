# action.yml
name: 'Cleanup macOS Runner'
description: 'Cleans up macos runner resources'
runs:
  using: 'composite'
  steps:
    - name: Show Disk Usage
      shell: bash
      run: |
        echo '# df -h'
        df -h
        
        echo "Runner OS: $RUNNER_OS"
        
        echo '# du -sh /Users/runner'
        sudo du -sh /Users/runner || true

    - name: Clean Homebrew cache
      shell: bash
      run: |
        echo 'Clean Homebrew cache'
        brew cleanup -s
        rm -rf "$(brew --cache)"

    - name: Check directory
      shell: bash
      run: |
        exists() {
          local file=$1
          [[ -e $file ]] && echo "$file exists" || echo "$file does not exist"
        }
        
        exists /Users/runner/.cache
        exists /Users/runner/Library/Logs
        exists /Users/runner/Library/Caches
        exists /Users/runner/Library/Developer/Xcode/DerivedData
        exists /usr/local/Caskroom/
        exists /Users/runner/Library/Android/sdk/tools
        exists /Users/runner/Library/Android/sdk/platform-tools
#        exists /Users/runner/.ghcup/bin
#        exists /Users/runner/.cargo/bin
#        exists /Users/runner/.yarn/bin
#        exists /Users/runner/.dotnet/tools
#
#        which pipx
#        which swift

# /Library/Java/JavaVirtualMachines/graalvm-ce-java11-22.1.0/Contents/Home/bin:/usr/local/lib/ruby/gems/3.0.0/bin:/usr/local/opt/ruby@3.0/bin:/usr/local/opt/pipx_bin:/Users/runner/.cargo/bin:/usr/local/opt/curl/bin:/usr/local/bin:/usr/local/sbin:/Users/runner/bin:/Users/runner/.yarn/bin:/Users/runner/Library/Android/sdk/tools:/Users/runner/Library/Android/sdk/platform-tools:/Library/Frameworks/Python.framework/Versions/Current/bin:/Library/Frameworks/Mono.framework/Versions/Current/Commands:/usr/bin:/bin:/usr/sbin:/sbin:/Users/runner/.dotnet/tools:/Users/runner/.ghcup/bin

#    - name: Reclaim Disk Space
#      shell: bash
#      run: |
#        removeIfExists() {
#          local file=$1
#          [[ -e $file ]] && rm -rf $1 || true
#        }
#
#        removeIfExists /usr/local/Caskroom/*
#        removeIfExists /usr/local/lib/android
#        removeIfExists /opt/ghc
#        removeIfExists /opt/pipx
#
#        removeIfExists $HOME/.cache/*
#        removeIfExists $HOME/.m2/*
#        removeIfExists $HOME/Library/Caches/*
#        removeIfExists $HOME/Library/Developer/Xcode/DerivedData/*
#        removeIfExists $HOME/Library/Logs/*


#        echo '# docker images'
#        docker images || true
#
#        echo '# du -sh /home/runner'
#        sudo du -sh /home/runner || true
#
#    - name: Clean apt cache
#      shell: bash
#      run: |
#        echo 'Clean apt cache'
#        time sudo apt-get clean -y
#        time sudo apt-get autoclean -y
#        time sudo apt-get autoremove -y
#        time sudo rm -rf /var/lib/apt/lists/*
#
#    - name: Cleanup Docker
#      shell: bash
#      run: |
#        echo 'Cleanup Docker'
#        time docker system prune -f
#        time docker volume prune -f
#        time docker image prune -f
#        time docker container prune -f
#        time docker network prune -f
#
#    - name: Reclaim Disk Space
#      shell: bash
#      run: |
#        removeIfExists() {
#          local file=$1
#          [[ -e $file ]] && time sudo rm -rf $1 || true
#        }
#
#        removeIfExists /usr/share/dotnet
#        removeIfExists /usr/share/swift
#        removeIfExists /usr/local/lib/android
#        removeIfExists /opt/ghc
#        removeIfExists /opt/pipx
#
#        removeIfExists /opt/hostedtoolcache/CodeQL
#        removeIfExists /imagegeneration/installers/go-*
#        removeIfExists /imagegeneration/installers/node-*
#        removeIfExists /imagegeneration/installers/python-*
#
#        removeIfExists /home/runner/work/_temp/*
#        removeIfExists /home/runner/work/_tool/*
#        removeIfExists /home/runner/work/_config/*
#
#    - name: Show Disk Usage
#      shell: bash
#      run: |
#        echo "# df -h"
#        df -h
#
#        echo '# docker images'
#        docker images || true
#
#        echo '# du -sh /home/runner'
#        sudo du -sh /home/runner || true
