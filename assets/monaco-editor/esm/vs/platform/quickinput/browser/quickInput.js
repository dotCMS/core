var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__param=this&&this.__param||function(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}};import{CancellationToken}from"../../../base/common/cancellation.js";import{QuickInputController}from"../../../base/parts/quickinput/browser/quickInput.js";import{IAccessibilityService}from"../../accessibility/common/accessibility.js";import{IContextKeyService,RawContextKey}from"../../contextkey/common/contextkey.js";import{IInstantiationService}from"../../instantiation/common/instantiation.js";import{ILayoutService}from"../../layout/browser/layoutService.js";import{WorkbenchList}from"../../list/browser/listService.js";import{QuickAccessController}from"./quickAccess.js";import{activeContrastBorder,badgeBackground,badgeForeground,buttonBackground,buttonForeground,buttonHoverBackground,contrastBorder,inputBackground,inputBorder,inputForeground,inputValidationErrorBackground,inputValidationErrorBorder,inputValidationErrorForeground,inputValidationInfoBackground,inputValidationInfoBorder,inputValidationInfoForeground,inputValidationWarningBackground,inputValidationWarningBorder,inputValidationWarningForeground,keybindingLabelBackground,keybindingLabelBorder,keybindingLabelBottomBorder,keybindingLabelForeground,pickerGroupBorder,pickerGroupForeground,progressBarBackground,quickInputBackground,quickInputForeground,quickInputListFocusBackground,quickInputListFocusForeground,quickInputListFocusIconForeground,quickInputTitleBackground,widgetShadow}from"../../theme/common/colorRegistry.js";import{computeStyles}from"../../theme/common/styler.js";import{IThemeService,Themable}from"../../theme/common/themeService.js";let QuickInputService=class QuickInputService extends Themable{constructor(instantiationService,contextKeyService,themeService,accessibilityService,layoutService){super(themeService),this.instantiationService=instantiationService,this.contextKeyService=contextKeyService,this.accessibilityService=accessibilityService,this.layoutService=layoutService,this.contexts=new Map}get controller(){return this._controller||(this._controller=this._register(this.createController())),this._controller}get quickAccess(){return this._quickAccess||(this._quickAccess=this._register(this.instantiationService.createInstance(QuickAccessController))),this._quickAccess}createController(host=this.layoutService,options){var _a,_b;const defaultOptions={idPrefix:"quickInput_",container:host.container,ignoreFocusOut:()=>!1,isScreenReaderOptimized:()=>this.accessibilityService.isScreenReaderOptimized(),backKeybindingLabel:()=>{},setContextKey:id=>this.setContextKey(id),returnFocus:()=>host.focus(),createList:(user,container,delegate,renderers,options)=>this.instantiationService.createInstance(WorkbenchList,user,container,delegate,renderers,options),styles:this.computeStyles()},controller=this._register(new QuickInputController(Object.assign(Object.assign({},defaultOptions),options)));return controller.layout(host.dimension,null!==(_b=null===(_a=host.offset)||void 0===_a?void 0:_a.top)&&void 0!==_b?_b:0),this._register(host.onDidLayout((dimension=>{var _a,_b;return controller.layout(dimension,null!==(_b=null===(_a=host.offset)||void 0===_a?void 0:_a.top)&&void 0!==_b?_b:0)}))),this._register(controller.onShow((()=>this.resetContextKeys()))),this._register(controller.onHide((()=>this.resetContextKeys()))),controller}setContextKey(id){let key;id&&(key=this.contexts.get(id),key||(key=new RawContextKey(id,!1).bindTo(this.contextKeyService),this.contexts.set(id,key))),key&&key.get()||(this.resetContextKeys(),key&&key.set(!0))}resetContextKeys(){this.contexts.forEach((context=>{context.get()&&context.reset()}))}pick(picks,options={},token=CancellationToken.None){return this.controller.pick(picks,options,token)}createQuickPick(){return this.controller.createQuickPick()}updateStyles(){this.controller.applyStyles(this.computeStyles())}computeStyles(){return{widget:Object.assign({},computeStyles(this.theme,{quickInputBackground,quickInputForeground,quickInputTitleBackground,contrastBorder,widgetShadow})),inputBox:computeStyles(this.theme,{inputForeground,inputBackground,inputBorder,inputValidationInfoBackground,inputValidationInfoForeground,inputValidationInfoBorder,inputValidationWarningBackground,inputValidationWarningForeground,inputValidationWarningBorder,inputValidationErrorBackground,inputValidationErrorForeground,inputValidationErrorBorder}),countBadge:computeStyles(this.theme,{badgeBackground,badgeForeground,badgeBorder:contrastBorder}),button:computeStyles(this.theme,{buttonForeground,buttonBackground,buttonHoverBackground,buttonBorder:contrastBorder}),progressBar:computeStyles(this.theme,{progressBarBackground}),keybindingLabel:computeStyles(this.theme,{keybindingLabelBackground,keybindingLabelForeground,keybindingLabelBorder,keybindingLabelBottomBorder,keybindingLabelShadow:widgetShadow}),list:computeStyles(this.theme,{listBackground:quickInputBackground,listInactiveFocusForeground:quickInputListFocusForeground,listInactiveSelectionIconForeground:quickInputListFocusIconForeground,listInactiveFocusBackground:quickInputListFocusBackground,listFocusOutline:activeContrastBorder,listInactiveFocusOutline:activeContrastBorder,pickerGroupBorder,pickerGroupForeground})}}};QuickInputService=__decorate([__param(0,IInstantiationService),__param(1,IContextKeyService),__param(2,IThemeService),__param(3,IAccessibilityService),__param(4,ILayoutService)],QuickInputService);export{QuickInputService};