var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__param=this&&this.__param||function(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}};import{Separator,SubmenuAction}from"../../../base/common/actions.js";import{CSSIcon}from"../../../base/common/codicons.js";import{Emitter}from"../../../base/common/event.js";import{Iterable}from"../../../base/common/iterator.js";import{toDisposable}from"../../../base/common/lifecycle.js";import{LinkedList}from"../../../base/common/linkedList.js";import{ICommandService}from"../../commands/common/commands.js";import{IContextKeyService}from"../../contextkey/common/contextkey.js";import{createDecorator}from"../../instantiation/common/instantiation.js";import{ThemeIcon}from"../../theme/common/themeService.js";export function isIMenuItem(item){return void 0!==item.command}export class MenuId{constructor(debugName){this.id=MenuId._idPool++,this._debugName=debugName}}MenuId._idPool=0,MenuId.CommandPalette=new MenuId("CommandPalette"),MenuId.DebugBreakpointsContext=new MenuId("DebugBreakpointsContext"),MenuId.DebugCallStackContext=new MenuId("DebugCallStackContext"),MenuId.DebugConsoleContext=new MenuId("DebugConsoleContext"),MenuId.DebugVariablesContext=new MenuId("DebugVariablesContext"),MenuId.DebugWatchContext=new MenuId("DebugWatchContext"),MenuId.DebugToolBar=new MenuId("DebugToolBar"),MenuId.EditorContext=new MenuId("EditorContext"),MenuId.SimpleEditorContext=new MenuId("SimpleEditorContext"),MenuId.EditorContextCopy=new MenuId("EditorContextCopy"),MenuId.EditorContextPeek=new MenuId("EditorContextPeek"),MenuId.EditorTitle=new MenuId("EditorTitle"),MenuId.EditorTitleRun=new MenuId("EditorTitleRun"),MenuId.EditorTitleContext=new MenuId("EditorTitleContext"),MenuId.EmptyEditorGroup=new MenuId("EmptyEditorGroup"),MenuId.EmptyEditorGroupContext=new MenuId("EmptyEditorGroupContext"),MenuId.ExplorerContext=new MenuId("ExplorerContext"),MenuId.ExtensionContext=new MenuId("ExtensionContext"),MenuId.GlobalActivity=new MenuId("GlobalActivity"),MenuId.LayoutControlMenuSubmenu=new MenuId("LayoutControlMenuSubmenu"),MenuId.LayoutControlMenu=new MenuId("LayoutControlMenu"),MenuId.MenubarMainMenu=new MenuId("MenubarMainMenu"),MenuId.MenubarAppearanceMenu=new MenuId("MenubarAppearanceMenu"),MenuId.MenubarDebugMenu=new MenuId("MenubarDebugMenu"),MenuId.MenubarEditMenu=new MenuId("MenubarEditMenu"),MenuId.MenubarCopy=new MenuId("MenubarCopy"),MenuId.MenubarFileMenu=new MenuId("MenubarFileMenu"),MenuId.MenubarGoMenu=new MenuId("MenubarGoMenu"),MenuId.MenubarHelpMenu=new MenuId("MenubarHelpMenu"),MenuId.MenubarLayoutMenu=new MenuId("MenubarLayoutMenu"),MenuId.MenubarNewBreakpointMenu=new MenuId("MenubarNewBreakpointMenu"),MenuId.MenubarPanelAlignmentMenu=new MenuId("MenubarPanelAlignmentMenu"),MenuId.MenubarPanelPositionMenu=new MenuId("MenubarPanelPositionMenu"),MenuId.MenubarPreferencesMenu=new MenuId("MenubarPreferencesMenu"),MenuId.MenubarRecentMenu=new MenuId("MenubarRecentMenu"),MenuId.MenubarSelectionMenu=new MenuId("MenubarSelectionMenu"),MenuId.MenubarSwitchEditorMenu=new MenuId("MenubarSwitchEditorMenu"),MenuId.MenubarSwitchGroupMenu=new MenuId("MenubarSwitchGroupMenu"),MenuId.MenubarTerminalMenu=new MenuId("MenubarTerminalMenu"),MenuId.MenubarViewMenu=new MenuId("MenubarViewMenu"),MenuId.MenubarHomeMenu=new MenuId("MenubarHomeMenu"),MenuId.OpenEditorsContext=new MenuId("OpenEditorsContext"),MenuId.ProblemsPanelContext=new MenuId("ProblemsPanelContext"),MenuId.SCMChangeContext=new MenuId("SCMChangeContext"),MenuId.SCMResourceContext=new MenuId("SCMResourceContext"),MenuId.SCMResourceFolderContext=new MenuId("SCMResourceFolderContext"),MenuId.SCMResourceGroupContext=new MenuId("SCMResourceGroupContext"),MenuId.SCMSourceControl=new MenuId("SCMSourceControl"),MenuId.SCMTitle=new MenuId("SCMTitle"),MenuId.SearchContext=new MenuId("SearchContext"),MenuId.StatusBarWindowIndicatorMenu=new MenuId("StatusBarWindowIndicatorMenu"),MenuId.StatusBarRemoteIndicatorMenu=new MenuId("StatusBarRemoteIndicatorMenu"),MenuId.TestItem=new MenuId("TestItem"),MenuId.TestItemGutter=new MenuId("TestItemGutter"),MenuId.TestPeekElement=new MenuId("TestPeekElement"),MenuId.TestPeekTitle=new MenuId("TestPeekTitle"),MenuId.TouchBarContext=new MenuId("TouchBarContext"),MenuId.TitleBarContext=new MenuId("TitleBarContext"),MenuId.TunnelContext=new MenuId("TunnelContext"),MenuId.TunnelPrivacy=new MenuId("TunnelPrivacy"),MenuId.TunnelProtocol=new MenuId("TunnelProtocol"),MenuId.TunnelPortInline=new MenuId("TunnelInline"),MenuId.TunnelTitle=new MenuId("TunnelTitle"),MenuId.TunnelLocalAddressInline=new MenuId("TunnelLocalAddressInline"),MenuId.TunnelOriginInline=new MenuId("TunnelOriginInline"),MenuId.ViewItemContext=new MenuId("ViewItemContext"),MenuId.ViewContainerTitle=new MenuId("ViewContainerTitle"),MenuId.ViewContainerTitleContext=new MenuId("ViewContainerTitleContext"),MenuId.ViewTitle=new MenuId("ViewTitle"),MenuId.ViewTitleContext=new MenuId("ViewTitleContext"),MenuId.CommentThreadTitle=new MenuId("CommentThreadTitle"),MenuId.CommentThreadActions=new MenuId("CommentThreadActions"),MenuId.CommentTitle=new MenuId("CommentTitle"),MenuId.CommentActions=new MenuId("CommentActions"),MenuId.InteractiveToolbar=new MenuId("InteractiveToolbar"),MenuId.InteractiveCellTitle=new MenuId("InteractiveCellTitle"),MenuId.InteractiveCellExecute=new MenuId("InteractiveCellExecute"),MenuId.InteractiveInputExecute=new MenuId("InteractiveInputExecute"),MenuId.NotebookToolbar=new MenuId("NotebookToolbar"),MenuId.NotebookCellTitle=new MenuId("NotebookCellTitle"),MenuId.NotebookCellInsert=new MenuId("NotebookCellInsert"),MenuId.NotebookCellBetween=new MenuId("NotebookCellBetween"),MenuId.NotebookCellListTop=new MenuId("NotebookCellTop"),MenuId.NotebookCellExecute=new MenuId("NotebookCellExecute"),MenuId.NotebookCellExecutePrimary=new MenuId("NotebookCellExecutePrimary"),MenuId.NotebookDiffCellInputTitle=new MenuId("NotebookDiffCellInputTitle"),MenuId.NotebookDiffCellMetadataTitle=new MenuId("NotebookDiffCellMetadataTitle"),MenuId.NotebookDiffCellOutputsTitle=new MenuId("NotebookDiffCellOutputsTitle"),MenuId.NotebookOutputToolbar=new MenuId("NotebookOutputToolbar"),MenuId.NotebookEditorLayoutConfigure=new MenuId("NotebookEditorLayoutConfigure"),MenuId.BulkEditTitle=new MenuId("BulkEditTitle"),MenuId.BulkEditContext=new MenuId("BulkEditContext"),MenuId.TimelineItemContext=new MenuId("TimelineItemContext"),MenuId.TimelineTitle=new MenuId("TimelineTitle"),MenuId.TimelineTitleContext=new MenuId("TimelineTitleContext"),MenuId.AccountsContext=new MenuId("AccountsContext"),MenuId.PanelTitle=new MenuId("PanelTitle"),MenuId.AuxiliaryBarTitle=new MenuId("AuxiliaryBarTitle"),MenuId.TerminalInstanceContext=new MenuId("TerminalInstanceContext"),MenuId.TerminalEditorInstanceContext=new MenuId("TerminalEditorInstanceContext"),MenuId.TerminalNewDropdownContext=new MenuId("TerminalNewDropdownContext"),MenuId.TerminalTabContext=new MenuId("TerminalTabContext"),MenuId.TerminalTabEmptyAreaContext=new MenuId("TerminalTabEmptyAreaContext"),MenuId.TerminalInlineTabContext=new MenuId("TerminalInlineTabContext"),MenuId.WebviewContext=new MenuId("WebviewContext"),MenuId.InlineCompletionsActions=new MenuId("InlineCompletionsActions"),MenuId.NewFile=new MenuId("NewFile");export const IMenuService=createDecorator("menuService");export const MenuRegistry=new class{constructor(){this._commands=new Map,this._menuItems=new Map,this._onDidChangeMenu=new Emitter,this.onDidChangeMenu=this._onDidChangeMenu.event,this._commandPaletteChangeEvent={has:id=>id===MenuId.CommandPalette}}addCommand(command){return this.addCommands(Iterable.single(command))}addCommands(commands){for(const command of commands)this._commands.set(command.id,command);return this._onDidChangeMenu.fire(this._commandPaletteChangeEvent),toDisposable((()=>{let didChange=!1;for(const command of commands)didChange=this._commands.delete(command.id)||didChange;didChange&&this._onDidChangeMenu.fire(this._commandPaletteChangeEvent)}))}getCommand(id){return this._commands.get(id)}getCommands(){const map=new Map;return this._commands.forEach(((value,key)=>map.set(key,value))),map}appendMenuItem(id,item){return this.appendMenuItems(Iterable.single({id,item}))}appendMenuItems(items){const changedIds=new Set,toRemove=new LinkedList;for(const{id,item}of items){let list=this._menuItems.get(id);list||(list=new LinkedList,this._menuItems.set(id,list)),toRemove.push(list.push(item)),changedIds.add(id)}return this._onDidChangeMenu.fire(changedIds),toDisposable((()=>{if(toRemove.size>0){for(let fn of toRemove)fn();this._onDidChangeMenu.fire(changedIds),toRemove.clear()}}))}getMenuItems(id){let result;return result=this._menuItems.has(id)?[...this._menuItems.get(id)]:[],id===MenuId.CommandPalette&&this._appendImplicitItems(result),result}_appendImplicitItems(result){const set=new Set;for(const item of result)isIMenuItem(item)&&(set.add(item.command.id),item.alt&&set.add(item.alt.id));this._commands.forEach(((command,id)=>{set.has(id)||result.push({command})}))}};export class SubmenuItemAction extends SubmenuAction{constructor(item,_menuService,_contextKeyService,_options){super(`submenuitem.${item.submenu.id}`,"string"==typeof item.title?item.title:item.title.value,[],"submenu"),this.item=item,this._menuService=_menuService,this._contextKeyService=_contextKeyService,this._options=_options}get actions(){const result=[],menu=this._menuService.createMenu(this.item.submenu,this._contextKeyService),groups=menu.getActions(this._options);menu.dispose();for(const[,actions]of groups)actions.length>0&&(result.push(...actions),result.push(new Separator));return result.length&&result.pop(),result}}let MenuItemAction=class MenuItemAction{constructor(item,alt,options,contextKeyService,_commandService){var _a,_b;if(this._commandService=_commandService,this.id=item.id,this.label=(null==options?void 0:options.renderShortTitle)&&item.shortTitle?"string"==typeof item.shortTitle?item.shortTitle:item.shortTitle.value:"string"==typeof item.title?item.title:item.title.value,this.tooltip=null!==(_b="string"==typeof item.tooltip?item.tooltip:null===(_a=item.tooltip)||void 0===_a?void 0:_a.value)&&void 0!==_b?_b:"",this.enabled=!item.precondition||contextKeyService.contextMatchesRules(item.precondition),this.checked=void 0,item.toggled){const toggled=item.toggled.condition?item.toggled:{condition:item.toggled};this.checked=contextKeyService.contextMatchesRules(toggled.condition),this.checked&&toggled.tooltip&&(this.tooltip="string"==typeof toggled.tooltip?toggled.tooltip:toggled.tooltip.value),toggled.title&&(this.label="string"==typeof toggled.title?toggled.title:toggled.title.value)}this.item=item,this.alt=alt?new MenuItemAction(alt,void 0,options,contextKeyService,_commandService):void 0,this._options=options,ThemeIcon.isThemeIcon(item.icon)&&(this.class=CSSIcon.asClassName(item.icon))}dispose(){}run(...args){var _a,_b;let runArgs=[];return(null===(_a=this._options)||void 0===_a?void 0:_a.arg)&&(runArgs=[...runArgs,this._options.arg]),(null===(_b=this._options)||void 0===_b?void 0:_b.shouldForwardArgs)&&(runArgs=[...runArgs,...args]),this._commandService.executeCommand(this.id,...runArgs)}};MenuItemAction=__decorate([__param(3,IContextKeyService),__param(4,ICommandService)],MenuItemAction);export{MenuItemAction};