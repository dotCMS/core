var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__param=this&&this.__param||function(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}},__awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))},__asyncValues=this&&this.__asyncValues||function(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,m=o[Symbol.asyncIterator];return m?m.call(o):(o="function"==typeof __values?__values(o):o[Symbol.iterator](),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i);function verb(n){i[n]=o[n]&&function(v){return new Promise((function(resolve,reject){(function settle(resolve,reject,d,v){Promise.resolve(v).then((function(v){resolve({value:v,done:d})}),reject)})(resolve,reject,(v=o[n](v)).done,v.value)}))}}};import{AsyncIterableObject}from"../../../../base/common/async.js";import{isEmptyMarkdownString,MarkdownString}from"../../../../base/common/htmlContent.js";import{Position}from"../../../common/core/position.js";import{ModelDecorationInjectedTextOptions}from"../../../common/model/textModel.js";import{HoverForeignElementAnchor}from"../../hover/browser/hoverTypes.js";import{ILanguageService}from"../../../common/languages/language.js";import{ITextModelService}from"../../../common/services/resolverService.js";import{getHover}from"../../hover/browser/getHover.js";import{MarkdownHover,MarkdownHoverParticipant}from"../../hover/browser/markdownHoverParticipant.js";import{RenderedInlayHintLabelPart,InlayHintsController}from"./inlayHintsController.js";import{IConfigurationService}from"../../../../platform/configuration/common/configuration.js";import{IOpenerService}from"../../../../platform/opener/common/opener.js";import{ILanguageFeaturesService}from"../../../common/services/languageFeatures.js";import{localize}from"../../../../nls.js";import*as platform from"../../../../base/common/platform.js";import{asCommandLink}from"./inlayHints.js";class InlayHintsHoverAnchor extends HoverForeignElementAnchor{constructor(part,owner){super(10,owner,part.item.anchor.range),this.part=part}}let InlayHintsHover=class InlayHintsHover extends MarkdownHoverParticipant{constructor(editor,languageService,openerService,configurationService,_resolverService,languageFeaturesService){super(editor,languageService,openerService,configurationService,languageFeaturesService),this._resolverService=_resolverService,this.hoverOrdinal=6}suggestHoverAnchor(mouseEvent){var _a;if(!InlayHintsController.get(this._editor))return null;if(6!==mouseEvent.target.type)return null;const options=null===(_a=mouseEvent.target.detail.injectedText)||void 0===_a?void 0:_a.options;return options instanceof ModelDecorationInjectedTextOptions&&options.attachedData instanceof RenderedInlayHintLabelPart?new InlayHintsHoverAnchor(options.attachedData,this):null}computeSync(){return[]}computeAsync(anchor,_lineDecorations,token){return anchor instanceof InlayHintsHoverAnchor?new AsyncIterableObject((executor=>__awaiter(this,void 0,void 0,(function*(){var e_1,_a;const{part}=anchor;if(yield part.item.resolve(token),token.isCancellationRequested)return;let itemTooltip,partTooltip;if("string"==typeof part.item.hint.tooltip?itemTooltip=(new MarkdownString).appendText(part.item.hint.tooltip):part.item.hint.tooltip&&(itemTooltip=part.item.hint.tooltip),itemTooltip&&executor.emitOne(new MarkdownHover(this,anchor.range,[itemTooltip],0)),"string"==typeof part.part.tooltip?partTooltip=(new MarkdownString).appendText(part.part.tooltip):part.part.tooltip&&(partTooltip=part.part.tooltip),partTooltip&&executor.emitOne(new MarkdownHover(this,anchor.range,[partTooltip],1)),part.part.location||part.part.command){let linkHint;const kb="altKey"===this._editor.getOption(70)?platform.isMacintosh?localize("links.navigate.kb.meta.mac","cmd + click"):localize("links.navigate.kb.meta","ctrl + click"):platform.isMacintosh?localize("links.navigate.kb.alt.mac","option + click"):localize("links.navigate.kb.alt","alt + click");part.part.location&&part.part.command?linkHint=(new MarkdownString).appendText(localize("hint.defAndCommand","Go to Definition ({0}), right click for more",kb)):part.part.location?linkHint=(new MarkdownString).appendText(localize("hint.def","Go to Definition ({0})",kb)):part.part.command&&(linkHint=new MarkdownString(`[${localize("hint.cmd","Execute Command")}](${asCommandLink(part.part.command)} "${part.part.command.title}") (${kb})`,{isTrusted:!0})),linkHint&&executor.emitOne(new MarkdownHover(this,anchor.range,[linkHint],1e4))}const iterable=yield this._resolveInlayHintLabelPartHover(part,token);try{for(var iterable_1_1,iterable_1=__asyncValues(iterable);!(iterable_1_1=yield iterable_1.next()).done;){let item=iterable_1_1.value;executor.emitOne(item)}}catch(e_1_1){e_1={error:e_1_1}}finally{try{iterable_1_1&&!iterable_1_1.done&&(_a=iterable_1.return)&&(yield _a.call(iterable_1))}finally{if(e_1)throw e_1.error}}})))):AsyncIterableObject.EMPTY}_resolveInlayHintLabelPartHover(part,token){return __awaiter(this,void 0,void 0,(function*(){if(!part.part.location)return AsyncIterableObject.EMPTY;const{uri,range}=part.part.location,ref=yield this._resolverService.createModelReference(uri);try{const model=ref.object.textEditorModel;return this._languageFeaturesService.hoverProvider.has(model)?getHover(this._languageFeaturesService.hoverProvider,model,new Position(range.startLineNumber,range.startColumn),token).filter((item=>!isEmptyMarkdownString(item.hover.contents))).map((item=>new MarkdownHover(this,part.item.anchor.range,item.hover.contents,2+item.ordinal))):AsyncIterableObject.EMPTY}finally{ref.dispose()}}))}};InlayHintsHover=__decorate([__param(1,ILanguageService),__param(2,IOpenerService),__param(3,IConfigurationService),__param(4,ITextModelService),__param(5,ILanguageFeaturesService)],InlayHintsHover);export{InlayHintsHover};