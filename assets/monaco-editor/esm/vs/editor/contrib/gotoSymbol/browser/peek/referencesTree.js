var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=c<3?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(c<3?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__param=this&&this.__param||function(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}};import*as dom from"../../../../../base/browser/dom.js";import{CountBadge}from"../../../../../base/browser/ui/countBadge/countBadge.js";import{HighlightedLabel}from"../../../../../base/browser/ui/highlightedlabel/highlightedLabel.js";import{IconLabel}from"../../../../../base/browser/ui/iconLabel/iconLabel.js";import{createMatches,FuzzyScore}from"../../../../../base/common/filters.js";import{getBaseLabel}from"../../../../../base/common/labels.js";import{Disposable}from"../../../../../base/common/lifecycle.js";import{basename,dirname}from"../../../../../base/common/resources.js";import{ITextModelService}from"../../../../common/services/resolverService.js";import{localize}from"../../../../../nls.js";import{IInstantiationService}from"../../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService}from"../../../../../platform/keybinding/common/keybinding.js";import{ILabelService}from"../../../../../platform/label/common/label.js";import{attachBadgeStyler}from"../../../../../platform/theme/common/styler.js";import{IThemeService}from"../../../../../platform/theme/common/themeService.js";import{FileReferences,OneReference,ReferencesModel}from"../referencesModel.js";let DataSource=class DataSource{constructor(_resolverService){this._resolverService=_resolverService}hasChildren(element){return element instanceof ReferencesModel||element instanceof FileReferences}getChildren(element){if(element instanceof ReferencesModel)return element.groups;if(element instanceof FileReferences)return element.resolve(this._resolverService).then((val=>val.children));throw new Error("bad tree")}};DataSource=__decorate([__param(0,ITextModelService)],DataSource);export{DataSource};export class Delegate{getHeight(){return 23}getTemplateId(element){return element instanceof FileReferences?FileReferencesRenderer.id:OneReferenceRenderer.id}}let StringRepresentationProvider=class StringRepresentationProvider{constructor(_keybindingService){this._keybindingService=_keybindingService}getKeyboardNavigationLabel(element){var _a;if(element instanceof OneReference){const parts=null===(_a=element.parent.getPreview(element))||void 0===_a?void 0:_a.preview(element.range);if(parts)return parts.value}return basename(element.uri)}};StringRepresentationProvider=__decorate([__param(0,IKeybindingService)],StringRepresentationProvider);export{StringRepresentationProvider};export class IdentityProvider{getId(element){return element instanceof OneReference?element.id:element.uri}}let FileReferencesTemplate=class FileReferencesTemplate extends Disposable{constructor(container,_uriLabel,themeService){super(),this._uriLabel=_uriLabel;const parent=document.createElement("div");parent.classList.add("reference-file"),this.file=this._register(new IconLabel(parent,{supportHighlights:!0})),this.badge=new CountBadge(dom.append(parent,dom.$(".count"))),this._register(attachBadgeStyler(this.badge,themeService)),container.appendChild(parent)}set(element,matches){let parent=dirname(element.uri);this.file.setLabel(getBaseLabel(element.uri),this._uriLabel.getUriLabel(parent,{relative:!0}),{title:this._uriLabel.getUriLabel(element.uri),matches});const len=element.children.length;this.badge.setCount(len),len>1?this.badge.setTitleFormat(localize("referencesCount","{0} references",len)):this.badge.setTitleFormat(localize("referenceCount","{0} reference",len))}};FileReferencesTemplate=__decorate([__param(1,ILabelService),__param(2,IThemeService)],FileReferencesTemplate);let FileReferencesRenderer=class FileReferencesRenderer{constructor(_instantiationService){this._instantiationService=_instantiationService,this.templateId=FileReferencesRenderer.id}renderTemplate(container){return this._instantiationService.createInstance(FileReferencesTemplate,container)}renderElement(node,index,template){template.set(node.element,createMatches(node.filterData))}disposeTemplate(templateData){templateData.dispose()}};FileReferencesRenderer.id="FileReferencesRenderer",FileReferencesRenderer=__decorate([__param(0,IInstantiationService)],FileReferencesRenderer);export{FileReferencesRenderer};class OneReferenceTemplate{constructor(container){this.label=new HighlightedLabel(container)}set(element,score){var _a;const preview=null===(_a=element.parent.getPreview(element))||void 0===_a?void 0:_a.preview(element.range);if(preview&&preview.value){const{value,highlight}=preview;score&&!FuzzyScore.isDefault(score)?(this.label.element.classList.toggle("referenceMatch",!1),this.label.set(value,createMatches(score))):(this.label.element.classList.toggle("referenceMatch",!0),this.label.set(value,[highlight]))}else this.label.set(`${basename(element.uri)}:${element.range.startLineNumber+1}:${element.range.startColumn+1}`)}}export class OneReferenceRenderer{constructor(){this.templateId=OneReferenceRenderer.id}renderTemplate(container){return new OneReferenceTemplate(container)}renderElement(node,index,templateData){templateData.set(node.element,node.filterData)}disposeTemplate(){}}OneReferenceRenderer.id="OneReferenceRenderer";export class AccessibilityProvider{getWidgetAriaLabel(){return localize("treeAriaLabel","References")}getAriaLabel(element){return element.ariaMessage}}