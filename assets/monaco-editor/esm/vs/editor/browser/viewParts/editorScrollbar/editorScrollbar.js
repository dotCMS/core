import*as dom from"../../../../base/browser/dom.js";import{createFastDomNode}from"../../../../base/browser/fastDomNode.js";import{SmoothScrollableElement}from"../../../../base/browser/ui/scrollbar/scrollableElement.js";import{PartFingerprints,ViewPart}from"../../view/viewPart.js";import{registerThemingParticipant,getThemeTypeSelector}from"../../../../platform/theme/common/themeService.js";import{scrollbarShadow,scrollbarSliderActiveBackground,scrollbarSliderBackground,scrollbarSliderHoverBackground}from"../../../../platform/theme/common/colorRegistry.js";export class EditorScrollbar extends ViewPart{constructor(context,linesContent,viewDomNode,overflowGuardDomNode){super(context);const options=this._context.configuration.options,scrollbar=options.get(92),mouseWheelScrollSensitivity=options.get(67),fastScrollSensitivity=options.get(34),scrollPredominantAxis=options.get(95),scrollbarOptions={listenOnDomNode:viewDomNode.domNode,className:"editor-scrollable "+getThemeTypeSelector(context.theme.type),useShadows:!1,lazyRender:!0,vertical:scrollbar.vertical,horizontal:scrollbar.horizontal,verticalHasArrows:scrollbar.verticalHasArrows,horizontalHasArrows:scrollbar.horizontalHasArrows,verticalScrollbarSize:scrollbar.verticalScrollbarSize,verticalSliderSize:scrollbar.verticalSliderSize,horizontalScrollbarSize:scrollbar.horizontalScrollbarSize,horizontalSliderSize:scrollbar.horizontalSliderSize,handleMouseWheel:scrollbar.handleMouseWheel,alwaysConsumeMouseWheel:scrollbar.alwaysConsumeMouseWheel,arrowSize:scrollbar.arrowSize,mouseWheelScrollSensitivity,fastScrollSensitivity,scrollPredominantAxis,scrollByPage:scrollbar.scrollByPage};this.scrollbar=this._register(new SmoothScrollableElement(linesContent.domNode,scrollbarOptions,this._context.viewLayout.getScrollable())),PartFingerprints.write(this.scrollbar.getDomNode(),5),this.scrollbarDomNode=createFastDomNode(this.scrollbar.getDomNode()),this.scrollbarDomNode.setPosition("absolute"),this._setLayout();const onBrowserDesperateReveal=(domNode,lookAtScrollTop,lookAtScrollLeft)=>{const newScrollPosition={};if(lookAtScrollTop){const deltaTop=domNode.scrollTop;deltaTop&&(newScrollPosition.scrollTop=this._context.viewLayout.getCurrentScrollTop()+deltaTop,domNode.scrollTop=0)}if(lookAtScrollLeft){const deltaLeft=domNode.scrollLeft;deltaLeft&&(newScrollPosition.scrollLeft=this._context.viewLayout.getCurrentScrollLeft()+deltaLeft,domNode.scrollLeft=0)}this._context.viewModel.viewLayout.setScrollPosition(newScrollPosition,1)};this._register(dom.addDisposableListener(viewDomNode.domNode,"scroll",(e=>onBrowserDesperateReveal(viewDomNode.domNode,!0,!0)))),this._register(dom.addDisposableListener(linesContent.domNode,"scroll",(e=>onBrowserDesperateReveal(linesContent.domNode,!0,!1)))),this._register(dom.addDisposableListener(overflowGuardDomNode.domNode,"scroll",(e=>onBrowserDesperateReveal(overflowGuardDomNode.domNode,!0,!1)))),this._register(dom.addDisposableListener(this.scrollbarDomNode.domNode,"scroll",(e=>onBrowserDesperateReveal(this.scrollbarDomNode.domNode,!0,!1))))}dispose(){super.dispose()}_setLayout(){const options=this._context.configuration.options,layoutInfo=options.get(131);this.scrollbarDomNode.setLeft(layoutInfo.contentLeft);"right"===options.get(65).side?this.scrollbarDomNode.setWidth(layoutInfo.contentWidth+layoutInfo.minimap.minimapWidth):this.scrollbarDomNode.setWidth(layoutInfo.contentWidth),this.scrollbarDomNode.setHeight(layoutInfo.height)}getOverviewRulerLayoutInfo(){return this.scrollbar.getOverviewRulerLayoutInfo()}getDomNode(){return this.scrollbarDomNode}delegateVerticalScrollbarMouseDown(browserEvent){this.scrollbar.delegateVerticalScrollbarMouseDown(browserEvent)}onConfigurationChanged(e){if(e.hasChanged(92)||e.hasChanged(67)||e.hasChanged(34)){const options=this._context.configuration.options,scrollbar=options.get(92),mouseWheelScrollSensitivity=options.get(67),fastScrollSensitivity=options.get(34),scrollPredominantAxis=options.get(95),newOpts={vertical:scrollbar.vertical,horizontal:scrollbar.horizontal,verticalScrollbarSize:scrollbar.verticalScrollbarSize,horizontalScrollbarSize:scrollbar.horizontalScrollbarSize,scrollByPage:scrollbar.scrollByPage,handleMouseWheel:scrollbar.handleMouseWheel,mouseWheelScrollSensitivity,fastScrollSensitivity,scrollPredominantAxis};this.scrollbar.updateOptions(newOpts)}return e.hasChanged(131)&&this._setLayout(),!0}onScrollChanged(e){return!0}onThemeChanged(e){return this.scrollbar.updateClassName("editor-scrollable "+getThemeTypeSelector(this._context.theme.type)),!0}prepareRender(ctx){}render(ctx){this.scrollbar.renderNow()}}registerThemingParticipant(((theme,collector)=>{const scrollbarShadowColor=theme.getColor(scrollbarShadow);scrollbarShadowColor&&collector.addRule(`\n\t\t\t.monaco-scrollable-element > .shadow.top {\n\t\t\t\tbox-shadow: ${scrollbarShadowColor} 0 6px 6px -6px inset;\n\t\t\t}\n\n\t\t\t.monaco-scrollable-element > .shadow.left {\n\t\t\t\tbox-shadow: ${scrollbarShadowColor} 6px 0 6px -6px inset;\n\t\t\t}\n\n\t\t\t.monaco-scrollable-element > .shadow.top.left {\n\t\t\t\tbox-shadow: ${scrollbarShadowColor} 6px 6px 6px -6px inset;\n\t\t\t}\n\t\t`);const scrollbarSliderBackgroundColor=theme.getColor(scrollbarSliderBackground);scrollbarSliderBackgroundColor&&collector.addRule(`\n\t\t\t.monaco-scrollable-element > .scrollbar > .slider {\n\t\t\t\tbackground: ${scrollbarSliderBackgroundColor};\n\t\t\t}\n\t\t`);const scrollbarSliderHoverBackgroundColor=theme.getColor(scrollbarSliderHoverBackground);scrollbarSliderHoverBackgroundColor&&collector.addRule(`\n\t\t\t.monaco-scrollable-element > .scrollbar > .slider:hover {\n\t\t\t\tbackground: ${scrollbarSliderHoverBackgroundColor};\n\t\t\t}\n\t\t`);const scrollbarSliderActiveBackgroundColor=theme.getColor(scrollbarSliderActiveBackground);scrollbarSliderActiveBackgroundColor&&collector.addRule(`\n\t\t\t.monaco-scrollable-element > .scrollbar > .slider.active {\n\t\t\t\tbackground: ${scrollbarSliderActiveBackgroundColor};\n\t\t\t}\n\t\t`)}));